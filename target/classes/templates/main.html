<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${title}">BPE Platform - Main Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/wordcloud@1.2.2/src/wordcloud2.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1d29;
            color: #ffffff;
            overflow-x: hidden;
        }

        /* ë¼ë””ì˜¤ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .form-check-input[type="radio"] {
            background-color: #3a3f52;
            border-color: #495057;
            cursor: pointer;
            width: 1.25em;
            height: 1.25em;
        }

        .form-check-input[type="radio"]:checked {
            background-color: #4a90e2;
            border-color: #4a90e2;
        }

        .form-check-input[type="radio"]:focus {
            border-color: #4a90e2;
            box-shadow: 0 0 0 0.25rem rgba(74, 144, 226, 0.25);
        }

        .form-check-input[type="radio"]:hover {
            border-color: #4a90e2;
        }

        /* í”Œë¡œíŒ… ì±—ë´‡ ë²„íŠ¼ */
        .floating-chat-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4a90e2, #357abd);
            border: none;
            color: #ffffff;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(74, 144, 226, 0.4);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .floating-chat-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(74, 144, 226, 0.6);
            background: linear-gradient(135deg, #357abd, #2a5f8f);
        }

        .floating-chat-button:active {
            transform: scale(0.95);
        }

        /* í”Œë¡œíŒ… ì±—ë´‡ ì°½ */
        .floating-chat-window {
            position: fixed;
            bottom: 90px;
            right: 30px;
            width: 380px;
            height: 500px;
            background: #2d3142;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            z-index: 999;
            display: none;
            flex-direction: column;
            border: 1px solid #4a4f62;
            overflow: hidden;
        }

        .floating-chat-window.open {
            display: flex;
        }

        .floating-chat-header {
            background: linear-gradient(135deg, #4a90e2, #357abd);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #357abd;
        }

        .floating-chat-header h4 {
            margin: 0;
            color: #ffffff;
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .floating-chat-close {
            background: transparent;
            border: none;
            color: #ffffff;
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .floating-chat-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .floating-chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            background: #1a1d29;
        }

        .floating-chat-input-area {
            padding: 15px;
            border-top: 1px solid #4a4f62;
            background: #2d3142;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .floating-chat-input {
            flex: 1;
            background: #1a1d29;
            border: 1px solid #4a4f62;
            color: #ffffff;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            outline: none;
        }

        .floating-chat-input::placeholder {
            color: #a0a6b8;
        }

        .floating-chat-send {
            background: #4a90e2;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            color: #ffffff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .floating-chat-send:hover {
            background: #357abd;
            transform: scale(1.05);
        }

        .floating-chat-send:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        /* ì‘ì€ ë©”ì‹œì§€ ë²„ë¸” ìŠ¤íƒ€ì¼ */
        .floating-chat-message {
            display: flex;
            gap: 8px;
            max-width: 85%;
        }

        .floating-chat-message.user-message {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .floating-chat-message.bot-message {
            align-self: flex-start;
        }

        .floating-chat-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4a90e2, #357abd);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #ffffff;
            flex-shrink: 0;
        }

        .floating-chat-bubble {
            padding: 10px 14px;
            border-radius: 12px;
            font-size: 0.85rem;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .floating-chat-message.user-message .floating-chat-bubble {
            background: linear-gradient(135deg, #4a90e2, #357abd);
            color: #ffffff;
        }

        .floating-chat-message.bot-message .floating-chat-bubble {
            background: #3a3f52;
            color: #ffffff;
        }

        /* ì‚¬ì´ë“œë°” */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            background: #2d3142;
            border-right: 1px solid #3a3f52;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .sidebar.collapsed {
            width: 70px;
        }

        .sidebar.collapsed .sidebar-title {
            display: none;
        }

        .sidebar.collapsed .user-profile {
            padding: 10px;
        }

        .sidebar.collapsed .user-info {
            display: none;
        }


        .sidebar.collapsed .menu-text {
            display: none;
        }

        .sidebar.collapsed .menu-link {
            justify-content: center;
            padding: 12px;
        }

        .sidebar.collapsed .menu-icon {
            margin-right: 0;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #3a3f52;
        }

        .sidebar-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 30px;
        }

        .user-profile {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 50px;
            margin-top: 40px;
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            font-size: 1.5rem;
            color: #2d3142;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .user-avatar:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.3);
        }
        
        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }
        
        .user-avatar .upload-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            border-radius: 50%;
        }
        
        .user-avatar:hover .upload-overlay {
            opacity: 1;
        }
        
        .upload-overlay i {
            color: white;
            font-size: 1.2rem;
        }

        .user-info {
            text-align: center;
        }

        .user-username {
            font-size: 1.0rem;
            color: #a0a6b8;
            font-weight: 400;
            margin-bottom: 2px;
        }

        .user-name {
            font-size: 1.1rem;
            color: #ffffff;
            font-weight: 500;
        }

        .sidebar-menu {
            list-style: none;
            padding: 15px 15px 0 15px;
        }

        .menu-item {
            margin-bottom: 5px;
        }

        .menu-link {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: #a0a6b8;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .menu-link:hover {
            background: #3a3f52;
            color: #ffffff;
        }

        .menu-link.active {
            background: #4a90e2;
            color: #ffffff;
        }

        .menu-icon {
            width: 20px;
            margin-right: 12px;
            text-align: center;
        }

        .menu-text {
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* í‚¤ì›Œë“œ ë¦¬ìŠ¤íŠ¸ ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
        #keywordList::-webkit-scrollbar {
            width: 8px;
        }

        #keywordList::-webkit-scrollbar-track {
            background: #2d3142;
            border-radius: 4px;
        }

        #keywordList::-webkit-scrollbar-thumb {
            background: #4a4f62;
            border-radius: 4px;
        }

        #keywordList::-webkit-scrollbar-thumb:hover {
            background: #4a90e2;
        }

        /* ì±—ë´‡ ìŠ¤íƒ€ì¼ */
        .chat-message {
            display: flex;
            gap: 12px;
            align-items: flex-start;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .bot-message {
            justify-content: flex-end;
            flex-direction: row-reverse;
        }

        .user-message {
            justify-content: flex-start;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 1.2rem;
        }

        .bot-message .message-avatar {
            background: linear-gradient(135deg, #6c7a89, #5a6575);
            color: #ffffff;
        }

        .user-message .message-avatar {
            background: linear-gradient(135deg, #4a90e2, #357abd);
            color: #ffffff;
        }

        .message-content {
            max-width: 70%;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .user-message .message-content {
            align-items: flex-start;
        }

        .bot-message .message-content {
            align-items: flex-end;
        }

        .message-bubble {
            padding: 12px 16px;
            border-radius: 18px;
            word-wrap: break-word;
            line-height: 1.5;
            font-size: 0.95rem;
        }

        .bot-bubble {
            background: linear-gradient(135deg, #4a90e2, #357abd);
            color: #ffffff;
            border-bottom-right-radius: 4px;
        }

        .user-bubble {
            background: #3a3f52;
            color: #ffffff;
            border-bottom-left-radius: 4px;
        }

        .message-time {
            font-size: 0.75rem;
            color: #a0a6b8;
            padding: 0 8px;
        }

        /* ì±—ë´‡ ë©”ì‹œì§€ ì˜ì—­ ìŠ¤í¬ë¡¤ë°” */
        #chatMessages::-webkit-scrollbar {
            width: 8px;
        }

        #chatMessages::-webkit-scrollbar-track {
            background: #2d3142;
            border-radius: 4px;
        }

        #chatMessages::-webkit-scrollbar-thumb {
            background: #4a4f62;
            border-radius: 4px;
        }

        #chatMessages::-webkit-scrollbar-thumb:hover {
            background: #4a90e2;
        }

        /* ì±—ë´‡ ì…ë ¥ì°½ placeholder ìŠ¤íƒ€ì¼ */
        #chatInput::placeholder {
            color: #a0a6b8 !important;
            opacity: 1;
        }

        #chatInput::-webkit-input-placeholder {
            color: #a0a6b8 !important;
        }

        #chatInput::-moz-placeholder {
            color: #a0a6b8 !important;
            opacity: 1;
        }

        #chatInput:-ms-input-placeholder {
            color: #a0a6b8 !important;
        }

        /* ë°ì´í„° ì±—ë´‡ ì…ë ¥ì°½ placeholder ìŠ¤íƒ€ì¼ */
        #dataChatInput::placeholder {
            color: #a0a6b8 !important;
            opacity: 1;
        }

        #dataChatInput::-webkit-input-placeholder {
            color: #a0a6b8 !important;
        }

        #dataChatInput::-moz-placeholder {
            color: #a0a6b8 !important;
            opacity: 1;
        }

        #dataChatInput:-ms-input-placeholder {
            color: #a0a6b8 !important;
        }

        /* ì±—ë´‡ ì…ë ¥ì°½ í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
        #chatInput,
        #dataChatInput {
            color: #ffffff !important;
        }

        /* í”„ë¡œì íŠ¸ ìƒì„± ëª¨ë‹¬ ì…ë ¥ì°½ placeholder ìŠ¤íƒ€ì¼ */
        #createProjectName::placeholder,
        #createDataQuery::placeholder,
        #dbHost::placeholder,
        #dbDatabase::placeholder,
        #dbTable::placeholder,
        #dbUser::placeholder,
        #dbPassword::placeholder {
            color: #a0a6b8 !important;
            opacity: 1;
        }

        #createProjectName::-webkit-input-placeholder,
        #createDataQuery::-webkit-input-placeholder,
        #dbHost::-webkit-input-placeholder,
        #dbDatabase::-webkit-input-placeholder,
        #dbTable::-webkit-input-placeholder,
        #dbUser::-webkit-input-placeholder,
        #dbPassword::-webkit-input-placeholder {
            color: #a0a6b8 !important;
        }

        #createProjectName::-moz-placeholder,
        #createDataQuery::-moz-placeholder,
        #dbHost::-moz-placeholder,
        #dbDatabase::-moz-placeholder,
        #dbTable::-moz-placeholder,
        #dbUser::-moz-placeholder,
        #dbPassword::-moz-placeholder {
            color: #a0a6b8 !important;
            opacity: 1;
        }

        #createProjectName:-ms-input-placeholder,
        #createDataQuery:-ms-input-placeholder,
        #dbHost:-ms-input-placeholder,
        #dbDatabase:-ms-input-placeholder,
        #dbTable:-ms-input-placeholder,
        #dbUser:-ms-input-placeholder,
        #dbPassword:-ms-input-placeholder {
            color: #a0a6b8 !important;
        }

        /* ë©¤ë²„ ê´€ë¦¬ í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .profile-image {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #4a90e2;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .role-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .role-admin { 
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            box-shadow: 0 2px 4px rgba(231, 76, 60, 0.3);
        }
        .role-manager { 
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            box-shadow: 0 2px 4px rgba(46, 204, 113, 0.3);
        }
        .role-user { 
            background: linear-gradient(135deg, #3498db, #2980b9);
            box-shadow: 0 2px 4px rgba(52, 152, 219, 0.3);
        }

        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-enabled { 
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            box-shadow: 0 2px 4px rgba(46, 204, 113, 0.3);
        }
        .status-disabled { 
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            box-shadow: 0 2px 4px rgba(231, 76, 60, 0.3);
        }

        /* ë©”ì¸ ì½˜í…ì¸  */
        .main-content {
            margin-left: 280px;
            min-height: 100vh;
            background: #1a1d29;
            transition: all 0.3s ease;
        }

        .main-content.expanded {
            margin-left: 70px;
        }

        .main-header {
            background: #2d3142;
            padding: 20px 30px;
            border-bottom: 1px solid #3a3f52;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: #ffffff;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #3a3f52;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #a0a6b8;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .header-icon:hover {
            background: #4a90e2;
            color: #ffffff;
        }

        .toggle-btn {
            background: #4a90e2 !important;
            color: #ffffff !important;
        }

        .toggle-btn:hover {
            background: #357abd !important;
        }

        .logout-btn {
            background: #e74c3c !important;
            color: #ffffff !important;
        }

        .logout-btn:hover {
            background: #c0392b !important;
        }

        .profile-btn {
            background: #4a90e2 !important;
            color: #ffffff !important;
        }

        .profile-btn:hover {
            background: #357abd !important;
        }

        .add-button {
            background: #4a90e2;
            color: #ffffff;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .add-button:hover {
            background: #357abd;
            transform: scale(1.1);
        }

        .content-area {
            padding: 30px;
        }

        /* ëŒ€ì‹œë³´ë“œ ì¹´ë“œ */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 18px;
            margin-bottom: 20px;
            padding: 18px;
        }

        .dashboard-card {
            background: linear-gradient(135deg, #2d3142, #3a3f52);
            border: 1px solid #495057;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            border-color: #4a90e2;
        }

        .dashboard-card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: linear-gradient(135deg, #2d3142, #3a3f52);
        }

        .dashboard-card.disabled:hover {
            transform: none;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            border-color: #495057;
        }

        .dashboard-card-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
            color: #4a90e2;
        }

        .dashboard-card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 8px;
        }

        .dashboard-card-description {
            font-size: 0.9rem;
            color: #a0a6b8;
            line-height: 1.4;
        }

        /* ë°˜ì‘í˜• ê·¸ë¦¬ë“œ */
        @media (max-width: 1200px) {
            .dashboard-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
        }

        .card-button {
            background: #4a90e2;
            color: #ffffff;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .card-button:hover {
            background: #357abd;
            transform: translateY(-2px);
        }

        .card-button:disabled {
            background: #3a3f52;
            color: #a0a6b8;
            cursor: not-allowed;
            transform: none;
        }

        /* ë°ì´í„° í…Œì´ë¸” */
        .data-table {
            background: #2d3142;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #3a3f52;
        }

        .table-header {
            background: #3a3f52;
            padding: 20px 25px;
            border-bottom: 1px solid #4a4f62;
        }

        .table-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #ffffff;
        }

        .table {
            margin: 0;
            color: #ffffff;
            background: #2d3142;
        }

        .table td, .table th {
            color: #ffffff;
        }

        .table thead th {
            background: linear-gradient(135deg, #3a3f52, #2d3142);
            border: none;
            color: #ffffff;
            font-weight: 600;
            padding: 18px 20px;
            text-align: center;
            vertical-align: middle;
            border-bottom: 2px solid #4a90e2;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .table tbody td {
            border: none;
            padding: 18px 20px;
            border-bottom: 1px solid #3a3f52;
            vertical-align: middle;
            text-align: center;
            background: #2d3142;
            color: #ffffff;
        }

        .table tbody tr:hover {
            background: linear-gradient(135deg, #3a3f52, #2d3142);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .table tbody tr {
            transition: all 0.3s ease;
        }

        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: #a0a6b8;
        }

        .no-data i {
            font-size: 4rem;
            color: #4a90e2;
            margin-bottom: 20px;
            display: block;
        }

        .no-data h3 {
            color: #ffffff;
            margin-bottom: 10px;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .no-data p {
            color: #a0a6b8;
            font-size: 1rem;
            margin: 0;
        }

        .pagination-container {
            display: flex;
            justify-content: center;
            margin-top: 30px;
        }

        .pagination {
            display: flex;
            list-style: none;
            padding: 0;
            margin: 0;
            gap: 5px;
        }

        .page-item {
            margin: 0;
        }

        .page-link {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px 15px;
            background: #3a3f52;
            color: #a0a6b8;
            text-decoration: none;
            border-radius: 8px;
            border: 1px solid #4a4f62;
            transition: all 0.3s ease;
            min-width: 40px;
            height: 40px;
        }

        .page-link:hover {
            background: #4a90e2;
            color: #ffffff;
            border-color: #4a90e2;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(74, 144, 226, 0.3);
        }

        .page-item.active .page-link {
            background: linear-gradient(135deg, #4a90e2, #357abd);
            color: #ffffff;
            border-color: #4a90e2;
            box-shadow: 0 4px 8px rgba(74, 144, 226, 0.3);
        }

        .page-item.disabled .page-link {
            background: #2d3142;
            color: #4a4f62;
            border-color: #3a3f52;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .page-item.disabled .page-link:hover {
            background: #2d3142;
            color: #4a4f62;
            border-color: #3a3f52;
            transform: none;
            box-shadow: none;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }

        .status-active {
            background: #4a90e2;
        }

        .status-inactive {
            background: #a0a6b8;
        }

        .battery-icon {
            width: 16px;
            height: 8px;
            border: 1px solid #a0a6b8;
            border-radius: 2px;
            position: relative;
            display: inline-block;
        }

        .battery-icon::after {
            content: '';
            position: absolute;
            right: -3px;
            top: 2px;
            width: 2px;
            height: 4px;
            background: #a0a6b8;
            border-radius: 0 1px 1px 0;
        }

        .battery-full {
            background: #2ecc71;
        }

        .battery-medium {
            background: #4a90e2;
        }

        .battery-low {
            background: #f39c12;
        }

        /* ë¡œë”© ëª¨ë‹¬ */
        .modal-content {
            background: #2d3142;
            border: 1px solid #3a3f52;
            color: #ffffff;
        }

        .modal-header {
            border-bottom: 1px solid #3a3f52;
        }

        .btn-close {
            filter: invert(1);
        }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal-content {
            background: #2d3142;
            border: 1px solid #3a3f52;
            color: #ffffff;
        }

        .modal-header {
            border-bottom: 1px solid #3a3f52;
        }

        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.8);
        }

        .modal-backdrop.show {
            opacity: 0.8;
        }

        .info-item {
            margin-bottom: 15px;
        }

        .info-label {
            font-weight: 600;
            color: #a0a6b8;
            margin-bottom: 5px;
            display: block;
        }

        .info-value {
            color: #ffffff;
        }
        
        .info-label-small {
            color: #adb5bd;
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 5px;
            display: block;
        }
        
        .info-value-small {
            color: #ffffff;
            font-size: 13px;
            font-weight: 400;
            background-color: #3a3f52;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #4a4f62;
        }
        
        /* í•„í„° ë²„íŠ¼ í˜¸ë²„ íš¨ê³¼ */
        .summary-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3) !important;
        }
        
        .summary-card.active:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 255, 255, 0.4) !important;
        }

        .progress-container {
            background: #3a3f52;
            border-radius: 5px;
            height: 20px;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(135deg, #4a90e2, #357abd);
            height: 100%;
            transition: width 0.3s ease;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                width: 280px;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .sidebar.collapsed {
                transform: translateX(-100%);
                width: 280px;
            }

            .main-content {
                margin-left: 0;
            }

            .main-content.expanded {
                margin-left: 0;
            }

            .dashboard-cards {
                grid-template-columns: 1fr;
            }
        }

        /* ìˆ¨ê¹€ í´ë˜ìŠ¤ */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- ì‚¬ì´ë“œë°” -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-title">ğŸ² BPE Platform</div>
            <div class="user-profile">
                <div class="user-avatar" onclick="document.getElementById('profileImageInput').click()">
                    <img id="profileImage" 
                         th:src="${userProfileImage != null ? userProfileImage : '/images/default/default-avatar.svg'}" 
                         th:alt="${userName}"
                         style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover; border: 1px solid #4a4f62;">
                    <div class="upload-overlay">
                        <i class="fas fa-camera"></i>
                    </div>
                </div>
                <div class="user-info">
                    <div class="user-username" th:text="${userUsername}">admin</div>
                    <div class="user-name" th:text="${userName}">ê´€ë¦¬ì</div>
                </div>
                <input type="file" id="profileImageInput" accept="image/*" style="display: none;" onchange="uploadProfileImage(this)">
            </div>
        </div>
        
        <ul class="sidebar-menu">
            <li class="menu-item">
                <a class="menu-link active" data-page="dashboard">
                    <i class="fas fa-home menu-icon"></i>
                    <span class="menu-text">ëŒ€ì‹œë³´ë“œ</span>
                </a>
            </li>
            <li class="menu-item">
                <a class="menu-link" data-page="members">
                    <i class="fas fa-users menu-icon"></i>
                    <span class="menu-text">ë©¤ë²„ ê´€ë¦¬</span>
                </a>
            </li>
            <li class="menu-item">
                <a class="menu-link" data-page="report-generate">
                    <i class="fas fa-file-powerpoint menu-icon"></i>
                    <span class="menu-text">ì›”ê°„ ë³´ê³  PPT ìƒì„±</span>
                </a>
            </li>
            <li class="menu-item">
                <a class="menu-link" data-page="data-supply">
                    <i class="fas fa-database menu-icon"></i>
                    <span class="menu-text">ë°ì´í„° ìƒì„±</span>
                </a>
            </li>
            <li class="menu-item">
                <a class="menu-link" data-page="data-supply-api">
                    <i class="fas fa-plug menu-icon"></i>
                    <span class="menu-text">ë°ì´í„° ê³µê¸‰ API ê´€ë¦¬</span>
                </a>
            </li>
            <li class="menu-item">
                <a class="menu-link" data-page="keywords">
                    <i class="fas fa-fire menu-icon"></i>
                    <span class="menu-text">ì‹¤ì‹œê°„ ì£¼ìš” í‚¤ì›Œë“œ</span>
                </a>
            </li>
            <li class="menu-item">
                <a class="menu-link" data-page="data-chatbot">
                    <i class="fas fa-comment-dots menu-icon"></i>
                    <span class="menu-text">ë°ì´í„° ì±—ë´‡</span>
                </a>
            </li>
            <li class="menu-item" th:if="${userRole == 'ADMIN'}">
                <a class="menu-link" data-page="global-assets">
                    <i class="fas fa-globe menu-icon"></i>
                    <span class="menu-text">ê¸€ë¡œë²Œ ìì‚° ë™í–¥</span>
                </a>
            </li>
            <li class="menu-item">
                <a class="menu-link" data-page="settings">
                    <i class="fas fa-cog menu-icon"></i>
                    <span class="menu-text">ì„¤ì •</span>
                </a>
            </li>
        </ul>
        </div>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <div class="main-content">
        <!-- í—¤ë” -->
        <div class="main-header">
            <div style="display: flex; align-items: center; gap: 15px;">
                <div class="header-icon toggle-btn" id="sidebarToggle">
                    <i class="fas fa-bars"></i>
                </div>
                <h1 class="page-title" id="pageTitle">ëŒ€ì‹œë³´ë“œ</h1>
            </div>
            <div class="header-actions">
                <button type="button" class="header-icon profile-btn" title="ê°œì¸ì •ë³´ ìˆ˜ì •" id="headerProfileIcon" style="cursor: pointer;">
                    <i class="fas fa-user"></i>
                </button>
                <form th:action="@{/logout}" method="post" class="d-inline">
                    <button type="submit" class="header-icon logout-btn" title="ë¡œê·¸ì•„ì›ƒ">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </form>
            </div>
        </div>

        <!-- ì½˜í…ì¸  ì˜ì—­ -->
        <div class="content-area">
            <span id="currentUserEmail" th:text="${userEmail}" style="display:none;"></span>
            <span id="currentUserRole" th:text="${userRole}" style="display:none;"></span>
            <!-- ê°œì¸ì •ë³´ ìˆ˜ì • ëª¨ë‹¬ -->
            <div class="modal fade" id="profileEditModal" tabindex="-1" aria-labelledby="profileEditModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content" style="background: #2a2f42; border: 1px solid #4a4f62;">
                        <div class="modal-header" style="border-bottom: 1px solid #4a4f62;">
                            <h5 class="modal-title text-light" id="profileEditModalLabel"><i class="fas fa-user me-2"></i>ê°œì¸ì •ë³´ ìˆ˜ì •</h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body" style="padding: 20px;">
                            <div class="d-flex align-items-center mb-3" style="gap: 16px;">
                                <div style="position: relative; width: 72px; height: 72px;">
                                    <img id="profileEditPreview" src="/images/default/default-avatar.svg" alt="profile" style="width: 72px; height: 72px; border-radius: 50%; object-fit: cover; border: 1px solid #4a4f62; cursor: pointer;">
                                    <button type="button" id="profileEditDeleteBtn" title="í”„ë¡œí•„ ì´ë¯¸ì§€ ì‚­ì œ" style="position: absolute; top: -6px; right: -6px; width: 22px; height: 22px; border-radius: 50%; border: none; background: #dc3545; color: #fff; font-size: 12px; display: none; align-items: center; justify-content: center;">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                <div>
                                    <div class="user-username" id="profileEditUserUsername" th:text="${userUsername}" style="font-size: 0.9rem;">-</div>
                                    <div class="user-name" id="profileEditUserName" th:text="${userName}" style="font-weight: 600;">-</div>
                                </div>
                            </div>
                            <input type="file" id="profileEditFileInput" accept="image/*" style="display:none;">
                            <!-- 1ë‹¨ê³„: ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ -->
                            <div id="profileStepVerify">
                                <div class="mb-3">
                                    <label class="form-label text-light">í˜„ì¬ ë¹„ë°€ë²ˆí˜¸</label>
                                    <input type="password" id="currentPassword" class="form-control" placeholder="ì •ë³´ ìˆ˜ì •ì„ ìœ„í•´ í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" style="background: #3a3f52; border: 1px solid #4a4f62; color: #ffffff;">
                                </div>
                                <div class="d-grid gap-2">
                                    <button type="button" class="btn btn-primary" onclick="verifyCurrentPassword()">
                                        <i class="fas fa-lock-open me-2"></i>í™•ì¸
                                    </button>
                                </div>
                            </div>

                            <!-- 2ë‹¨ê³„: ì •ë³´ ìˆ˜ì • (ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ í›„ í‘œì‹œ) -->
                            <div id="profileStepEdit" style="display:none;">
                                <div class="mb-3">
                                    <label class="form-label text-light">ì´ë¦„</label>
                                    <input type="text" id="editName" class="form-control" placeholder="ì´ë¦„ ë³€ê²½" style="background: #3a3f52; border: 1px solid #4a4f62; color: #ffffff;">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label text-light">ì´ë©”ì¼</label>
                                    <input type="email" id="editEmail" class="form-control" placeholder="ì´ë©”ì¼ ë³€ê²½" style="background: #3a3f52; border: 1px solid #4a4f62; color: #ffffff;">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label text-light">ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
                                    <input type="password" id="editPassword" class="form-control" placeholder="ë³€ê²½ ì‹œì—ë§Œ ì…ë ¥" style="background: #3a3f52; border: 1px solid #4a4f62; color: #ffffff;">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label text-light">ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                                    <input type="password" id="editPasswordConfirm" class="form-control" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥" style="background: #3a3f52; border: 1px solid #4a4f62; color: #ffffff;">
                                </div>
                                <div class="d-grid gap-2"></div>
                            </div>
                        </div>
                        <div class="modal-footer" style="border-top: 1px solid #4a4f62;">
                            <button type="button" id="profileSaveBtn" class="btn btn-success" onclick="saveProfileInfo()" style="display:none;">
                                <i class="fas fa-save me-2"></i>ì €ì¥
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ -->
            <div id="dashboard-page" class="page-content">
                <div class="data-table">
                    <div class="table-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                        <h3 class="table-title">ëŒ€ì‹œë³´ë“œ</h3>
                            <p style="color: #a0a6b8; margin: 0; font-size: 0.9rem;">ë‹¤ì–‘í•œ ëŒ€ì‹œë³´ë“œë¥¼ ë“±ë¡í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
                        </div>
                        <button class="btn btn-primary" onclick="showDashboardAddModal()" style="background: linear-gradient(135deg, #4a90e2, #357abd); border: none; padding: 10px 24px; border-radius: 8px; font-weight: 600; font-size: 0.9rem; box-shadow: 0 4px 8px rgba(74, 144, 226, 0.3); transition: all 0.3s ease; color: #ffffff; white-space: nowrap;">
                            <i class="fas fa-plus me-2"></i>ëŒ€ì‹œë³´ë“œ ì¶”ê°€
                        </button>
        </div>
                    <div class="dashboard-cards" id="dashboardCardsContainer">
                        <!-- DBì—ì„œ ê°€ì ¸ì˜¨ ëŒ€ì‹œë³´ë“œ ì¹´ë“œë“¤ -->
                        <div th:if="${dashboards != null && !dashboards.isEmpty()}" th:each="dashboard : ${dashboards}" class="dashboard-card" 
                             th:data-url="${dashboard.dUrl}"
                             th:data-seq="${dashboard.dSeq}"
                             th:data-order="${dashboard.dOrder}"
                             ondragover="handleDragOver(event)"
                             ondrop="handleDrop(event)"
                             onclick="handleDashboardCardClick(this.dataset.url ? 'enabled' : 'disabled', this.dataset.url || '')"
                             style="position: relative;">
                            <!-- ë“œë˜ê·¸ í•¸ë“¤ (ì™¼ìª½ ìœ„) -->
                            <div class="dashboard-drag-handle" 
                                 draggable="true"
                                 ondragstart="handleDragStart(event)"
                                 ondragend="handleDragEnd(event)"
                                 style="position: absolute; left: 10px; top: 10px; z-index: 10; padding: 6px 10px; border-radius: 50%; background: rgba(74, 144, 226, 0.15); border: 1px solid rgba(74, 144, 226, 0.3); color: #a0a6b8; cursor: grab; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center;"
                                 onmousedown="event.stopPropagation()"
                                 onclick="event.stopPropagation()"
                                 onmouseover="this.style.background='rgba(74, 144, 226, 0.25)'; this.style.borderColor='rgba(74, 144, 226, 0.5)'; this.style.color='#4a90e2';"
                                 onmouseout="this.style.background='rgba(74, 144, 226, 0.15)'; this.style.borderColor='rgba(74, 144, 226, 0.3)'; this.style.color='#a0a6b8';"
                                 title="ë“œë˜ê·¸í•˜ì—¬ ìˆœì„œ ë³€ê²½">
                                <i class="fas fa-grip-vertical"></i>
                            </div>
                            <!-- ì‚­ì œ ë²„íŠ¼ -->
                            <button type="button" 
                                    class="btn btn-sm" 
                                    th:onclick="'deleteDashboard(' + ${dashboard.dSeq} + ', event)'"
                                    style="position: absolute; top: 10px; right: 10px; z-index: 10; padding: 6px 10px; border-radius: 50%; background: rgba(74, 144, 226, 0.15); border: 1px solid rgba(74, 144, 226, 0.3); color: #a0a6b8; cursor: pointer; transition: all 0.3s ease;"
                                    onmouseover="this.style.background='rgba(220, 53, 69, 0.2)'; this.style.borderColor='rgba(220, 53, 69, 0.5)'; this.style.color='#dc3545';"
                                    onmouseout="this.style.background='rgba(74, 144, 226, 0.15)'; this.style.borderColor='rgba(74, 144, 226, 0.3)'; this.style.color='#a0a6b8';"
                                    title="ëŒ€ì‹œë³´ë“œ ì‚­ì œ">
                                <i class="fas fa-times"></i>
                            </button>
                            <div class="dashboard-card-icon">
                                <i th:class="${dashboard.dIcon}"></i>
                            </div>
                            <div class="dashboard-card-title" th:text="${dashboard.dName}">ëŒ€ì‹œë³´ë“œ</div>
                            <div class="dashboard-card-description" th:text="${dashboard.dDescription}">ì„¤ëª…</div>
                        </div>
                        
                        <!-- ëŒ€ì‹œë³´ë“œê°€ ì—†ì„ ë•Œ í‘œì‹œ -->
                        <div th:if="${dashboards == null || dashboards.isEmpty()}" 
                             style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: #a0a6b8;">
                            <div style="font-size: 4rem; margin-bottom: 20px; opacity: 0.5;">
                                <i class="fas fa-inbox"></i>
                            </div>
                            <h3 style="color: #ffffff; margin-bottom: 10px; font-weight: 600;">ë“±ë¡ëœ ëŒ€ì‹œë³´ë“œê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                            <p style="color: #a0a6b8; font-size: 0.9rem; margin-bottom: 30px;">ìœ„ì˜ "ëŒ€ì‹œë³´ë“œ ì¶”ê°€" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ëŒ€ì‹œë³´ë“œë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì›”ê°„ ë³´ê³  PPT ìƒì„± í˜ì´ì§€ -->
            <div id="report-generate-page" class="page-content hidden">
                <div class="data-table">
                    <div class="table-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="flex: 1; min-width: 0;">
                        <h3 class="table-title">ì›”ê°„ ë³´ê³  PPT ìƒì„±</h3>
                            <p style="color: #a0a6b8; margin: 0; font-size: 0.9rem;">Quetta Cluster ì‹œìŠ¤í…œ ìš´ì˜ í˜„í™©ì„ ê¸°ë°˜ìœ¼ë¡œ PowerPoint íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.</p>
                        </div>
                        <div style="flex-shrink: 0; margin-left: 20px;">
                            <button id="pptGenerateBtn" class="card-button" onclick="generateReport()" style="background: linear-gradient(135deg, #4a90e2, #357abd); border: none; padding: 10px 24px; border-radius: 8px; font-weight: 600; font-size: 0.9rem; box-shadow: 0 4px 8px rgba(74, 144, 226, 0.3); transition: all 0.3s ease; color: #ffffff; white-space: nowrap;">
                                <i class="fas fa-download me-2"></i>PPT ìƒì„±
                            </button>
                        </div>
                </div>
                    <div style="padding: 60px; text-align: center;">
                        <div style="font-size: 4rem; color: #4a90e2; margin-bottom: 30px;">
                            <i class="fas fa-file-powerpoint"></i>
                        </div>
                        <h2 style="color: #ffffff; margin-bottom: 10px;">ì›”ê°„ ë³´ê³ ì„œ ìƒì„±</h2>
                        <p style="color: #a0a6b8; font-size: 0.85rem; margin: 0;">PPT ìƒì„±ê¹Œì§€ 1~2ë¶„ ì†Œìš”ë©ë‹ˆë‹¤.</p>
            </div>
        </div>
    </div>

    <!-- ëŒ€ì‹œë³´ë“œ ì¶”ê°€ ëª¨ë‹¬ -->
    <div class="modal fade" id="dashboardAddModal" tabindex="-1" aria-labelledby="dashboardAddModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content" style="background: #2d3142; border: 1px solid #4a4f62;">
                <div class="modal-header" style="border-bottom: 1px solid #4a4f62;">
                    <h5 class="modal-title text-light" id="dashboardAddModalLabel">
                        <i class="fas fa-plus-circle me-2"></i>ëŒ€ì‹œë³´ë“œ ì¶”ê°€
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" style="padding: 30px;">
                    <form id="dashboardAddForm">
                        <!-- ì•„ì´ì½˜ ì„ íƒ -->
                        <div class="info-item mb-4">
                            <label class="info-label">
                                <i class="fas fa-icons me-2"></i>ì•„ì´ì½˜ ì„ íƒ *
                            </label>
                            <div id="emojiSelection" style="display: grid; grid-template-columns: repeat(8, 1fr); gap: 10px; padding: 15px; background: #3a3f52; border: 1px solid #4a4f62; border-radius: 8px; max-height: 200px; overflow-y: auto;">
                                <!-- ì•„ì´ì½˜ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                            </div>
                        </div>

                        <!-- ëŒ€ì‹œë³´ë“œëª… -->
                        <div class="info-item mb-4">
                            <label class="info-label">
                                <i class="fas fa-folder me-2"></i>ëŒ€ì‹œë³´ë“œëª… *
                            </label>
                            <input type="text" id="dashboardName" class="form-control" 
                                   placeholder="ëŒ€ì‹œë³´ë“œëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required
                                   style="background: #3a3f52; border: 1px solid #4a4f62; color: #ffffff;">
                        </div>

                        <!-- ì„¤ëª… -->
                        <div class="info-item mb-4">
                            <label class="info-label">
                                <i class="fas fa-align-left me-2"></i>ì„¤ëª… *
                            </label>
                            <textarea id="dashboardDescription" class="form-control" rows="4" 
                                      placeholder="ëŒ€ì‹œë³´ë“œì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required
                                      style="background: #3a3f52; border: 1px solid #4a4f62; color: #ffffff;"></textarea>
                        </div>

                        <!-- URL -->
                        <div class="info-item mb-4">
                            <label class="info-label">
                                <i class="fas fa-link me-2"></i>URL
                            </label>
                            <input type="text" id="dashboardUrl" class="form-control" 
                                   placeholder="ëŒ€ì‹œë³´ë“œ URLì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: http://192.168.125.69:5601)"
                                   style="background: #3a3f52; border: 1px solid #4a4f62; color: #ffffff;">
                        </div>
                    </form>
                </div>
                <div class="modal-footer" style="border-top: 1px solid #4a4f62;">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-primary" onclick="addDashboardSubmit()">
                        <i class="fas fa-plus me-2"></i>ì¶”ê°€
                        </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ëŒ€ì‹œë³´ë“œ ì„±ê³µ ëª¨ë‹¬ -->
    <div class="modal fade" id="dashboardSuccessModal" tabindex="-1" aria-labelledby="dashboardSuccessModalLabel" aria-hidden="true" style="z-index: 1060;">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background: #2d3142; border: 1px solid #28a745;">
                <div class="modal-header" style="border-bottom: 1px solid #28a745;">
                    <h5 class="modal-title text-light" id="dashboardSuccessModalLabel">
                        <i class="fas fa-check-circle text-success me-2"></i>ì„±ê³µ
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="text-light mb-0" id="dashboardSuccessMessage">
                        ëŒ€ì‹œë³´ë“œê°€ ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.
                    </p>
                </div>
                <div class="modal-footer" style="border-top: 1px solid #4a4f62;">
                    <button type="button" class="btn btn-success" data-bs-dismiss="modal">í™•ì¸</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ëŒ€ì‹œë³´ë“œ ì‹¤íŒ¨ ëª¨ë‹¬ -->
    <div class="modal fade" id="dashboardErrorModal" tabindex="-1" aria-labelledby="dashboardErrorModalLabel" aria-hidden="true" style="z-index: 1060;">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background: #2d3142; border: 1px solid #dc3545;">
                <div class="modal-header" style="border-bottom: 1px solid #dc3545;">
                    <h5 class="modal-title text-light" id="dashboardErrorModalLabel">
                        <i class="fas fa-exclamation-triangle text-danger me-2"></i>ì˜¤ë¥˜ ë°œìƒ
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="text-light mb-0" id="dashboardErrorMessage">
                        ëŒ€ì‹œë³´ë“œ ì²˜ë¦¬ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br>
                        ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.
                    </p>
                </div>
                <div class="modal-footer" style="border-top: 1px solid #4a4f62;">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">í™•ì¸</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ëŒ€ì‹œë³´ë“œ ì‚­ì œ í™•ì¸ ëª¨ë‹¬ -->
    <div class="modal fade" id="dashboardDeleteConfirmModal" tabindex="-1" aria-labelledby="dashboardDeleteConfirmModalLabel" aria-hidden="true" style="z-index: 1060;">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background: #2d3142; border: 1px solid #dc3545;">
                <div class="modal-header" style="border-bottom: 1px solid #dc3545;">
                    <h5 class="modal-title text-light" id="dashboardDeleteConfirmModalLabel">
                        <i class="fas fa-exclamation-circle text-danger me-2"></i>ì‚­ì œ í™•ì¸
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="text-light mb-0">
                        ëŒ€ì‹œë³´ë“œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?
                    </p>
                </div>
                <div class="modal-footer" style="border-top: 1px solid #4a4f62;">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-danger" id="dashboardDeleteConfirmBtn">ì‚­ì œ</button>
                </div>
            </div>
        </div>
    </div>

            <!-- ë°ì´í„° ìƒì„± í˜ì´ì§€ -->
            <div id="data-supply-page" class="page-content hidden">
                <div id="data-supply-content">
                    <!-- ë°ì´í„° ìƒì„± ì½˜í…ì¸ ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
        </div>
            </div>

            <!-- ë°ì´í„° ê³µê¸‰ API ê´€ë¦¬ í˜ì´ì§€ -->
            <div id="data-supply-api-page" class="page-content hidden">
                <div id="data-supply-api-content">
                    <!-- ë°ì´í„° ê³µê¸‰ API ê´€ë¦¬ ì½˜í…ì¸ ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
                </div>
            </div>

            <!-- ì‹¤ì‹œê°„ ì£¼ìš” í‚¤ì›Œë“œ í˜ì´ì§€ -->
            <div id="keywords-page" class="page-content hidden">
                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">ì‹¤ì‹œê°„ ì£¼ìš” í‚¤ì›Œë“œ</h3>
                        <p style="color: #a0a6b8; margin: 0; font-size: 0.9rem;">6ì‹œê°„ë§ˆë‹¤ ì—…ë°ì´íŠ¸ë˜ëŠ” ì£¼ìœ  í•µì‹¬ í‚¤ì›Œë“œ ìƒìœ„ 50ê°œ</p>
                    </div>
                    <div style="padding: 30px;">
                        <div class="row" style="height: calc(100vh - 250px);">
                            <div class="col-md-9" style="height: 100%; display: flex; flex-direction: column;">
                                <h5 style="color: #ffffff; margin-bottom: 15px; font-weight: 600;">
                                    <i class="fas fa-cloud me-2" style="color: #4a90e2;"></i>í‚¤ì›Œë“œ ì›Œë“œ í´ë¼ìš°ë“œ
                                </h5>
                                <div style="background: #2d3142; border: 1px solid #4a4f62; border-radius: 12px; padding: 25px; flex: 1; display: flex; flex-direction: column; overflow: hidden;">
                    <div id="keywordChart" style="flex: 1; position: relative; min-height: 0; max-width: 100%; max-height: 100%;">
                        <canvas id="wordcloudCanvas" style="width: 100%; height: 100%; max-width: 100%; max-height: 100%;"></canvas>
                    </div>
                                </div>
                            </div>
                            <div class="col-md-3" style="height: 100%; display: flex; flex-direction: column;">
                                <h5 style="color: #ffffff; margin-bottom: 15px; font-weight: 600;">
                                    <i class="fas fa-list me-2" style="color: #4a90e2;"></i>í‚¤ì›Œë“œ ìˆœìœ„ ë¦¬ìŠ¤íŠ¸
                                </h5>
                                <div style="background: #2d3142; border: 1px solid #4a4f62; border-radius: 12px; padding: 25px; flex: 1; display: flex; flex-direction: column; overflow: hidden;">
                                    <div id="keywordList" style="flex: 1; overflow-y: auto; overflow-x: hidden;">
                                        <!-- í‚¤ì›Œë“œ ë¦¬ìŠ¤íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì±—ë´‡ í˜ì´ì§€ -->
            <div id="chatbot-page" class="page-content hidden">
                <div class="data-table">
                    <div class="table-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3 class="table-title">ì‹œìŠ¤í…œ ì±—ë´‡</h3>
                            <p style="color: #a0a6b8; margin: 0; font-size: 0.9rem;">ì‹œìŠ¤í…œì— ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ë©´ ì§ˆë¬¸í•˜ì„¸ìš”</p>
                        </div>
                        <button type="button" 
                                id="clearChatBtn"
                                onclick="clearChatMessages()"
                                style="background: linear-gradient(135deg, #6c757d, #5a6268); border: none; border-radius: 8px; padding: 8px 16px; color: #ffffff; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 8px; font-size: 0.9rem;"
                                onmouseover="if(!this.disabled) { this.style.background='linear-gradient(135deg, #5a6268, #495057)'; this.style.transform='translateY(-2px)'; }"
                                onmouseout="if(!this.disabled) { this.style.background='linear-gradient(135deg, #6c757d, #5a6268)'; this.style.transform='translateY(0)'; }">
                            <i class="fas fa-broom"></i>
                            <span>ì±„íŒ… ë¹„ìš°ê¸°</span>
                        </button>
                    </div>
                    <div style="display: flex; flex-direction: column; height: calc(100vh - 200px); padding: 30px;">
                        <!-- ì±„íŒ… ë©”ì‹œì§€ ì˜ì—­ -->
                        <div id="chatMessages" style="flex: 1; overflow-y: auto; background: #2d3142; border-radius: 12px; padding: 20px; margin-bottom: 20px; border: 1px solid #4a4f62; display: flex; flex-direction: column; gap: 15px;">
                            <!-- ì‹œìŠ¤í…œ ì±—ë´‡ í™˜ì˜ ë©”ì‹œì§€ -->
                            <div class="chat-message bot-message">
                                <div class="message-avatar">
                                    <i class="fas fa-robot"></i>
                                </div>
                                <div class="message-content">
                                    <div class="message-bubble bot-bubble">
                                        ì•ˆë…•í•˜ì„¸ìš”! ì‹œìŠ¤í…œ ì±—ë´‡ì…ë‹ˆë‹¤. ì‹œìŠ¤í…œì— ëŒ€í•´ ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ì§ˆë¬¸í•´ì£¼ì„¸ìš”.
                                    </div>
                                    <div class="message-time">ì˜¤ëŠ˜</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ì…ë ¥ ì˜ì—­ -->
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <div style="flex: 1; position: relative;">
                                <input type="text" 
                                       id="chatInput" 
                                       class="form-control" 
                                       placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
                                       style="background: #2d3142; border: 1px solid #4a4f62; color: #ffffff; padding: 12px 50px 12px 15px; border-radius: 25px;"
                                       onkeypress="if(event.key === 'Enter') sendChatMessage()">
                                <button type="button" 
                                        id="sendChatBtn"
                                        onclick="sendChatMessage()"
                                        style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); background: #4a90e2; border: none; border-radius: 50%; width: 40px; height: 40px; color: #ffffff; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center;"
                                        onmouseover="if(!this.disabled) { this.style.background='#357abd'; this.style.transform='translateY(-50%) scale(1.05)'; }"
                                        onmouseout="if(!this.disabled) { this.style.background='#4a90e2'; this.style.transform='translateY(-50%) scale(1)'; }">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>
        </div>
            </div>

            <!-- ë©¤ë²„ ê´€ë¦¬ í˜ì´ì§€ -->
            <div id="members-page" class="page-content hidden">
                <div id="members-content">
                    <!-- ë©¤ë²„ ê´€ë¦¬ ì½˜í…ì¸ ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
                </div>
            </div>


            <div id="data-chatbot-page" class="page-content hidden">
                <div class="data-table">
                    <div class="table-header" style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3 class="table-title">ë°ì´í„° ì±—ë´‡</h3>
                            <p style="color: #a0a6b8; margin: 0; font-size: 0.9rem;">ì†Œì…œ ë°ì´í„°ì— ëŒ€í•œ ì§ˆë¬¸ì„ í•  ìˆ˜ ìˆëŠ” ì±—ë´‡ì…ë‹ˆë‹¤</p>
                        </div>
                        <button type="button" 
                                id="clearDataChatBtn"
                                onclick="clearDataChatMessages()"
                                style="background: linear-gradient(135deg, #6c757d, #5a6268); border: none; border-radius: 8px; padding: 8px 16px; color: #ffffff; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 8px; font-size: 0.9rem;"
                                onmouseover="if(!this.disabled) { this.style.background='linear-gradient(135deg, #5a6268, #495057)'; this.style.transform='translateY(-2px)'; }"
                                onmouseout="if(!this.disabled) { this.style.background='linear-gradient(135deg, #6c757d, #5a6268)'; this.style.transform='translateY(0)'; }">
                            <i class="fas fa-broom"></i>
                            <span>ì±„íŒ… ë¹„ìš°ê¸°</span>
                        </button>
                    </div>
                    <div style="display: flex; flex-direction: column; height: calc(100vh - 200px); padding: 30px;">
                        <!-- ì±„íŒ… ë©”ì‹œì§€ ì˜ì—­ -->
                        <div id="dataChatMessages" style="flex: 1; overflow-y: auto; background: #2d3142; border-radius: 12px; padding: 20px; margin-bottom: 20px; border: 1px solid #4a4f62; display: flex; flex-direction: column; gap: 15px;">
                            <!-- ë°ì´í„° ì±—ë´‡ í™˜ì˜ ë©”ì‹œì§€ -->
                            <div class="chat-message bot-message">
                                <div class="message-avatar">
                                    <i class="fas fa-database"></i>
                                </div>
                                <div class="message-content">
                                    <div class="message-bubble bot-bubble">
                                        ì•ˆë…•í•˜ì„¸ìš”! ë°ì´í„° ì±—ë´‡ì…ë‹ˆë‹¤. ì†Œì…œ ë°ì´í„°ì— ëŒ€í•´ ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹œë©´ ì§ˆë¬¸í•´ì£¼ì„¸ìš”.
                                    </div>
                                    <div class="message-time">ì˜¤ëŠ˜</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ì…ë ¥ ì˜ì—­ -->
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <div style="flex: 1; position: relative;">
                                <input type="text" 
                                       id="dataChatInput" 
                                       class="form-control" 
                                       placeholder="ë°ì´í„°ì— ëŒ€í•œ ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..."
                                       style="background: #2d3142; border: 1px solid #4a4f62; color: #ffffff; padding: 12px 50px 12px 15px; border-radius: 25px;"
                                       onkeypress="if(event.key === 'Enter') sendDataChatMessage()">
                                <button type="button" 
                                        id="sendDataChatBtn"
                                        onclick="sendDataChatMessage()"
                                        style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); background: #4a90e2; border: none; border-radius: 50%; width: 40px; height: 40px; color: #ffffff; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center;"
                                        onmouseover="if(!this.disabled) { this.style.background='#357abd'; this.style.transform='translateY(-50%) scale(1.05)'; }"
                                        onmouseout="if(!this.disabled) { this.style.background='#4a90e2'; this.style.transform='translateY(-50%) scale(1)'; }">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="global-assets-page" class="page-content hidden">
                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">ê¸€ë¡œë²Œ ìì‚° ë™í–¥</h3>
                        <p style="color: #a0a6b8; margin: 0; font-size: 0.9rem;">ì „ ì„¸ê³„ ìì‚° ì‹œì¥ì˜ ë™í–¥ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
                    </div>
                    <div style="padding: 20px;">
                        <!-- 3x2 ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ -->
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(2, 1fr); gap: 20px; height: calc(100vh - 250px);">
                            <!-- ìì‚° 1: BTC/USDT -->
                            <div style="background: #2d3142; border: 1px solid #4a4f62; border-radius: 12px; padding: 20px; display: flex; flex-direction: column;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <h4 style="color: #ffffff; margin: 0; font-size: 1.1rem;">BTC/USDT</h4>
                                    <span id="asset1Status" style="color: #a0a6b8; font-size: 0.85rem;">ë¡œë”© ì¤‘...</span>
                                </div>
                                <div style="flex: 1; position: relative;">
                                    <canvas id="assetChart1"></canvas>
                                </div>
                            </div>
                            
                            <!-- ìì‚° 2: ETH/USDT -->
                            <div style="background: #2d3142; border: 1px solid #4a4f62; border-radius: 12px; padding: 20px; display: flex; flex-direction: column;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <h4 style="color: #ffffff; margin: 0; font-size: 1.1rem;">ETH/USDT</h4>
                                    <span id="asset2Status" style="color: #a0a6b8; font-size: 0.85rem;">ë¡œë”© ì¤‘...</span>
                                </div>
                                <div style="flex: 1; position: relative;">
                                    <canvas id="assetChart2"></canvas>
                                </div>
                            </div>
                            
                            <!-- ìì‚° 3: NASDAQ -->
                            <div style="background: #2d3142; border: 1px solid #4a4f62; border-radius: 12px; padding: 20px; display: flex; flex-direction: column;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <h4 style="color: #ffffff; margin: 0; font-size: 1.1rem;">NASDAQ</h4>
                                    <span id="asset3Status" style="color: #a0a6b8; font-size: 0.85rem;">ë¡œë”© ì¤‘...</span>
                                </div>
                                <div style="flex: 1; position: relative;">
                                    <canvas id="assetChart3"></canvas>
                                </div>
                            </div>
                            
                            <!-- ìì‚° 4: BTC.D -->
                            <div style="background: #2d3142; border: 1px solid #4a4f62; border-radius: 12px; padding: 20px; display: flex; flex-direction: column;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <h4 style="color: #ffffff; margin: 0; font-size: 1.1rem;">BTC.D</h4>
                                    <span id="asset4Status" style="color: #a0a6b8; font-size: 0.85rem;">ë¡œë”© ì¤‘...</span>
                                </div>
                                <div style="flex: 1; position: relative;">
                                    <canvas id="assetChart4"></canvas>
                                </div>
                            </div>
                            
                            <!-- ìì‚° 5: XAU/USD -->
                            <div style="background: #2d3142; border: 1px solid #4a4f62; border-radius: 12px; padding: 20px; display: flex; flex-direction: column;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <h4 style="color: #ffffff; margin: 0; font-size: 1.1rem;">XAU/USD</h4>
                                    <span id="asset5Status" style="color: #a0a6b8; font-size: 0.85rem;">ë¡œë”© ì¤‘...</span>
                                </div>
                                <div style="flex: 1; position: relative;">
                                    <canvas id="assetChart5"></canvas>
                                </div>
                            </div>
                            
                            <!-- ìì‚° 6: USD/KRW -->
                            <div style="background: #2d3142; border: 1px solid #4a4f62; border-radius: 12px; padding: 20px; display: flex; flex-direction: column;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <h4 style="color: #ffffff; margin: 0; font-size: 1.1rem;">USD/KRW</h4>
                                    <span id="asset6Status" style="color: #a0a6b8; font-size: 0.85rem;">ë¡œë”© ì¤‘...</span>
                                </div>
                                <div style="flex: 1; position: relative;">
                                    <canvas id="assetChart6"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="settings-page" class="page-content hidden">
                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">ì„¤ì •</h3>
                </div>
                    <div style="padding: 20px;">
                        <p style="color: #a0a6b8;">ì„¤ì • ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>
        </div>
            </div>

    <!-- ë¡œë”© ëª¨ë‹¬ -->
    <div class="modal fade" id="loadingModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center py-4">
                    <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
                        <span class="visually-hidden">Loading...</span>
                </div>
                    <h5 class="mb-2">ì›”ê°„ ë³´ê³ ì„œ ìƒì„± ì¤‘...</h5>
                    <p class="text-white mb-0">ì„œë²„ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ê³  PowerPoint íŒŒì¼ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
                    <p class="text-white mt-1 mb-0">PPT ìƒì„± ê¹Œì§€ 1~2ë¶„ ì†Œìš”ë©ë‹ˆë‹¤.</p>
                    <div class="progress mt-3" style="height: 6px;">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- í”„ë¡œì íŠ¸ ìƒì„¸ ì •ë³´ ëª¨ë‹¬ -->
    <div class="modal fade" id="projectDetailModal" tabindex="-1" aria-labelledby="projectDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content" style="background: #2a2f42; border: 1px solid #4a4f62;">
                <div class="modal-header" style="border-bottom: 1px solid #4a4f62;">
                    <h5 class="modal-title text-light" id="projectDetailModalLabel">
                        <i class="fas fa-info-circle me-2"></i>í”„ë¡œì íŠ¸ ìƒì„¸ ì •ë³´
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
                <div class="modal-body" style="padding: 30px;">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="info-item mb-4">
                                <label class="info-label">
                                    <i class="fas fa-folder me-2"></i>í”„ë¡œì íŠ¸ëª…
                                </label>
                                <div class="info-value text-light" id="modalProjectName" style="font-size: 16px; font-weight: 500;">-</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="info-item mb-4">
                                <label class="info-label">
                                    <i class="fas fa-user me-2"></i>ì‚¬ìš©ìëª…
                                </label>
                                <div class="info-value text-light" id="modalUserName" style="font-size: 16px; font-weight: 500;">-</div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="info-item mb-4">
                                <label class="info-label">
                                    <i class="fas fa-flag me-2"></i>ìƒíƒœ
                                </label>
                                <div class="info-value text-light" id="modalStatus" style="font-size: 16px; font-weight: 500;">-</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="info-item mb-4">
                                <label class="info-label">
                                    <i class="fas fa-chart-line me-2"></i>ì§„í–‰ë¥ 
                                </label>
                                <div class="progress mb-2" style="height: 30px; background-color: #3a3f52; border-radius: 15px; position: relative;">
                                    <div class="progress-bar" id="modalProgress" role="progressbar" style="width: 0%; border-radius: 15px; transition: all 0.5s ease;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                                        <span id="modalProgressText" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-weight: bold; font-size: 14px; text-shadow: 1px 1px 2px rgba(0,0,0,0.7);">0%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <div class="info-item">
                                <label class="info-label">
                                    <i class="fas fa-code me-2"></i>ì¿¼ë¦¬ ì •ë³´
                                </label>
                                <textarea class="form-control" id="modalQuery" rows="6" style="background-color: #3a3f52; color: #ffffff; border: 1px solid #495057; font-family: monospace; font-size: 13px; border-radius: 8px;" readonly>-</textarea>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ì €ì¥ì†Œ ì •ë³´ ì„¹ì…˜ -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="info-item">
                                <label class="info-label">
                                    <i class="fas fa-database me-2"></i>ì €ì¥ì†Œ ì •ë³´
                                </label>
                                <div class="row mt-3">
                                    <div class="col-md-6 mb-3">
                                        <div class="info-item">
                                            <label class="info-label-small">Host</label>
                                            <div class="info-value-small" id="modalHost">-</div>
                </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <div class="info-item">
                                            <label class="info-label-small">Database</label>
                                            <div class="info-value-small" id="modalDatabase">-</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <div class="info-item">
                                            <label class="info-label-small">Table</label>
                                            <div class="info-value-small" id="modalTable">-</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <div class="info-item">
                                            <label class="info-label-small">User</label>
                                            <div class="info-value-small" id="modalDbUser">-</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" style="border-top: 1px solid #4a4f62;">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
                </div>
            </div>
        </div>
    </div>

    <!-- í”„ë¡œì íŠ¸ ìƒì„± ëª¨ë‹¬ -->
    <div class="modal fade" id="projectCreateModal" tabindex="-1" aria-labelledby="projectCreateModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="projectCreateModalLabel">
                        <i class="fas fa-plus-circle me-2"></i>í”„ë¡œì íŠ¸ ìƒì„±
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="projectCreateForm">
                        <div class="row">
                            <!-- ì™¼ìª½ ì»¬ëŸ¼: í”„ë¡œì íŠ¸ ì •ë³´ -->
                            <div class="col-md-6">
                                <div class="pe-3">
                                    <!-- í”„ë¡œì íŠ¸ëª… -->
                                    <div class="info-item mb-4">
                                        <label class="info-label">
                                            <i class="fas fa-folder me-2"></i>í”„ë¡œì íŠ¸ëª… *
                                        </label>
                                    <input type="text" id="createProjectName" class="form-control" 
                                           placeholder="í”„ë¡œì íŠ¸ëª…ì„ ì…ë ¥í•˜ì„¸ìš” (í•œê¸€ ë¶ˆê°€)" required
                                           pattern="[a-zA-Z0-9_-]+"
                                           oninput="this.value = this.value.replace(/[^a-zA-Z0-9_-]/g, '')"
                                           style="background: #3a3f52; border: 1px solid #4a4f62; color: #ffffff;">
                                </div>

                                    <!-- ë°ì´í„° ì¿¼ë¦¬ -->
                                    <div class="info-item mb-4">
                                        <label class="info-label">
                                            <i class="fas fa-code me-2"></i>ë°ì´í„° ì¿¼ë¦¬ *
                                        </label>
                                    <textarea id="createDataQuery" class="form-control" rows="6" 
                                              placeholder="ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ queryë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: (in_date:[20251001 TO 20251031]) AND (kw_sourcetype:((UT) OR (IG) OR (TW) )))" required
                                              style="background: #3a3f52; border: 1px solid #4a4f62; color: #ffffff; font-family: monospace;"></textarea>
                                </div>

                                    <!-- ë°ì´í„° ì €ì¥ì†Œ ì •ë³´ -->
                                    <div class="info-item">
                                    <label class="info-label">
                                        <i class="fas fa-database me-2"></i>ì €ì¥ì†Œ ì •ë³´
                                    </label>
                                        <div class="row">
                                            <div class="col-12 mb-3">
                                                <label for="dbHost" class="form-label text-light">Host</label>
                                                <input type="text" class="form-control" id="dbHost" name="dbHost" 
                                                       placeholder="ë°ì´í„°ë² ì´ìŠ¤ í˜¸ìŠ¤íŠ¸ (ì˜ˆ: 192.168.125.10)" 
                                                       pattern="[0-9.]+"
                                                       oninput="this.value = this.value.replace(/[^0-9.]/g, '')"
                                                       style="background: #3a3f52; border: 1px solid #4a4f62; color: #ffffff;">
                            </div>
                                            <div class="col-6 mb-3">
                                                <label for="dbDatabase" class="form-label text-light">Database</label>
                                                <input type="text" class="form-control" id="dbDatabase" name="dbDatabase" 
                                                       placeholder="ë°ì´í„°ë² ì´ìŠ¤ëª…" 
                                                       style="background: #3a3f52; border: 1px solid #4a4f62; color: #ffffff;">
                        </div>
                                            <div class="col-6 mb-3">
                                                <label for="dbTable" class="form-label text-light">Table</label>
                                                <input type="text" class="form-control" id="dbTable" name="dbTable" 
                                                       placeholder="í…Œì´ë¸”ëª…" 
                                                       style="background: #3a3f52; border: 1px solid #4a4f62; color: #ffffff;">
                                            </div>
                                            <div class="col-6 mb-3">
                                                <label for="dbUser" class="form-label text-light">User</label>
                                                <input type="text" class="form-control" id="dbUser" name="dbUser" 
                                                       placeholder="ì‚¬ìš©ìëª…" 
                                                       style="background: #3a3f52; border: 1px solid #4a4f62; color: #ffffff;">
                                            </div>
                                            <div class="col-6 mb-3">
                                                <label for="dbPassword" class="form-label text-light">Password</label>
                                                <input type="password" class="form-control" id="dbPassword" name="dbPassword" 
                                                       placeholder="ë¹„ë°€ë²ˆí˜¸" 
                                                       style="background: #3a3f52; border: 1px solid #4a4f62; color: #ffffff;">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ì˜¤ë¥¸ìª½ ì»¬ëŸ¼: ìš”ì²­ í•„ë“œ ëª©ë¡ -->
                            <div class="col-md-6">
                                <div class="ps-3">
                                <div class="info-item">
                                        <label class="info-label">
                                            <i class="fas fa-list-check me-2"></i>ìš”ì²­ í•„ë“œ ëª©ë¡
                                        </label>
                                        
                                        <!-- í•„ë“œ ì„ íƒ ì˜ì—­ -->
                                        <div class="row">
                                            <!-- ì™¼ìª½: ì‚¬ìš© ê°€ëŠ¥í•œ í•„ë“œ -->
                                            <div class="col-6">
                                                <h6 class="text-light mb-2">
                                                    <i class="fas fa-list me-2"></i>ì‚¬ìš© ê°€ëŠ¥í•œ í•„ë“œ
                                                </h6>
                                                <div id="availableFields" class="available-fields-container" 
                                                     style="height: 450px; overflow-y: auto; border: 1px solid #4a4f62; border-radius: 8px; padding: 15px; background: #3a3f52;">
                                                    <p class="text-muted text-center mb-0">
                                                        <i class="fas fa-spinner fa-spin me-2"></i>í•„ë“œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                                                    </p>
                                                </div>
                                            </div>
                                            
                                            <!-- ì˜¤ë¥¸ìª½: ì„ íƒëœ í•„ë“œ -->
                                            <div class="col-6">
                                                <h6 class="text-light mb-2">
                                                    <i class="fas fa-check-circle me-2"></i>ì„ íƒëœ í•„ë“œ
                                                </h6>
                                                <div id="selectedFields" class="selected-fields-container" 
                                                     style="height: 450px; overflow-y: auto; border: 1px solid #6c757d; border-radius: 8px; padding: 15px; background: #1a1f32;">
                                                    <p class="text-muted text-center mb-0">
                                                        <i class="fas fa-arrow-left me-2"></i>í•„ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- í•„ë“œ ì´ë™ ë²„íŠ¼ë“¤ -->
                                        <div class="text-center mt-3">
                                            <button type="button" class="btn btn-sm btn-outline-primary me-2" onclick="moveAllToSelected()">
                                                <i class="fas fa-angle-double-right me-1"></i>ì „ì²´ ì„ íƒ
                                            </button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary me-2" onclick="moveAllToAvailable()">
                                                <i class="fas fa-angle-double-left me-1"></i>ì „ì²´ í•´ì œ
                                            </button>
                                            <button type="button" class="btn btn-sm btn-outline-info" onclick="clearAllSelections()">
                                                <i class="fas fa-refresh me-1"></i>ì´ˆê¸°í™”
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" id="projectCreateCancelBtn" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-primary" id="projectCreateSubmitBtn" onclick="createProjectSubmit()" disabled style="opacity: 0.5; cursor: not-allowed;">
                        <i class="fas fa-save me-2"></i>í”„ë¡œì íŠ¸ ìƒì„±
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- í”„ë¡œì íŠ¸ ìƒì„± ì¤‘ ë¡œë”© ëª¨ë‹¬ (ëª¨ë‹¬ ìœ„ì— í‘œì‹œ) -->
    <div class="modal fade" id="projectCreateLoadingModal" tabindex="-1" aria-labelledby="projectCreateLoadingModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered" style="z-index: 1060;">
            <div class="modal-content" style="background: #2d3142; border: 1px solid #4a4f62;">
                <div class="modal-body text-center py-4">
                    <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <h5 class="text-light mb-0">í”„ë¡œì íŠ¸ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...</h5>
                    <p class="text-muted mt-2 mb-0">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- í”„ë¡œì íŠ¸ ìƒì„± ê²½ê³  ëª¨ë‹¬ (ëª¨ë‹¬ ìœ„ì— í‘œì‹œ) -->
    <div class="modal fade" id="projectCreateWarningModal" tabindex="-1" aria-labelledby="projectCreateWarningModalLabel" aria-hidden="true" style="z-index: 1060;">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background: #2d3142; border: 1px solid #ffc107;">
                <div class="modal-header" style="border-bottom: 1px solid #ffc107;">
                    <h5 class="modal-title text-light" id="projectCreateWarningModalLabel">
                        <i class="fas fa-exclamation-circle text-warning me-2"></i>ì…ë ¥ í™•ì¸
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="text-light mb-0" id="projectCreateWarningMessage">
                        í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.
                    </p>
                </div>
                <div class="modal-footer" style="border-top: 1px solid #4a4f62;">
                    <button type="button" class="btn btn-warning" data-bs-dismiss="modal">í™•ì¸</button>
                </div>
            </div>
        </div>
    </div>

    <!-- í”„ë¡œì íŠ¸ ìƒì„± ì—ëŸ¬ ëª¨ë‹¬ (ëª¨ë‹¬ ìœ„ì— í‘œì‹œ) -->
    <div class="modal fade" id="projectCreateErrorModal" tabindex="-1" aria-labelledby="projectCreateErrorModalLabel" aria-hidden="true" style="z-index: 1060;">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background: #2d3142; border: 1px solid #dc3545;">
                <div class="modal-header" style="border-bottom: 1px solid #dc3545;">
                    <h5 class="modal-title text-light" id="projectCreateErrorModalLabel">
                        <i class="fas fa-exclamation-triangle text-danger me-2"></i>ì˜¤ë¥˜ ë°œìƒ
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="text-light mb-0" id="projectCreateErrorMessage">
                        í”„ë¡œì íŠ¸ ìƒì„± ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br>
                        ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.
                    </p>
                </div>
                <div class="modal-footer" style="border-top: 1px solid #4a4f62;">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">í™•ì¸</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ë°ì´í„° ê³µê¸‰ API ê´€ë¦¬ í”„ë¡œì íŠ¸ ìƒì„¸ ëª¨ë‹¬ -->
    <div class="modal fade" id="apiProjectDetailModal" tabindex="-1" aria-labelledby="apiProjectDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable" style="max-width: 600px;">
            <div class="modal-content" style="background: #2a2f42; border: 1px solid #4a4f62;">
                <div class="modal-header" style="border-bottom: 1px solid #4a4f62;">
                    <h5 class="modal-title text-light" id="apiProjectDetailModalLabel">
                        <i class="fas fa-info-circle me-2"></i>í”„ë¡œì íŠ¸ ìƒì„¸ ì •ë³´
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" style="padding: 30px;">
                    <form id="apiProjectDetailForm">
                        <!-- API_SUPPLY_COMPANY ì„¹ì…˜ -->
                        <div class="mb-4">
                            <h6 class="text-light mb-3" style="border-bottom: 1px solid #4a4f62; padding-bottom: 10px;">
                                <i class="fas fa-building me-2"></i>í”„ë¡œì íŠ¸ ì •ë³´
                            </h6>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">í”„ë¡œì íŠ¸ëª…</label>
                                <input type="text" class="form-control" id="apiModalComName" style="background: #3a3f52; border: 1px solid #495057; color: #ffffff; max-width: 100%;">
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">ê³ ìœ í‚¤</label>
                                <input type="text" class="form-control" id="apiModalComKey" readonly style="background: #2d3142; border: 1px solid #495057; color: #a0a6b8; max-width: 100%;">
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">í”„ë¡œì íŠ¸ ì‹œì‘ ë‚ ì§œ</label>
                                <input type="date" class="form-control" id="apiModalStartDate" max="9999-12-31" style="background: #3a3f52; border: 1px solid #495057; color: #ffffff; max-width: 100%;">
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">í”„ë¡œì íŠ¸ ì¢…ë£Œ ë‚ ì§œ</label>
                                <input type="date" class="form-control" id="apiModalEndDate" max="9999-12-31" style="background: #3a3f52; border: 1px solid #495057; color: #ffffff; max-width: 100%;">
                            </div>
                        </div>

                        <!-- API_SUPPLY_SYSTEM ì„¹ì…˜ -->
                        <div class="mb-4">
                            <h6 class="text-light mb-3" style="border-bottom: 1px solid #4a4f62; padding-bottom: 10px;">
                                <i class="fas fa-cog me-2"></i>ì‹œìŠ¤í…œ ì„¤ì •
                            </h6>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">ê²€ìƒ‰ ì‹œì‘ ê°€ëŠ¥ ë‚ ì§œ</label>
                                <input type="number" class="form-control" id="apiModalSearchStartDate" max="99999999" style="background: #3a3f52; border: 1px solid #495057; color: #ffffff; max-width: 100%;" oninput="if(this.value.length > 8) this.value = this.value.slice(0, 8);">
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">ê²€ìƒ‰ ë‚ ì§œ ìµœëŒ€ ë²”ìœ„</label>
                                <input type="number" class="form-control" id="apiModalSearchDateDiff" style="background: #3a3f52; border: 1px solid #495057; color: #ffffff; max-width: 100%;">
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">ê²€ìƒ‰ ì‹œì‘ ë‚ ì§œ ë™ì  ë³€ê²½ ì‚¬ìš© ì—¬ë¶€</label>
                                <div class="d-flex gap-3 mt-2">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="apiModalUpdateSearchDateYn" id="apiModalUpdateSearchDateYnY" value="Y">
                                        <label class="form-check-label text-light" for="apiModalUpdateSearchDateYnY" style="cursor: pointer;">Y</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="apiModalUpdateSearchDateYn" id="apiModalUpdateSearchDateYnN" value="N">
                                        <label class="form-check-label text-light" for="apiModalUpdateSearchDateYnN" style="cursor: pointer;">N</label>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">ê²€ìƒ‰ ì‹œì‘ ë‚ ì§œ ì˜¤í”„ì…‹</label>
                                <input type="number" class="form-control" id="apiModalUpdateSearchDateOffset" style="background: #3a3f52; border: 1px solid #495057; color: #ffffff; max-width: 100%;">
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">ê²€ìƒ‰ê°€ëŠ¥í•œ ë¬¸ìì—´ Byte í¬ê¸°</label>
                                <input type="number" class="form-control" id="apiModalSearchByteLength" style="background: #3a3f52; border: 1px solid #495057; color: #ffffff; max-width: 100%;">
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">ë¬¸ì„œ ê²€ìƒ‰ ìˆ˜ ì œí•œ ì‚¬ìš©ì—¬ë¶€</label>
                                <div class="d-flex gap-3 mt-2">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="apiModalSearchCountYn" id="apiModalSearchCountYnY" value="Y">
                                        <label class="form-check-label text-light" for="apiModalSearchCountYnY" style="cursor: pointer;">Y</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="apiModalSearchCountYn" id="apiModalSearchCountYnN" value="N">
                                        <label class="form-check-label text-light" for="apiModalSearchCountYnN" style="cursor: pointer;">N</label>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">ì¼ë³„ ë¬¸ì„œ ìµœëŒ€ ê²€ìƒ‰ ìˆ˜</label>
                                <input type="number" class="form-control" id="apiModalDailySearchTotalCount" style="background: #3a3f52; border: 1px solid #495057; color: #ffffff; max-width: 100%;">
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">ì›”ë³„ ë¬¸ì„œ ìµœëŒ€ ê²€ìƒ‰ ìˆ˜</label>
                                <input type="number" class="form-control" id="apiModalMonthlySearchTotalCount" style="background: #3a3f52; border: 1px solid #495057; color: #ffffff; max-width: 100%;">
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">ì¼ë³„ í˜¸ì¶œ ìµœëŒ€ ìˆ˜ëŸ‰</label>
                                <input type="number" class="form-control" id="apiModalDailyTotalCount" style="background: #3a3f52; border: 1px solid #495057; color: #ffffff; max-width: 100%;">
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">ì›”ë³„ í˜¸ì¶œ ìµœëŒ€ ìˆ˜ëŸ‰</label>
                                <input type="number" class="form-control" id="apiModalMonthlyTotalCount" style="background: #3a3f52; border: 1px solid #495057; color: #ffffff; max-width: 100%;">
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">ì‚¬ìš© ê°€ëŠ¥ cmd ëª©ë¡</label>
                                <input type="text" class="form-control" id="apiModalCommand" style="background: #3a3f52; border: 1px solid #495057; color: #ffffff; max-width: 100%;">
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">ì½”ëª¨ë€ ì‚¬ìš© ì—¬ë¶€</label>
                                <div class="d-flex gap-3 mt-2">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="apiModalKomoranYn" id="apiModalKomoranYnY" value="Y">
                                        <label class="form-check-label text-light" for="apiModalKomoranYnY" style="cursor: pointer;">Y</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="apiModalKomoranYn" id="apiModalKomoranYnN" value="N">
                                        <label class="form-check-label text-light" for="apiModalKomoranYnN" style="cursor: pointer;">N</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- API_SUPPLY_HOST ì„¹ì…˜ -->
                        <div class="mb-4">
                            <h6 class="text-light mb-3" style="border-bottom: 1px solid #4a4f62; padding-bottom: 10px;">
                                <i class="fas fa-server me-2"></i>ì ‘ì† ê°€ëŠ¥ IP
                            </h6>
                            <div id="apiModalHostsContainer">
                                <!-- ë™ì ìœ¼ë¡œ IP ì…ë ¥ í•„ë“œê°€ ì¶”ê°€ë¨ -->
                            </div>
                            <button type="button" class="btn btn-sm btn-outline-primary mt-2" onclick="addApiHostInput()" style="border-color: #4a90e2; color: #4a90e2;">
                                <i class="fas fa-plus me-1"></i>IP ì¶”ê°€
                            </button>
                        </div>
                    </form>
                </div>
                <div class="modal-footer" style="border-top: 1px solid #4a4f62;">
                    <button type="button" class="btn btn-secondary" id="apiModalCancelBtn" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-primary" id="apiModalUpdateBtn" onclick="updateApiProject()" style="background: linear-gradient(135deg, #4a90e2, #357abd); border: none;">
                        <i class="fas fa-save me-2"></i>ìˆ˜ì •
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ë°ì´í„° ê³µê¸‰ API ê´€ë¦¬ í”„ë¡œì íŠ¸ ì¶”ê°€ ëª¨ë‹¬ -->
    <div class="modal fade" id="apiProjectAddModal" tabindex="-1" aria-labelledby="apiProjectAddModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable" style="max-width: 600px;">
            <div class="modal-content" style="background: #2a2f42; border: 1px solid #4a4f62;">
                <div class="modal-header" style="border-bottom: 1px solid #4a4f62;">
                    <h5 class="modal-title text-light" id="apiProjectAddModalLabel">
                        <i class="fas fa-plus-circle me-2"></i>í”„ë¡œì íŠ¸ ì¶”ê°€
                    </h5>
                    <button type="button" class="btn-close btn-close-white" id="apiAddModalCloseBtn" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" style="padding: 20px;">
                    <form id="apiProjectAddForm">
                        <!-- API_SUPPLY_COMPANY ì„¹ì…˜ -->
                        <div class="mb-4">
                            <h6 class="text-light mb-3" style="border-bottom: 1px solid #4a4f62; padding-bottom: 10px;">
                                <i class="fas fa-building me-2"></i>í”„ë¡œì íŠ¸ ì •ë³´
                            </h6>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">í”„ë¡œì íŠ¸ëª…</label>
                                <input type="text" class="form-control" id="apiAddModalComName" style="background: #3a3f52; border: 1px solid #495057; color: #ffffff; max-width: 100%;">
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">ê³ ìœ í‚¤</label>
                                <input type="text" class="form-control" id="apiAddModalComKey" readonly style="background: #2d3142; border: 1px solid #495057; color: #a0a6b8; max-width: 100%;">
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">í”„ë¡œì íŠ¸ ì‹œì‘ ë‚ ì§œ</label>
                                <input type="date" class="form-control" id="apiAddModalStartDate" max="9999-12-31" style="background: #3a3f52; border: 1px solid #495057; color: #ffffff; max-width: 100%;">
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">í”„ë¡œì íŠ¸ ì¢…ë£Œ ë‚ ì§œ</label>
                                <input type="date" class="form-control" id="apiAddModalEndDate" max="9999-12-31" style="background: #3a3f52; border: 1px solid #495057; color: #ffffff; max-width: 100%;">
                            </div>
                        </div>

                        <!-- API_SUPPLY_SYSTEM ì„¹ì…˜ -->
                        <div class="mb-4">
                            <h6 class="text-light mb-3" style="border-bottom: 1px solid #4a4f62; padding-bottom: 10px;">
                                <i class="fas fa-cog me-2"></i>ì‹œìŠ¤í…œ ì„¤ì •
                            </h6>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">ê²€ìƒ‰ ì‹œì‘ ê°€ëŠ¥ ë‚ ì§œ</label>
                                <input type="number" class="form-control" id="apiAddModalSearchStartDate" placeholder="20250101" max="99999999" style="background: #3a3f52; border: 1px solid #495057; color: #ffffff; max-width: 100%;" oninput="if(this.value.length > 8) this.value = this.value.slice(0, 8);">
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">ê²€ìƒ‰ ë‚ ì§œ ìµœëŒ€ ë²”ìœ„</label>
                                <input type="number" class="form-control" id="apiAddModalSearchDateDiff" placeholder="31" style="background: #3a3f52; border: 1px solid #495057; color: #ffffff; max-width: 100%;">
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">ê²€ìƒ‰ ì‹œì‘ ë‚ ì§œ ë™ì  ë³€ê²½ ì‚¬ìš© ì—¬ë¶€</label>
                                <div class="d-flex gap-3 mt-2">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="apiAddModalUpdateSearchDateYn" id="apiAddModalUpdateSearchDateYnY" value="Y">
                                        <label class="form-check-label text-light" for="apiAddModalUpdateSearchDateYnY" style="cursor: pointer;">Y</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="apiAddModalUpdateSearchDateYn" id="apiAddModalUpdateSearchDateYnN" value="N" checked>
                                        <label class="form-check-label text-light" for="apiAddModalUpdateSearchDateYnN" style="cursor: pointer;">N</label>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">ê²€ìƒ‰ ì‹œì‘ ë‚ ì§œ ì˜¤í”„ì…‹</label>
                                <input type="number" class="form-control" id="apiAddModalUpdateSearchDateOffset" placeholder="31" style="background: #3a3f52; border: 1px solid #495057; color: #ffffff; max-width: 100%;">
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">ê²€ìƒ‰ê°€ëŠ¥í•œ ë¬¸ìì—´ Byte í¬ê¸°</label>
                                <input type="number" class="form-control" id="apiAddModalSearchByteLength" placeholder="2048" style="background: #3a3f52; border: 1px solid #495057; color: #ffffff; max-width: 100%;">
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">ë¬¸ì„œ ê²€ìƒ‰ ìˆ˜ ì œí•œ ì‚¬ìš©ì—¬ë¶€</label>
                                <div class="d-flex gap-3 mt-2">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="apiAddModalSearchCountYn" id="apiAddModalSearchCountYnY" value="Y">
                                        <label class="form-check-label text-light" for="apiAddModalSearchCountYnY" style="cursor: pointer;">Y</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="apiAddModalSearchCountYn" id="apiAddModalSearchCountYnN" value="N" checked>
                                        <label class="form-check-label text-light" for="apiAddModalSearchCountYnN" style="cursor: pointer;">N</label>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">ì¼ë³„ ë¬¸ì„œ ìµœëŒ€ ê²€ìƒ‰ ìˆ˜</label>
                                <input type="number" class="form-control" id="apiAddModalDailySearchTotalCount" style="background: #3a3f52; border: 1px solid #495057; color: #ffffff; max-width: 100%;">
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">ì›”ë³„ ë¬¸ì„œ ìµœëŒ€ ê²€ìƒ‰ ìˆ˜</label>
                                <input type="number" class="form-control" id="apiAddModalMonthlySearchTotalCount" style="background: #3a3f52; border: 1px solid #495057; color: #ffffff; max-width: 100%;">
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">ì¼ë³„ í˜¸ì¶œ ìµœëŒ€ ìˆ˜ëŸ‰</label>
                                <input type="number" class="form-control" id="apiAddModalDailyTotalCount" placeholder="100" style="background: #3a3f52; border: 1px solid #495057; color: #ffffff; max-width: 100%;">
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">ì›”ë³„ í˜¸ì¶œ ìµœëŒ€ ìˆ˜ëŸ‰</label>
                                <input type="number" class="form-control" id="apiAddModalMonthlyTotalCount" placeholder="3100" style="background: #3a3f52; border: 1px solid #495057; color: #ffffff; max-width: 100%;">
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">ì‚¬ìš© ê°€ëŠ¥ cmd ëª©ë¡</label>
                                <input type="text" class="form-control" id="apiAddModalCommand" placeholder="search" style="background: #3a3f52; border: 1px solid #495057; color: #ffffff; max-width: 100%;">
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-light" style="font-weight: 600;">ì½”ëª¨ë€ ì‚¬ìš© ì—¬ë¶€</label>
                                <div class="d-flex gap-3 mt-2">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="apiAddModalKomoranYn" id="apiAddModalKomoranYnY" value="Y" checked>
                                        <label class="form-check-label text-light" for="apiAddModalKomoranYnY" style="cursor: pointer;">Y</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="apiAddModalKomoranYn" id="apiAddModalKomoranYnN" value="N">
                                        <label class="form-check-label text-light" for="apiAddModalKomoranYnN" style="cursor: pointer;">N</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- API_SUPPLY_HOST ì„¹ì…˜ -->
                        <div class="mb-4">
                            <h6 class="text-light mb-3" style="border-bottom: 1px solid #4a4f62; padding-bottom: 10px;">
                                <i class="fas fa-server me-2"></i>ì ‘ì† ê°€ëŠ¥ IP
                            </h6>
                            <div id="apiAddModalHostsContainer">
                                <!-- ë™ì ìœ¼ë¡œ IP ì…ë ¥ í•„ë“œê°€ ì¶”ê°€ë¨ -->
                            </div>
                            <button type="button" class="btn btn-sm btn-outline-primary mt-2" id="apiAddModalAddHostBtn" onclick="addApiAddHostInput()" style="border-color: #4a90e2; color: #4a90e2;">
                                <i class="fas fa-plus me-1"></i>IP ì¶”ê°€
                            </button>
                        </div>
                    </form>
                </div>
                <div class="modal-footer" style="border-top: 1px solid #4a4f62;">
                    <button type="button" class="btn btn-secondary" id="apiAddModalCancelBtn" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-primary" id="apiAddModalAddBtn" onclick="addApiProject()" style="background: linear-gradient(135deg, #4a90e2, #357abd); border: none;">
                        <i class="fas fa-plus me-2"></i>ì¶”ê°€
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- í”„ë¡œì íŠ¸ ì¶”ê°€ ì„±ê³µ ëª¨ë‹¬ -->
    <div class="modal fade" id="apiProjectAddSuccessModal" tabindex="-1" aria-labelledby="apiProjectAddSuccessModalLabel" aria-hidden="true" style="z-index: 1060;">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background: #2d3142; border: 1px solid #28a745;">
                <div class="modal-header" style="border-bottom: 1px solid #28a745;">
                    <h5 class="modal-title text-light" id="apiProjectAddSuccessModalLabel">
                        <i class="fas fa-check-circle text-success me-2"></i>í”„ë¡œì íŠ¸ ì¶”ê°€ ì™„ë£Œ
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="text-light mb-0" id="apiProjectAddSuccessMessage">
                        í”„ë¡œì íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.
                    </p>
                </div>
                <div class="modal-footer" style="border-top: 1px solid #4a4f62;">
                    <button type="button" class="btn btn-success" data-bs-dismiss="modal">í™•ì¸</button>
                </div>
            </div>
        </div>
    </div>

    <!-- í”„ë¡œì íŠ¸ ì¶”ê°€ ì—ëŸ¬ ëª¨ë‹¬ -->
    <div class="modal fade" id="apiProjectAddErrorModal" tabindex="-1" aria-labelledby="apiProjectAddErrorModalLabel" aria-hidden="true" style="z-index: 1060;">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background: #2d3142; border: 1px solid #dc3545;">
                <div class="modal-header" style="border-bottom: 1px solid #dc3545;">
                    <h5 class="modal-title text-light" id="apiProjectAddErrorModalLabel">
                        <i class="fas fa-exclamation-triangle text-danger me-2"></i>ì˜¤ë¥˜ ë°œìƒ
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="text-light mb-0" id="apiProjectAddErrorMessage">
                        í”„ë¡œì íŠ¸ ì¶”ê°€ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
                    </p>
                </div>
                <div class="modal-footer" style="border-top: 1px solid #4a4f62;">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">í™•ì¸</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // í˜ì´ì§€ ì „í™˜ í•¨ìˆ˜
        function showPage(pageId) {
            // ëª¨ë“  í˜ì´ì§€ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.add('hidden');
            });
            
            // ì„ íƒëœ í˜ì´ì§€ ë³´ì´ê¸°
            const targetPage = document.getElementById(pageId + '-page');
            if (targetPage) {
                targetPage.classList.remove('hidden');
            }
            
            // ë©”ë‰´ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.menu-link').forEach(link => {
                link.classList.remove('active');
            });
            
            const activeLink = document.querySelector(`[data-page="${pageId}"]`);
            if (activeLink) {
                activeLink.classList.add('active');
            }

            // ê¶Œí•œì— ë”°ë¥¸ PPT ìƒì„± ë²„íŠ¼ í™œì„±/ë¹„í™œì„±
            if (pageId === 'report-generate') {
                const roleEl = document.getElementById('currentUserRole');
                const role = roleEl ? (roleEl.textContent || '').toUpperCase() : '';
                const btn = document.getElementById('pptGenerateBtn');
                if (btn) {
                    const enabled = role === 'ADMIN' || role === 'MANAGER';
                    btn.disabled = !enabled;
                    btn.style.opacity = enabled ? '1' : '0.5';
                    btn.style.cursor = enabled ? 'pointer' : 'not-allowed';
                }
            }
            
            // ì±—ë´‡ í˜ì´ì§€ì¸ ê²½ìš° ES ì—°ê²° ìƒíƒœ í™•ì¸
            if (pageId === 'chatbot') {
                checkElasticsearchConnection();
            }
            
            // ì‹¤ì‹œê°„ ì£¼ìš” í‚¤ì›Œë“œ í˜ì´ì§€ì¸ ê²½ìš° ì½˜í…ì¸  ë¡œë“œ
            if (pageId === 'keywords') {
                // WordCloud2.js ë¡œë“œ í™•ì¸ í›„ ì‹¤í–‰
                if (typeof WordCloud !== 'undefined') {
                    loadKeywordsContent();
                } else {
                    // ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ëŒ€ê¸°
                    setTimeout(() => {
                        if (typeof WordCloud !== 'undefined') {
                            loadKeywordsContent();
                        } else {
                            console.error('WordCloud2.jsê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                            const keywordsPage = document.getElementById('keywords-page');
                            if (keywordsPage) {
                                const chartDiv = document.getElementById('keywordChart');
                                if (chartDiv) {
                                    chartDiv.innerHTML = '<div style="color: #e74c3c; text-align: center; padding: 50px;">ì›Œë“œ í´ë¼ìš°ë“œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.</div>';
                                }
                            }
                        }
                    }, 500);
                }
            }
            
            // í˜ì´ì§€ ì œëª© ì—…ë°ì´íŠ¸
            const pageTitles = {
                'dashboard': 'ëŒ€ì‹œë³´ë“œ',
                'members': 'ë©¤ë²„ ê´€ë¦¬',
                'report-generate': 'ì›”ê°„ ë³´ê³  PPT ìƒì„±',
                'data-supply': 'ë°ì´í„° ìƒì„±',
                'data-supply-api': 'ë°ì´í„° ê³µê¸‰ API ê´€ë¦¬',
                'keywords': 'ì‹¤ì‹œê°„ ì£¼ìš” í‚¤ì›Œë“œ',
                'data-chatbot': 'ë°ì´í„° ì±—ë´‡',
                'global-assets': 'ê¸€ë¡œë²Œ ìì‚° ë™í–¥',
                'settings': 'ì„¤ì •'
            };
            
            document.getElementById('pageTitle').textContent = pageTitles[pageId] || 'ëŒ€ì‹œë³´ë“œ';
            
            // ë°ì´í„° ìƒì„± í˜ì´ì§€ì¸ ê²½ìš° ì½˜í…ì¸  ë¡œë“œ
            if (pageId === 'data-supply') {
                loadDataSupplyContent();
            }
            
            // ë°ì´í„° ê³µê¸‰ API ê´€ë¦¬ í˜ì´ì§€ì¸ ê²½ìš° ì½˜í…ì¸  ë¡œë“œ
            if (pageId === 'data-supply-api') {
                loadDataSupplyApiContent();
            }
            
            // ë©¤ë²„ ê´€ë¦¬ í˜ì´ì§€ì¸ ê²½ìš° ì½˜í…ì¸  ë¡œë“œ
            if (pageId === 'members') {
                loadMembersContent();
            }
            
            // ê¸€ë¡œë²Œ ìì‚° ë™í–¥ í˜ì´ì§€ì¸ ê²½ìš° ì°¨íŠ¸ ë¡œë“œ
            if (pageId === 'global-assets') {
                loadGlobalAssetsCharts();
            } else {
                // ë‹¤ë¥¸ í˜ì´ì§€ë¡œ ì´ë™í•  ë•Œ ì¸í„°ë²Œ ì •ë¦¬
                if (globalAssetsUpdateInterval) {
                    clearInterval(globalAssetsUpdateInterval);
                    globalAssetsUpdateInterval = null;
                }
            }
        }
        
        // ë°ì´í„° ìƒì„± ì½˜í…ì¸  ë¡œë“œ í•¨ìˆ˜
        function loadDataSupplyContent(page = 0) {
            const contentDiv = document.getElementById('data-supply-content');
            
            // ë¡œë”© í‘œì‹œ
            contentDiv.innerHTML = `
                <div style="text-align: center; padding: 60px;">
                    <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p style="color: #a0a6b8; font-size: 1.1rem;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>
            `;
            
            // í•„í„° ìƒíƒœ í™•ì¸
            const filterStatus = window.currentFilterStatus || '';
            let url = `/data/api/supply?page=${page}&size=10`;
            if (filterStatus && filterStatus !== 'all') {
                url += `&status=${encodeURIComponent(filterStatus)}`;
            }
            
            // AJAXë¡œ ë°ì´í„° ìƒì„± í˜ì´ì§€ ì½˜í…ì¸  ë¡œë“œ
            fetch(url, {
                credentials: 'same-origin',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        throw new Error(data.error);
                    }
                    
                    // í†µê³„ ì¹´ë“œ ìƒì„±
                    const statusCounts = data.statusCounts || {};
                    // í˜„ì¬ í•„í„° ìƒíƒœ í™•ì¸
                    const currentFilter = window.currentFilterStatus || '';
                    
                    
                    const summaryCardsHtml = `
                        <div class="summary-cards" style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; margin-bottom: 15px;">
                            <div class="summary-card total-card ${currentFilter === '' ? 'active' : ''}" onclick="filterByStatus('')" style="background: linear-gradient(135deg, #4a90e2, #357abd); border: 2px solid ${currentFilter === '' ? '#ffffff' : '#4a90e2'}; border-radius: 8px; padding: 12px; cursor: pointer; transition: all 0.3s ease; position: relative; box-shadow: ${currentFilter === '' ? '0 0 20px rgba(255, 255, 255, 0.3)' : 'none'};">
                                <h3 style="font-size: 0.75rem; color: #ffffff; margin-bottom: 6px; font-weight: 600;">ì „ì²´ ì‘ì—…</h3>
                                <div class="number" style="font-size: 1.4rem; font-weight: 700; color: #ffffff;">${statusCounts.total || 0}</div>
                                ${currentFilter === '' ? '<div style="position: absolute; top: 6px; right: 6px; color: #ffffff; font-size: 0.9rem;">âœ“</div>' : ''}
                            </div>
                            <div class="summary-card completed-card ${currentFilter === 'C' ? 'active' : ''}" onclick="filterByStatus('C')" style="background: linear-gradient(135deg, #27ae60, #229954); border: 2px solid ${currentFilter === 'C' ? '#ffffff' : '#27ae60'}; border-radius: 8px; padding: 12px; cursor: pointer; transition: all 0.3s ease; position: relative; box-shadow: ${currentFilter === 'C' ? '0 0 20px rgba(255, 255, 255, 0.3)' : 'none'};">
                                <h3 style="font-size: 0.75rem; color: #ffffff; margin-bottom: 6px; font-weight: 600;">ì™„ë£Œëœ ì‘ì—…</h3>
                                <div class="number" style="font-size: 1.4rem; font-weight: 700; color: #ffffff;">${statusCounts.C || 0}</div>
                                ${currentFilter === 'C' ? '<div style="position: absolute; top: 6px; right: 6px; color: #ffffff; font-size: 0.9rem;">âœ“</div>' : ''}
                            </div>
                            <div class="summary-card progress-card ${currentFilter === 'S' ? 'active' : ''}" onclick="filterByStatus('S')" style="background: linear-gradient(135deg, #f39c12, #e67e22); border: 2px solid ${currentFilter === 'S' ? '#ffffff' : '#f39c12'}; border-radius: 8px; padding: 12px; cursor: pointer; transition: all 0.3s ease; position: relative; box-shadow: ${currentFilter === 'S' ? '0 0 20px rgba(255, 255, 255, 0.3)' : 'none'};">
                                <h3 style="font-size: 0.75rem; color: #ffffff; margin-bottom: 6px; font-weight: 600;">ì§„í–‰ ì¤‘</h3>
                                <div class="number" style="font-size: 1.4rem; font-weight: 700; color: #ffffff;">${statusCounts.S || 0}</div>
                                ${currentFilter === 'S' ? '<div style="position: absolute; top: 6px; right: 6px; color: #ffffff; font-size: 0.9rem;">âœ“</div>' : ''}
                            </div>
                            <div class="summary-card waiting-card ${currentFilter === 'W' ? 'active' : ''}" onclick="filterByStatus('W')" style="background: linear-gradient(135deg, #6c757d, #5a6268); border: 2px solid ${currentFilter === 'W' ? '#ffffff' : '#6c757d'}; border-radius: 8px; padding: 12px; cursor: pointer; transition: all 0.3s ease; position: relative; box-shadow: ${currentFilter === 'W' ? '0 0 20px rgba(255, 255, 255, 0.3)' : 'none'};">
                                <h3 style="font-size: 0.75rem; color: #ffffff; margin-bottom: 6px; font-weight: 600;">ëŒ€ê¸° ì¤‘</h3>
                                <div class="number" style="font-size: 1.4rem; font-weight: 700; color: #ffffff;">${statusCounts.W || 0}</div>
                                ${currentFilter === 'W' ? '<div style="position: absolute; top: 6px; right: 6px; color: #ffffff; font-size: 0.9rem;">âœ“</div>' : ''}
                            </div>
                            <div class="summary-card error-card ${currentFilter === 'E' ? 'active' : ''}" onclick="filterByStatus('E')" style="background: linear-gradient(135deg, #dc3545, #c82333); border: 2px solid ${currentFilter === 'E' ? '#ffffff' : '#dc3545'}; border-radius: 8px; padding: 12px; cursor: pointer; transition: all 0.3s ease; position: relative; box-shadow: ${currentFilter === 'E' ? '0 0 20px rgba(255, 255, 255, 0.3)' : 'none'};">
                                <h3 style="font-size: 0.75rem; color: #ffffff; margin-bottom: 6px; font-weight: 600;">ì˜¤ë¥˜</h3>
                                <div class="number" style="font-size: 1.4rem; font-weight: 700; color: #ffffff;">${statusCounts.E || 0}</div>
                                ${currentFilter === 'E' ? '<div style="position: absolute; top: 6px; right: 6px; color: #ffffff; font-size: 0.9rem;">âœ“</div>' : ''}
                            </div>
                        </div>
                    `;
                    
                    // í…Œì´ë¸” ìƒì„±
                    let tableHtml = '';
                    if (data.tasks && data.tasks.length > 0) {
                        tableHtml = `
                            <table class="table" style="width: 100%; border-collapse: collapse; background: #2d3142; border-radius: 8px; overflow: hidden;">
                                <thead style="background: linear-gradient(135deg, #3a3f52, #2d3142);">
                                    <tr>
                                        <th style="padding: 10px 12px; text-align: center; color: #ffffff; font-weight: 600; border: none; font-size: 0.85rem;">ìƒíƒœ</th>
                                        <th style="padding: 10px 12px; text-align: center; color: #ffffff; font-weight: 600; border: none; font-size: 0.85rem;">í”„ë¡œì íŠ¸ëª…</th>
                                        <th style="padding: 10px 12px; text-align: center; color: #ffffff; font-weight: 600; border: none; font-size: 0.85rem;">ì‚¬ìš©ìëª…</th>
                                        <th style="padding: 10px 12px; text-align: center; color: #ffffff; font-weight: 600; border: none; font-size: 0.85rem;">ë“±ë¡ì‹œê°„</th>
                                        <th style="padding: 10px 12px; text-align: center; color: #ffffff; font-weight: 600; border: none; font-size: 0.85rem;">ì™„ë£Œì‹œê°„</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${data.tasks.map(task => {
                                        // ìƒíƒœë³„ ìƒ‰ìƒ í´ë˜ìŠ¤ ê²°ì •
                                        let statusClass = 'status-waiting';
                                        let statusBgColor = 'linear-gradient(135deg, #6c757d, #5a6268)';
                                        let statusBorderColor = '#6c757d';
                                        
                                        switch(task.stStatus) {
                                            case 'S':
                                                statusClass = 'status-progress';
                                                statusBgColor = 'linear-gradient(135deg, #f39c12, #e67e22)';
                                                statusBorderColor = '#f39c12';
                                                break;
                                            case 'C':
                                                statusClass = 'status-completed';
                                                statusBgColor = 'linear-gradient(135deg, #27ae60, #229954)';
                                                statusBorderColor = '#27ae60';
                                                break;
                                            case 'W':
                                                statusClass = 'status-waiting';
                                                statusBgColor = 'linear-gradient(135deg, #6c757d, #5a6268)';
                                                statusBorderColor = '#6c757d';
                                                break;
                                            case 'E':
                                                statusClass = 'status-error';
                                                statusBgColor = 'linear-gradient(135deg, #dc3545, #c82333)';
                                                statusBorderColor = '#dc3545';
                                                break;
                                        }
                                        
                                        // ì‚¬ìš©ìëª… ì²˜ë¦¬
                                        const userName = task.user && task.user.name ? task.user.name : 'N/A';
                                        
                                        return `
                                        <tr class="project-row" data-seq="${task.stSeq}" data-name="${(task.stName || '').replace(/"/g, '&quot;')}" data-user="${(userName || '').replace(/"/g, '&quot;')}" data-query="${(task.stQuery || '').replace(/"/g, '&quot;')}" data-progress="${task.stProgress || 0}" data-status="${task.stStatus || ''}" data-host="${(task.stHost || '').replace(/"/g, '&quot;')}" data-database="${(task.stDb || '').replace(/"/g, '&quot;')}" data-table="${(task.stTable || '').replace(/"/g, '&quot;')}" data-db-user="${(task.stDbId || '').replace(/"/g, '&quot;')}" style="cursor: pointer; transition: all 0.3s ease; border-bottom: 1px solid #3a3f52;">
                                            <td style="padding: 10px 12px; text-align: center; vertical-align: middle;">
                                                <div class="status-display ${statusClass}" style="background: ${statusBgColor}; border: 1px solid ${statusBorderColor}; font-size: 0.75rem; font-weight: 600; color: #ffffff; display: inline-flex; align-items: center; gap: 4px; padding: 5px 10px; border-radius: 15px; text-transform: uppercase; letter-spacing: 0.3px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);">
                                                    ${task.statusDisplay || 'ëŒ€ê¸° â³'}
                                                </div>
                                            </td>
                                            <td style="padding: 10px 12px; text-align: center; vertical-align: middle; color: #ffffff; font-size: 0.85rem;">${task.stName || 'N/A'}</td>
                                            <td style="padding: 10px 12px; text-align: center; vertical-align: middle; color: #ffffff; font-size: 0.85rem;">${userName}</td>
                                            <td style="padding: 10px 12px; text-align: center; vertical-align: middle; color: #ffffff; font-size: 0.85rem;">${new Date(task.stStrDate).toLocaleString('ko-KR')}</td>
                                            <td style="padding: 10px 12px; text-align: center; vertical-align: middle; color: #ffffff; font-size: 0.85rem;">${task.stEndDate ? new Date(task.stEndDate).toLocaleString('ko-KR') : '-'}</td>
                                        </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        `;
                    } else {
                        tableHtml = `
                            <div style="text-align: center; padding: 60px; color: #a0a6b8;">
                                <i class="fas fa-inbox" style="font-size: 4rem; margin-bottom: 20px; opacity: 0.5;"></i>
                                <h3 style="margin-bottom: 15px; color: #ffffff;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                                <p style="margin-bottom: 30px;">ì•„ì§ ìƒì„±ëœ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                            </div>
                        `;
                    }
                    
                    // í˜ì´ì§€ë„¤ì´ì…˜ ìƒì„±
                    let paginationHtml = '';
                    if (data.totalPages > 1) {
                        paginationHtml = `
                            <div style="display: flex; justify-content: center; margin-top: 15px;">
                                <nav>
                                    <ul class="pagination" style="display: flex; list-style: none; margin: 0; padding: 0;">
                                        <li class="page-item" style="margin: 0 2px;">
                                            <a class="page-link" href="#" onclick="loadDataSupplyContent(${data.currentPage - 1}); return false;" style="color: #4a90e2; border: 1px solid #3a3f52; padding: 6px 12px; margin: 0 2px; border-radius: 6px; text-decoration: none; font-size: 0.85rem; transition: all 0.3s ease;" ${data.hasPrevious ? '' : 'style="pointer-events: none; opacity: 0.5;"'}>ì´ì „</a>
                                        </li>
                                        ${Array.from({length: data.totalPages}, (_, i) => `
                                            <li class="page-item" style="margin: 0 2px;">
                                                <a class="page-link" href="#" onclick="loadDataSupplyContent(${i}); return false;" style="color: ${i === data.currentPage ? '#ffffff' : '#4a90e2'}; background: ${i === data.currentPage ? 'linear-gradient(135deg, #4a90e2, #357abd)' : 'transparent'}; border: 1px solid #3a3f52; padding: 6px 12px; margin: 0 2px; border-radius: 6px; text-decoration: none; font-size: 0.85rem; transition: all 0.3s ease;">${i + 1}</a>
                                            </li>
                                        `).join('')}
                                        <li class="page-item" style="margin: 0 2px;">
                                            <a class="page-link" href="#" onclick="loadDataSupplyContent(${data.currentPage + 1}); return false;" style="color: #4a90e2; border: 1px solid #3a3f52; padding: 6px 12px; margin: 0 2px; border-radius: 6px; text-decoration: none; font-size: 0.85rem; transition: all 0.3s ease;" ${data.hasNext ? '' : 'style="pointer-events: none; opacity: 0.5;"'}>ë‹¤ìŒ</a>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        `;
                    }
                    
                    // ìµœì¢… ì½˜í…ì¸  êµ¬ì„±
                    let content = `
                        <div class="data-table">
                            <div class="table-header" style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                <h3 class="table-title">ë°ì´í„° ìƒì„±</h3>
                                <p style="color: #a0a6b8; margin: 0; font-size: 0.9rem;">Quetta Data ì¶”ì¶œ ë° ê´€ë¦¬</p>
                            </div>
                                <button class="btn btn-primary" onclick="showProjectCreateModal()" style="background: linear-gradient(135deg, #4a90e2, #357abd); border: none; padding: 10px 24px; border-radius: 8px; font-weight: 600; font-size: 0.9rem; box-shadow: 0 4px 8px rgba(74, 144, 226, 0.3); transition: all 0.3s ease; color: #ffffff; white-space: nowrap;">
                                    <i class="fas fa-plus me-2"></i>í”„ë¡œì íŠ¸ ìƒì„±
                                </button>
                            </div>
                            <div style="padding: 15px;">
                                ${summaryCardsHtml}
                                ${tableHtml}
                                ${paginationHtml}
                            </div>
                        </div>
                    `;
                    
                    contentDiv.innerHTML = content;
                    
                    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ë“±ë¡
                    reattachEventListeners();
                    
                    // í”„ë¡œì íŠ¸ í–‰ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                    document.querySelectorAll('.project-row').forEach(row => {
                        row.addEventListener('click', function() {
                            const seq = this.getAttribute('data-seq');
                            const name = this.getAttribute('data-name');
                            const user = this.getAttribute('data-user');
                            const query = this.getAttribute('data-query');
                            const progress = this.getAttribute('data-progress');
                            const status = this.getAttribute('data-status');
                            const host = this.getAttribute('data-host');
                            const database = this.getAttribute('data-database');
                            const table = this.getAttribute('data-table');
                            const dbUser = this.getAttribute('data-db-user');
                            
                            showProjectDetail(seq, name, user, query, progress, status, host, database, table, dbUser);
                        });
                    });
                })
                .catch(error => {
                    console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                    contentDiv.innerHTML = `
                        <div class="data-table">
                            <div class="table-header">
                                <h3 class="table-title">ë°ì´í„° ìƒì„±</h3>
                            </div>
                            <div style="text-align: center; padding: 60px;">
                                <div style="font-size: 3rem; color: #e74c3c; margin-bottom: 20px;">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <h3 style="color: #ffffff; margin-bottom: 10px;">ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</h3>
                                <p style="color: #a0a6b8;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
                                <button class="btn btn-primary mt-3" onclick="loadDataSupplyContent()">
                                    <i class="fas fa-redo me-2"></i>ë‹¤ì‹œ ì‹œë„
                                </button>
                            </div>
                        </div>
                    `;
                });
        }
        
        // ë°ì´í„° ê³µê¸‰ API ê´€ë¦¬ ì½˜í…ì¸  ë¡œë“œ í•¨ìˆ˜
        function loadDataSupplyApiContent(page = 0) {
            const contentDiv = document.getElementById('data-supply-api-content');
            
            // ë¡œë”© í‘œì‹œ
            contentDiv.innerHTML = `
                <div style="text-align: center; padding: 60px;">
                    <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p style="color: #a0a6b8; font-size: 1.1rem;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>
            `;
            
            // í˜„ì¬ í•„í„° ìƒíƒœ í™•ì¸ (ì „ì²´/ì¢…ë£Œ/ì¢…ë£Œì„ë°•/ìš´ì˜)
            const currentFilter = window.currentApiFilterStatus || '';
            
            // API í˜¸ì¶œ
            const size = 10; // í˜ì´ì§€ë‹¹ 10ê°œ
            const filterParam = currentFilter ? `&filter=${currentFilter}` : '';
            fetch(`/api/data-supply-api/projects?page=${page}&size=${size}${filterParam}`)
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(err => {
                            throw new Error(err.message || 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    // ì—ëŸ¬ ì‘ë‹µ ì²´í¬
                    if (data.error) {
                        throw new Error(data.message || 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    }
                    const statusCounts = data.statusCounts || {
                        total: 0,
                        closed: 0,
                        expiring: 0,
                        active: 0
                    };
                    
                    const projects = data.projects || [];
                    const currentPage = data.currentPage || 0;
                    const totalPages = data.totalPages || 0;
                    const hasPrevious = data.hasPrevious || false;
                    const hasNext = data.hasNext || false;
            
            const summaryCardsHtml = `
                <div class="summary-cards" style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; margin-bottom: 15px;">
                    <div class="summary-card total-card ${currentFilter === '' ? 'active' : ''}" onclick="filterApiByStatus('')" style="background: linear-gradient(135deg, #4a90e2, #357abd); border: 2px solid ${currentFilter === '' ? '#ffffff' : '#4a90e2'}; border-radius: 8px; padding: 12px; cursor: pointer; transition: all 0.3s ease; position: relative; box-shadow: ${currentFilter === '' ? '0 0 20px rgba(255, 255, 255, 0.3)' : 'none'};">
                        <h3 style="font-size: 0.75rem; color: #ffffff; margin-bottom: 6px; font-weight: 600;">ì „ì²´ í”„ë¡œì íŠ¸</h3>
                        <div class="number" style="font-size: 1.4rem; font-weight: 700; color: #ffffff;">${statusCounts.total || 0}</div>
                        ${currentFilter === '' ? '<div style="position: absolute; top: 6px; right: 6px; color: #ffffff; font-size: 0.9rem;">âœ“</div>' : ''}
                    </div>
                    <div class="summary-card active-card ${currentFilter === 'active' ? 'active' : ''}" onclick="filterApiByStatus('active')" style="background: linear-gradient(135deg, #27ae60, #229954); border: 2px solid ${currentFilter === 'active' ? '#ffffff' : '#27ae60'}; border-radius: 8px; padding: 12px; cursor: pointer; transition: all 0.3s ease; position: relative; box-shadow: ${currentFilter === 'active' ? '0 0 20px rgba(255, 255, 255, 0.3)' : 'none'};">
                        <h3 style="font-size: 0.75rem; color: #ffffff; margin-bottom: 6px; font-weight: 600;">ìš´ì˜ í”„ë¡œì íŠ¸</h3>
                        <div class="number" style="font-size: 1.4rem; font-weight: 700; color: #ffffff;">${statusCounts.active || 0}</div>
                        ${currentFilter === 'active' ? '<div style="position: absolute; top: 6px; right: 6px; color: #ffffff; font-size: 0.9rem;">âœ“</div>' : ''}
                    </div>
                    <div class="summary-card expiring-card ${currentFilter === 'expiring' ? 'active' : ''}" onclick="filterApiByStatus('expiring')" style="background: linear-gradient(135deg, #f39c12, #e67e22); border: 2px solid ${currentFilter === 'expiring' ? '#ffffff' : '#f39c12'}; border-radius: 8px; padding: 12px; cursor: pointer; transition: all 0.3s ease; position: relative; box-shadow: ${currentFilter === 'expiring' ? '0 0 20px rgba(255, 255, 255, 0.3)' : 'none'};">
                        <h3 style="font-size: 0.75rem; color: #ffffff; margin-bottom: 6px; font-weight: 600;">ì¢…ë£Œ ì„ë°• í”„ë¡œì íŠ¸</h3>
                        <div class="number" style="font-size: 1.4rem; font-weight: 700; color: #ffffff;">${statusCounts.expiring || 0}</div>
                        ${currentFilter === 'expiring' ? '<div style="position: absolute; top: 6px; right: 6px; color: #ffffff; font-size: 0.9rem;">âœ“</div>' : ''}
                    </div>
                    <div class="summary-card closed-card ${currentFilter === 'closed' ? 'active' : ''}" onclick="filterApiByStatus('closed')" style="background: linear-gradient(135deg, #dc3545, #c82333); border: 2px solid ${currentFilter === 'closed' ? '#ffffff' : '#dc3545'}; border-radius: 8px; padding: 12px; cursor: pointer; transition: all 0.3s ease; position: relative; box-shadow: ${currentFilter === 'closed' ? '0 0 20px rgba(255, 255, 255, 0.3)' : 'none'};">
                        <h3 style="font-size: 0.75rem; color: #ffffff; margin-bottom: 6px; font-weight: 600;">ì¢…ë£Œ í”„ë¡œì íŠ¸</h3>
                        <div class="number" style="font-size: 1.4rem; font-weight: 700; color: #ffffff;">${statusCounts.closed || 0}</div>
                        ${currentFilter === 'closed' ? '<div style="position: absolute; top: 6px; right: 6px; color: #ffffff; font-size: 0.9rem;">âœ“</div>' : ''}
                    </div>
                    <div class="summary-card error-card ${currentFilter === 'error' ? 'active' : ''}" onclick="filterApiByStatus('error')" style="background: linear-gradient(135deg, #6c757d, #5a6268); border: 2px solid ${currentFilter === 'error' ? '#ffffff' : '#6c757d'}; border-radius: 8px; padding: 12px; cursor: pointer; transition: all 0.3s ease; position: relative; box-shadow: ${currentFilter === 'error' ? '0 0 20px rgba(255, 255, 255, 0.3)' : 'none'};">
                        <h3 style="font-size: 0.75rem; color: #ffffff; margin-bottom: 6px; font-weight: 600;">ì˜¤ë¥˜ í”„ë¡œì íŠ¸</h3>
                        <div class="number" style="font-size: 1.4rem; font-weight: 700; color: #ffffff;">${statusCounts.error || 0}</div>
                        ${currentFilter === 'error' ? '<div style="position: absolute; top: 6px; right: 6px; color: #ffffff; font-size: 0.9rem;">âœ“</div>' : ''}
                    </div>
                </div>
            `;
            
                    // ë‚ ì§œ í¬ë§·íŒ… í•¨ìˆ˜
                    function formatDate(dateStr) {
                        if (!dateStr) return '-';
                        const date = new Date(dateStr);
                        const year = date.getFullYear();
                        const month = String(date.getMonth() + 1).padStart(2, '0');
                        const day = String(date.getDate()).padStart(2, '0');
                        return `${year}/${month}/${day}`;
                    }
                    
                    function formatDateTime(dateTimeStr) {
                        if (!dateTimeStr) return '-';
                        const date = new Date(dateTimeStr);
                        const year = date.getFullYear();
                        const month = String(date.getMonth() + 1).padStart(2, '0');
                        const day = String(date.getDate()).padStart(2, '0');
                        const hours = String(date.getHours()).padStart(2, '0');
                        const minutes = String(date.getMinutes()).padStart(2, '0');
                        const seconds = String(date.getSeconds()).padStart(2, '0');
                        return `${year}/${month}/${day} ${hours}:${minutes}:${seconds}`;
                    }
                    
                    // ì”ì—¬ë‚ ì§œ ê³„ì‚° í•¨ìˆ˜ (ì˜¤ëŠ˜ ë‚ ì§œë¶€í„° ì¢…ë£Œë‚ ì§œê¹Œì§€ ë‚¨ì€ ì¼ìˆ˜)
                    function calculateRemainingDays(endDateStr) {
                        if (!endDateStr) return '-';
                        try {
                            const today = new Date();
                            const endDate = new Date(endDateStr);
                            
                            // ë‚ ì§œë¥¼ ì‹œê°„ ë¶€ë¶„ ì—†ì´ ìˆœìˆ˜ ë‚ ì§œë¡œ ë³€í™˜
                            today.setHours(0, 0, 0, 0);
                            endDate.setHours(0, 0, 0, 0);
                            
                            // ë°€ë¦¬ì´ˆ ì°¨ì´ë¥¼ ì¼ìˆ˜ë¡œ ë³€í™˜ (ì¢…ë£Œë‚ ì§œ - ì˜¤ëŠ˜ë‚ ì§œ + 1, ì¢…ë£Œë‚ ì§œ í¬í•¨)
                            const diffTime = endDate - today;
                            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1;
                            
                            // ì¢…ë£Œë‚ ì§œê°€ ì´ë¯¸ ì§€ë‚¬ìœ¼ë©´ ìŒìˆ˜ ë˜ëŠ” 0ì´ ë  ìˆ˜ ìˆìŒ
                            return diffDays >= 0 ? diffDays : '-';
                        } catch (e) {
                            return '-';
                        }
                    }
                    
                    // í…Œì´ë¸” í—¤ë” (í•­ìƒ í‘œì‹œ)
                    const tableHeader = `
                        <table class="table" style="width: 100%; border-collapse: collapse; background: #2d3142; border-radius: 8px; overflow: hidden;">
                            <thead style="background: linear-gradient(135deg, #3a3f52, #2d3142);">
                                <tr>
                                    <th style="padding: 10px 12px; text-align: center; color: #ffffff; font-weight: 600; border: none; font-size: 0.85rem;">ìƒíƒœ</th>
                                    <th style="padding: 10px 12px; text-align: center; color: #ffffff; font-weight: 600; border: none; font-size: 0.85rem;">í”„ë¡œì íŠ¸</th>
                                    <th style="padding: 10px 12px; text-align: center; color: #ffffff; font-weight: 600; border: none; font-size: 0.85rem;">ì‹œì‘ë‚ ì§œ</th>
                                    <th style="padding: 10px 12px; text-align: center; color: #ffffff; font-weight: 600; border: none; font-size: 0.85rem;">ì¢…ë£Œë‚ ì§œ</th>
                                    <th style="padding: 10px 12px; text-align: center; color: #ffffff; font-weight: 600; border: none; font-size: 0.85rem;">ì”ì—¬ë‚ ì§œ</th>
                                    <th style="padding: 10px 12px; text-align: center; color: #ffffff; font-weight: 600; border: none; font-size: 0.85rem;">ë“±ë¡ì‹œê°„</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;
                    
                    let tableHtml = '';
                    if (projects && projects.length > 0) {
                        tableHtml = tableHeader + `
                                    ${projects.map(project => {
                                        // ìƒíƒœë³„ ìƒ‰ìƒ í´ë˜ìŠ¤ ê²°ì •
                                        let statusClass = 'status-active';
                                        let statusBgColor = 'linear-gradient(135deg, #27ae60, #229954)';
                                        let statusBorderColor = '#27ae60';
                                        let statusText = 'ìš´ì˜';
                                        
                                        // use_ynì´ 'E'ì¸ ê²½ìš° ì˜¤ë¥˜ë¡œ í‘œì‹œ
                                        if (project.useYn === 'E') {
                                            statusClass = 'status-error';
                                            statusBgColor = 'linear-gradient(135deg, #6c757d, #5a6268)';
                                            statusBorderColor = '#6c757d';
                                            statusText = 'ì˜¤ë¥˜';
                                        } else if (project.status === 'closed') {
                                            statusClass = 'status-closed';
                                            statusBgColor = 'linear-gradient(135deg, #dc3545, #c82333)';
                                            statusBorderColor = '#dc3545';
                                            statusText = 'ì¢…ë£Œ';
                                        } else if (project.status === 'expiring') {
                                            statusClass = 'status-expiring';
                                            statusBgColor = 'linear-gradient(135deg, #f39c12, #e67e22)';
                                            statusBorderColor = '#f39c12';
                                            statusText = 'ì„ë°•';
                                        }
                                        
                                        const remainingDays = calculateRemainingDays(project.endDate);
                                        
                                        return `
                                        <tr class="api-project-row" data-com-seq="${project.comSeq}" style="cursor: pointer; transition: all 0.3s ease; border-bottom: 1px solid #3a3f52;" onclick="if (!window.isApiProjectModalLoading) { showApiProjectDetailModal(${project.comSeq}); }">
                                            <td style="padding: 10px 12px; text-align: center; vertical-align: middle;">
                                                <div class="status-display ${statusClass}" style="background: ${statusBgColor}; border: 1px solid ${statusBorderColor}; font-size: 0.75rem; font-weight: 600; color: #ffffff; display: inline-flex; align-items: center; gap: 4px; padding: 5px 10px; border-radius: 15px; text-transform: uppercase; letter-spacing: 0.3px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);">
                                                    ${statusText}
                                                </div>
                                            </td>
                                            <td style="padding: 10px 12px; text-align: center; vertical-align: middle; color: #ffffff; font-size: 0.85rem;">${project.comName || 'N/A'}</td>
                                            <td style="padding: 10px 12px; text-align: center; vertical-align: middle; color: #ffffff; font-size: 0.85rem;">${formatDate(project.startDate)}</td>
                                            <td style="padding: 10px 12px; text-align: center; vertical-align: middle; color: #ffffff; font-size: 0.85rem;">${formatDate(project.endDate)}</td>
                                            <td style="padding: 10px 12px; text-align: center; vertical-align: middle; color: #ffffff; font-size: 0.85rem; font-weight: 600;">${remainingDays}</td>
                                            <td style="padding: 10px 12px; text-align: center; vertical-align: middle; color: #ffffff; font-size: 0.85rem;">${formatDateTime(project.regDate)}</td>
                                        </tr>
                                        `;
                                    }).join('')}
                            </tbody>
                        </table>
                        `;
                    } else {
                        // NO DATA ì²˜ë¦¬ (í—¤ë”ëŠ” í‘œì‹œ)
                        tableHtml = tableHeader + `
                                <tr>
                                    <td colspan="6" style="padding: 80px; text-align: center; color: #a0a6b8;">
                                        <div style="font-size: 5rem; margin-bottom: 20px; opacity: 0.5;">
                                            <i class="fas fa-database"></i>
                                        </div>
                                        <h2 style="margin-bottom: 15px; color: #ffffff; font-size: 1.5rem; font-weight: 600;">NO DATA</h2>
                                        <p style="margin-bottom: 30px; font-size: 1rem;">ë“±ë¡ëœ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        `;
                    }
                    
                    // í˜ì´ì§€ë„¤ì´ì…˜ ìƒì„±
                    let paginationHtml = '';
                    if (totalPages > 1) {
                        paginationHtml = `
                            <div style="display: flex; justify-content: center; margin-top: 15px;">
                                <nav>
                                    <ul class="pagination" style="display: flex; list-style: none; margin: 0; padding: 0;">
                                        <li class="page-item" style="margin: 0 2px;">
                                            <a class="page-link" href="#" onclick="loadDataSupplyApiContent(${currentPage - 1}); return false;" style="color: #4a90e2; border: 1px solid #3a3f52; padding: 6px 12px; margin: 0 2px; border-radius: 6px; text-decoration: none; font-size: 0.85rem; transition: all 0.3s ease;" ${hasPrevious ? '' : 'style="pointer-events: none; opacity: 0.5;"'}>ì´ì „</a>
                                        </li>
                                        ${Array.from({length: totalPages}, (_, i) => `
                                            <li class="page-item" style="margin: 0 2px;">
                                                <a class="page-link" href="#" onclick="loadDataSupplyApiContent(${i}); return false;" style="color: ${i === currentPage ? '#ffffff' : '#4a90e2'}; background: ${i === currentPage ? 'linear-gradient(135deg, #4a90e2, #357abd)' : 'transparent'}; border: 1px solid #3a3f52; padding: 6px 12px; margin: 0 2px; border-radius: 6px; text-decoration: none; font-size: 0.85rem; transition: all 0.3s ease;">${i + 1}</a>
                                            </li>
                                        `).join('')}
                                        <li class="page-item" style="margin: 0 2px;">
                                            <a class="page-link" href="#" onclick="loadDataSupplyApiContent(${currentPage + 1}); return false;" style="color: #4a90e2; border: 1px solid #3a3f52; padding: 6px 12px; margin: 0 2px; border-radius: 6px; text-decoration: none; font-size: 0.85rem; transition: all 0.3s ease;" ${hasNext ? '' : 'style="pointer-events: none; opacity: 0.5;"'}>ë‹¤ìŒ</a>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        `;
                    }
                    
                    // ìµœì¢… ì½˜í…ì¸  êµ¬ì„±
                    let content = `
                        <div class="data-table">
                            <div class="table-header" style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <h3 class="table-title">ë°ì´í„° ê³µê¸‰ API ê´€ë¦¬</h3>
                                    <p style="color: #a0a6b8; margin: 0; font-size: 0.9rem;">ë°ì´í„° ê³µê¸‰ API ì„¤ì •ì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
                                </div>
                                <button class="btn btn-primary" onclick="showProjectAddModal()" style="background: linear-gradient(135deg, #4a90e2, #357abd); border: none; padding: 10px 24px; border-radius: 8px; font-weight: 600; font-size: 0.9rem; box-shadow: 0 4px 8px rgba(74, 144, 226, 0.3); transition: all 0.3s ease; color: #ffffff; white-space: nowrap;">
                                    <i class="fas fa-plus me-2"></i>í”„ë¡œì íŠ¸ ì¶”ê°€
                                </button>
                            </div>
                            <div style="padding: 15px;">
                                ${summaryCardsHtml}
                                ${tableHtml}
                                ${paginationHtml}
                            </div>
                        </div>
                    `;
                    
                    contentDiv.innerHTML = content;
                })
                .catch(error => {
                    console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                    contentDiv.innerHTML = `
                        <div class="data-table">
                            <div class="table-header">
                                <h3 class="table-title">ë°ì´í„° ê³µê¸‰ API ê´€ë¦¬</h3>
                            </div>
                            <div style="text-align: center; padding: 60px;">
                                <div style="font-size: 3rem; color: #e74c3c; margin-bottom: 20px;">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <h3 style="color: #ffffff; margin-bottom: 10px;">ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</h3>
                                <p style="color: #a0a6b8;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
                                <button class="btn btn-primary mt-3" onclick="loadDataSupplyApiContent()">
                                    <i class="fas fa-redo me-2"></i>ë‹¤ì‹œ ì‹œë„
                                </button>
                            </div>
                        </div>
                    `;
                });
        }
        
        // API ê´€ë¦¬ í•„í„° í•¨ìˆ˜
        function filterApiByStatus(status) {
            window.currentApiFilterStatus = status;
            loadDataSupplyApiContent();
        }
        
        // í”„ë¡œì íŠ¸ ì¶”ê°€ ëª¨ë‹¬ í‘œì‹œ í•¨ìˆ˜
        function showProjectAddModal() {
            // ê³ ìœ í‚¤ ìë™ ìƒì„± (UUID.randomUUID().toString().replace("-", ""))
            const uuid = 'xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
            const uniqueKey = uuid.replace(/-/g, '');
            
            // ê³ ìœ í‚¤ í•„ë“œì— ì„¤ì •
            document.getElementById('apiAddModalComKey').value = uniqueKey;
            
            // ëª¨ë“  ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('apiAddModalComName').value = '';
            document.getElementById('apiAddModalStartDate').value = '';
            document.getElementById('apiAddModalEndDate').value = '';
            document.getElementById('apiAddModalSearchStartDate').value = '';
            document.getElementById('apiAddModalSearchDateDiff').value = '';
            document.getElementById('apiAddModalUpdateSearchDateOffset').value = '';
            document.getElementById('apiAddModalSearchByteLength').value = '';
            document.getElementById('apiAddModalDailySearchTotalCount').value = '';
            document.getElementById('apiAddModalMonthlySearchTotalCount').value = '';
            document.getElementById('apiAddModalDailyTotalCount').value = '';
            document.getElementById('apiAddModalMonthlyTotalCount').value = '';
            document.getElementById('apiAddModalCommand').value = '';
            
            // ë¼ë””ì˜¤ ë²„íŠ¼ ì´ˆê¸°í™” (ê¸°ë³¸ê°’ ì„¤ì •)
            document.getElementById('apiAddModalUpdateSearchDateYnY').checked = false;
            document.getElementById('apiAddModalUpdateSearchDateYnN').checked = true; // Default N
            document.getElementById('apiAddModalSearchCountYnY').checked = false;
            document.getElementById('apiAddModalSearchCountYnN').checked = true; // Default N
            document.getElementById('apiAddModalKomoranYnY').checked = true; // Default Y
            document.getElementById('apiAddModalKomoranYnN').checked = false;
            
            // ë¬¸ì„œ ê²€ìƒ‰ ìˆ˜ ì œí•œ ì‚¬ìš©ì—¬ë¶€ê°€ Nì¼ ë•Œ ì¼ë³„/ì›”ë³„ ë¬¸ì„œ ìµœëŒ€ ê²€ìƒ‰ ìˆ˜ë¥¼ 0ìœ¼ë¡œ ì„¤ì •
            document.getElementById('apiAddModalDailySearchTotalCount').value = '0';
            document.getElementById('apiAddModalMonthlySearchTotalCount').value = '0';
            
            // ë¬¸ì„œ ê²€ìƒ‰ ìˆ˜ ì œí•œ ì‚¬ìš©ì—¬ë¶€ ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            const searchCountYnY = document.getElementById('apiAddModalSearchCountYnY');
            const searchCountYnN = document.getElementById('apiAddModalSearchCountYnN');
            const dailySearchTotalCount = document.getElementById('apiAddModalDailySearchTotalCount');
            const monthlySearchTotalCount = document.getElementById('apiAddModalMonthlySearchTotalCount');
            
            // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±° í›„ ìƒˆë¡œ ì¶”ê°€
            const newSearchCountYnY = searchCountYnY.cloneNode(true);
            const newSearchCountYnN = searchCountYnN.cloneNode(true);
            searchCountYnY.parentNode.replaceChild(newSearchCountYnY, searchCountYnY);
            searchCountYnN.parentNode.replaceChild(newSearchCountYnN, searchCountYnN);
            
            newSearchCountYnY.addEventListener('change', function() {
                if (this.checked) {
                    // Y ì„ íƒ ì‹œ ì…ë ¥ ê°€ëŠ¥
                    dailySearchTotalCount.disabled = false;
                    monthlySearchTotalCount.disabled = false;
                }
            });
            
            newSearchCountYnN.addEventListener('change', function() {
                if (this.checked) {
                    // N ì„ íƒ ì‹œ 0ìœ¼ë¡œ ì„¤ì •í•˜ê³  ë¹„í™œì„±í™”
                    dailySearchTotalCount.value = '0';
                    monthlySearchTotalCount.value = '0';
                    dailySearchTotalCount.disabled = true;
                    monthlySearchTotalCount.disabled = true;
                }
            });
            
            // ì´ˆê¸° ìƒíƒœ ì„¤ì • (Nì´ ê¸°ë³¸ê°’ì´ë¯€ë¡œ ë¹„í™œì„±í™”)
            dailySearchTotalCount.disabled = true;
            monthlySearchTotalCount.disabled = true;
            
            // IP ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            const hostsContainer = document.getElementById('apiAddModalHostsContainer');
            hostsContainer.innerHTML = '';
            addApiAddHostInput('', 0);
            
            // ëª¨ë‹¬ í‘œì‹œ
            const modalElement = document.getElementById('apiProjectAddModal');
            const modal = new bootstrap.Modal(modalElement);
            modal.show();
        }
        
        // IP ì…ë ¥ í•„ë“œ ì¶”ê°€ í•¨ìˆ˜ (ì¶”ê°€ ëª¨ë‹¬ìš©)
        function addApiAddHostInput(value = '', index = null) {
            const container = document.getElementById('apiAddModalHostsContainer');
            const hostIndex = index !== null ? index : container.children.length;
            const hostDiv = document.createElement('div');
            hostDiv.className = 'mb-2 d-flex gap-2';
            hostDiv.innerHTML = `
                <input type="text" class="form-control api-add-host-input" data-index="${hostIndex}" value="${value}" placeholder="IP ì£¼ì†Œ ì…ë ¥" style="background: #3a3f52; border: 1px solid #495057; color: #ffffff; max-width: 100%;">
                <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeApiAddHostInput(this)" style="border-color: #dc3545; color: #dc3545;">
                    <i class="fas fa-times"></i>
                </button>
            `;
            container.appendChild(hostDiv);
        }
        
        // IP ì…ë ¥ í•„ë“œ ì œê±° í•¨ìˆ˜ (ì¶”ê°€ ëª¨ë‹¬ìš©)
        function removeApiAddHostInput(button) {
            button.parentElement.remove();
        }
        
        // í”„ë¡œì íŠ¸ ì¶”ê°€ í•¨ìˆ˜
        async function addApiProject() {
            // ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™”
            const cancelBtn = document.getElementById('apiAddModalCancelBtn');
            const addBtn = document.getElementById('apiAddModalAddBtn');
            const addHostBtn = document.getElementById('apiAddModalAddHostBtn');
            const closeBtn = document.getElementById('apiAddModalCloseBtn');
            
            if (cancelBtn) cancelBtn.disabled = true;
            if (addBtn) addBtn.disabled = true;
            if (addHostBtn) addHostBtn.disabled = true;
            if (closeBtn) closeBtn.style.pointerEvents = 'none';
            
            // ë²„íŠ¼ í™œì„±í™” í•¨ìˆ˜
            const enableButtons = () => {
                if (cancelBtn) cancelBtn.disabled = false;
                if (addBtn) addBtn.disabled = false;
                if (addHostBtn) addHostBtn.disabled = false;
                if (closeBtn) closeBtn.style.pointerEvents = 'auto';
            };
            
            try {
                // ì…ë ¥ê°’ ìˆ˜ì§‘
                const comName = document.getElementById('apiAddModalComName').value.trim();
                const comKey = document.getElementById('apiAddModalComKey').value.trim();
                const startDate = document.getElementById('apiAddModalStartDate').value;
                const endDate = document.getElementById('apiAddModalEndDate').value;
                
                // í•„ìˆ˜ í•„ë“œ ê²€ì¦
                const missingFields = [];
                
                if (!comName) missingFields.push('í”„ë¡œì íŠ¸ëª…');
                if (!comKey) missingFields.push('ê³ ìœ í‚¤');
                if (!startDate) missingFields.push('í”„ë¡œì íŠ¸ ì‹œì‘ ë‚ ì§œ');
                if (!endDate) missingFields.push('í”„ë¡œì íŠ¸ ì¢…ë£Œ ë‚ ì§œ');
                
                // ì‹œìŠ¤í…œ ì„¤ì • ê°’ ìˆ˜ì§‘ ë° ê²€ì¦
                const searchStartDate = document.getElementById('apiAddModalSearchStartDate').value ? 
                    parseInt(document.getElementById('apiAddModalSearchStartDate').value) : null;
                const searchDateDiff = document.getElementById('apiAddModalSearchDateDiff').value ? 
                    parseInt(document.getElementById('apiAddModalSearchDateDiff').value) : null;
                const updateSearchDateYn = document.querySelector('input[name="apiAddModalUpdateSearchDateYn"]:checked')?.value || null;
                const updateSearchDateOffset = document.getElementById('apiAddModalUpdateSearchDateOffset').value ? 
                    parseInt(document.getElementById('apiAddModalUpdateSearchDateOffset').value) : null;
                const searchByteLength = document.getElementById('apiAddModalSearchByteLength').value ? 
                    parseInt(document.getElementById('apiAddModalSearchByteLength').value) : null;
                const searchCountYn = document.querySelector('input[name="apiAddModalSearchCountYn"]:checked')?.value || null;
                const dailySearchTotalCount = document.getElementById('apiAddModalDailySearchTotalCount').value ? 
                    parseInt(document.getElementById('apiAddModalDailySearchTotalCount').value) : null;
                const monthlySearchTotalCount = document.getElementById('apiAddModalMonthlySearchTotalCount').value ? 
                    parseInt(document.getElementById('apiAddModalMonthlySearchTotalCount').value) : null;
                const dailyTotalCount = document.getElementById('apiAddModalDailyTotalCount').value ? 
                    parseInt(document.getElementById('apiAddModalDailyTotalCount').value) : null;
                const monthlyTotalCount = document.getElementById('apiAddModalMonthlyTotalCount').value ? 
                    parseInt(document.getElementById('apiAddModalMonthlyTotalCount').value) : null;
                const command = document.getElementById('apiAddModalCommand').value.trim() || null;
                const komoranYn = document.querySelector('input[name="apiAddModalKomoranYn"]:checked')?.value || null;
                
                // í•„ìˆ˜ í•„ë“œ ê²€ì¦ (ì‹œìŠ¤í…œ ì„¤ì •)
                if (searchStartDate === null || searchStartDate === undefined) missingFields.push('ê²€ìƒ‰ ì‹œì‘ ê°€ëŠ¥ ë‚ ì§œ');
                if (searchDateDiff === null || searchDateDiff === undefined) missingFields.push('ê²€ìƒ‰ ë‚ ì§œ ìµœëŒ€ ë²”ìœ„');
                if (!updateSearchDateYn) missingFields.push('ê²€ìƒ‰ ì‹œì‘ ë‚ ì§œ ë™ì  ë³€ê²½ ì‚¬ìš© ì—¬ë¶€');
                if (updateSearchDateOffset === null || updateSearchDateOffset === undefined) missingFields.push('ê²€ìƒ‰ ì‹œì‘ ë‚ ì§œ ì˜¤í”„ì…‹');
                if (searchByteLength === null || searchByteLength === undefined) missingFields.push('ê²€ìƒ‰ê°€ëŠ¥í•œ ë¬¸ìì—´ Byte í¬ê¸°');
                if (!searchCountYn) missingFields.push('ë¬¸ì„œ ê²€ìƒ‰ ìˆ˜ ì œí•œ ì‚¬ìš©ì—¬ë¶€');
                if (dailySearchTotalCount === null || dailySearchTotalCount === undefined) missingFields.push('ì¼ë³„ ë¬¸ì„œ ìµœëŒ€ ê²€ìƒ‰ ìˆ˜');
                if (monthlySearchTotalCount === null || monthlySearchTotalCount === undefined) missingFields.push('ì›”ë³„ ë¬¸ì„œ ìµœëŒ€ ê²€ìƒ‰ ìˆ˜');
                if (dailyTotalCount === null || dailyTotalCount === undefined) missingFields.push('ì¼ë³„ í˜¸ì¶œ ìµœëŒ€ ìˆ˜ëŸ‰');
                if (monthlyTotalCount === null || monthlyTotalCount === undefined) missingFields.push('ì›”ë³„ í˜¸ì¶œ ìµœëŒ€ ìˆ˜ëŸ‰');
                if (!command) missingFields.push('ì‚¬ìš© ê°€ëŠ¥ cmd ëª©ë¡');
                if (!komoranYn) missingFields.push('ì½”ëª¨ë€ ì‚¬ìš© ì—¬ë¶€');
                
                // IP ì£¼ì†Œ ìˆ˜ì§‘ ë° ê²€ì¦
                const hostInputs = document.querySelectorAll('.api-add-host-input');
                const hosts = [];
                let hasValidHost = false;
                hostInputs.forEach(input => {
                    const host = input.value.trim();
                    if (host) {
                        hosts.push(host);
                        hasValidHost = true;
                    }
                });
                
                if (!hasValidHost) missingFields.push('ì ‘ì† ê°€ëŠ¥ IP');
                
                // ëˆ„ë½ëœ í•„ë“œê°€ ìˆìœ¼ë©´ ëª¨ë‹¬ë¡œ ì•Œë¦¼
                if (missingFields.length > 0) {
                    enableButtons();
                    // ê²½ê³  ëª¨ë‹¬ í‘œì‹œ
                    const errorModal = new bootstrap.Modal(document.getElementById('apiProjectAddErrorModal'));
                    document.getElementById('apiProjectAddErrorMessage').innerHTML = 
                        '<strong>ë‹¤ìŒ í•­ëª©ì´ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤:</strong><br><br>' + 
                        missingFields.map(field => 'â€¢ ' + field).join('<br>');
                    errorModal.show();
                    return;
                }
                
                // ìš”ì²­ ë°ì´í„° êµ¬ì„±
                const requestData = {
                    comName: comName,
                    comKey: comKey,
                    startDate: startDate || null,
                    endDate: endDate || null,
                    searchStartDate: searchStartDate,
                    searchDateDiff: searchDateDiff,
                    updateSearchDateYn: updateSearchDateYn,
                    updateSearchDateOffset: updateSearchDateOffset,
                    searchByteLength: searchByteLength,
                    searchCountYn: searchCountYn,
                    dailySearchTotalCount: dailySearchTotalCount,
                    monthlySearchTotalCount: monthlySearchTotalCount,
                    dailyTotalCount: dailyTotalCount,
                    monthlyTotalCount: monthlyTotalCount,
                    command: command,
                    komoranYn: komoranYn,
                    hosts: hosts
                };
                
                console.log('í”„ë¡œì íŠ¸ ì¶”ê°€ ìš”ì²­ ë°ì´í„°:', requestData);
                
                // 1. í”„ë¡œì íŠ¸ ì¶”ê°€ API í˜¸ì¶œ
                const response = await fetch('/api/data-supply-api/projects', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                const result = await response.json();
                
                if (!result.success) {
                    // ë²„íŠ¼ í™œì„±í™”
                    enableButtons();
                    
                    // ì—ëŸ¬ ëª¨ë‹¬ í‘œì‹œ
                    const errorModal = new bootstrap.Modal(document.getElementById('apiProjectAddErrorModal'));
                    document.getElementById('apiProjectAddErrorMessage').textContent = 
                        'í”„ë¡œì íŠ¸ ì¶”ê°€ ì‹¤íŒ¨: ' + (result.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    errorModal.show();
                    return;
                }
                
                // 2. ì™¸ë¶€ API 2ê°œ ìˆœì°¨ í˜¸ì¶œ (ë°±ì—”ë“œ í”„ë¡ì‹œ ì‚¬ìš©)
                const apiTypes = ['reloadCompany', 'reloadHost'];
                const apiNames = [
                    'ì „ì²´ ê³ ê°ì‚¬ ì •ë³´ ì ì¬',
                    'í˜¸ìŠ¤íŠ¸ ì •ë³´ redis ì ì¬'
                ];
                
                let allApisSuccess = true;
                let failedApiName = '';
                let errorMessage = '';
                
                for (let i = 0; i < apiTypes.length; i++) {
                    try {
                        console.log(`API ${i + 1} í˜¸ì¶œ ì¤‘: ${apiNames[i]}`);
                        
                        // ë°±ì—”ë“œ í”„ë¡ì‹œë¥¼ í†µí•´ ì™¸ë¶€ API í˜¸ì¶œ
                        const proxyResponse = await fetch(`/api/data-supply-api/proxy/${apiTypes[i]}`, {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json'
                            }
                        });
                        
                        if (!proxyResponse.ok) {
                            const proxyError = await proxyResponse.json();
                            allApisSuccess = false;
                            failedApiName = apiNames[i];
                            errorMessage = proxyError.error || 'API í˜¸ì¶œ ì‹¤íŒ¨';
                            console.error(`API ${i + 1} í”„ë¡ì‹œ í˜¸ì¶œ ì‹¤íŒ¨:`, proxyError);
                            break;
                        }
                        
                        const proxyResult = await proxyResponse.json();
                        console.log(`API ${i + 1} í”„ë¡ì‹œ ì‘ë‹µ:`, proxyResult);
                        
                        if (!proxyResult.success) {
                            allApisSuccess = false;
                            failedApiName = apiNames[i];
                            errorMessage = proxyResult.error || 'API í˜¸ì¶œ ì‹¤íŒ¨';
                            console.error(`API ${i + 1} ì‹¤íŒ¨:`, proxyResult);
                            break;
                        }
                        
                        // ì‹¤ì œ API ì‘ë‹µ í™•ì¸
                        const apiResult = proxyResult.data;
                        console.log(`API ${i + 1} ì‹¤ì œ ì‘ë‹µ:`, apiResult);
                        
                        // ì •ìƒ ì‘ë‹µ í™•ì¸: {"result":null,"responseType":"NORMAL","query":"","responseFootprint":[],"errorMessageList":null}
                        if (!apiResult || apiResult.errorMessageList !== null) {
                            allApisSuccess = false;
                            failedApiName = apiNames[i];
                            errorMessage = apiResult.errorMessageList ? JSON.stringify(apiResult.errorMessageList) : 'ì˜¤ë¥˜ ë©”ì‹œì§€ê°€ ìˆìŠµë‹ˆë‹¤';
                            console.error(`API ${i + 1} ì˜¤ë¥˜ ë©”ì‹œì§€ ìˆìŒ:`, apiResult.errorMessageList);
                            break;
                        }
                        
                        console.log(`API ${i + 1} ì„±ê³µ: ${apiNames[i]}`);
                    } catch (apiError) {
                        console.error(`API ${i + 1} í˜¸ì¶œ ì˜¤ë¥˜:`, apiError);
                        allApisSuccess = false;
                        failedApiName = apiNames[i];
                        errorMessage = apiError.message || 'API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ';
                        break;
                    }
                }
                
                // API í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ use_ynì„ 'E'ë¡œ ì—…ë°ì´íŠ¸
                if (!allApisSuccess) {
                    // ë²„íŠ¼ í™œì„±í™”
                    enableButtons();
                    
                    try {
                        await fetch(`/api/data-supply-api/projects/${encodeURIComponent(comKey)}/error`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json'
                            }
                        });
                        
                        // ì—ëŸ¬ ëª¨ë‹¬ í‘œì‹œ
                        const errorModal = new bootstrap.Modal(document.getElementById('apiProjectAddErrorModal'));
                        document.getElementById('apiProjectAddErrorMessage').innerHTML = 
                            `í”„ë¡œì íŠ¸ëŠ” ì¶”ê°€ë˜ì—ˆì§€ë§Œ, ${failedApiName} API í˜¸ì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.<br>` +
                            `í”„ë¡œì íŠ¸ ìƒíƒœê°€ ì˜¤ë¥˜ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.<br><br>` +
                            `<small style="color: #a0a6b8;">ì˜¤ë¥˜ ë‚´ìš©: ${errorMessage}</small>`;
                        errorModal.show();
                    } catch (updateError) {
                        console.error('í”„ë¡œì íŠ¸ ìƒíƒœ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', updateError);
                        
                        // ì—ëŸ¬ ëª¨ë‹¬ í‘œì‹œ
                        const errorModal = new bootstrap.Modal(document.getElementById('apiProjectAddErrorModal'));
                        document.getElementById('apiProjectAddErrorMessage').innerHTML = 
                            `í”„ë¡œì íŠ¸ëŠ” ì¶”ê°€ë˜ì—ˆì§€ë§Œ, ${failedApiName} API í˜¸ì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.<br>` +
                            `ìƒíƒœ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br><br>` +
                            `<small style="color: #a0a6b8;">ì˜¤ë¥˜ ë‚´ìš©: ${errorMessage}</small>`;
                        errorModal.show();
                    }
                    // í”„ë¡œì íŠ¸ ì¶”ê°€ ëª¨ë‹¬ ë‹«ê¸°
                    const modalElement = document.getElementById('apiProjectAddModal');
                    const modal = bootstrap.Modal.getInstance(modalElement);
                    if (modal) {
                        modal.hide();
                    }
                    // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    loadDataSupplyApiContent();
                    return;
                }
                
                // ëª¨ë“  APIê°€ ì„±ê³µí•œ ê²½ìš°
                // ë²„íŠ¼ í™œì„±í™”
                enableButtons();
                
                // ì„±ê³µ ëª¨ë‹¬ í‘œì‹œ
                const successModal = new bootstrap.Modal(document.getElementById('apiProjectAddSuccessModal'));
                successModal.show();
                
                // ì„±ê³µ ëª¨ë‹¬ì´ ë‹«í ë•Œ í”„ë¡œì íŠ¸ ì¶”ê°€ ëª¨ë‹¬ë„ ë‹«ê³  ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                document.getElementById('apiProjectAddSuccessModal').addEventListener('hidden.bs.modal', function() {
                    const modalElement = document.getElementById('apiProjectAddModal');
                    const modal = bootstrap.Modal.getInstance(modalElement);
                    if (modal) {
                        modal.hide();
                    }
                    loadDataSupplyApiContent();
                }, { once: true });
            } catch (error) {
                console.error('í”„ë¡œì íŠ¸ ì¶”ê°€ ì˜¤ë¥˜:', error);
                
                // ë²„íŠ¼ í™œì„±í™”
                enableButtons();
                
                // ì—ëŸ¬ ëª¨ë‹¬ í‘œì‹œ
                const errorModal = new bootstrap.Modal(document.getElementById('apiProjectAddErrorModal'));
                document.getElementById('apiProjectAddErrorMessage').textContent = 
                    'í”„ë¡œì íŠ¸ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message;
                errorModal.show();
            }
        }

        // API í”„ë¡œì íŠ¸ ìƒì„¸ ëª¨ë‹¬ ë¡œë”© ìƒíƒœ ê´€ë¦¬
        window.isApiProjectModalLoading = false;
        let currentModalComSeq = null;

        // API í”„ë¡œì íŠ¸ ìƒì„¸ ëª¨ë‹¬ í‘œì‹œ í•¨ìˆ˜
        async function showApiProjectDetailModal(comSeq) {
            // ì¤‘ë³µ í´ë¦­ ë°©ì§€
            if (window.isApiProjectModalLoading) {
                console.log('ëª¨ë‹¬ì´ ì´ë¯¸ ë¡œë”© ì¤‘ì…ë‹ˆë‹¤.');
                return;
            }
            
            // ê°™ì€ í”„ë¡œì íŠ¸ë¥¼ ë‹¤ì‹œ í´ë¦­í•œ ê²½ìš° ë¬´ì‹œ
            const modalElement = document.getElementById('apiProjectDetailModal');
            const existingModal = bootstrap.Modal.getInstance(modalElement);
            if (existingModal && existingModal._isShown && currentModalComSeq === comSeq) {
                console.log('ì´ë¯¸ ì—´ë ¤ìˆëŠ” ëª¨ë‹¬ì…ë‹ˆë‹¤.');
                return;
            }
            
            // ë¡œë”© ìƒíƒœ ì„¤ì •
            window.isApiProjectModalLoading = true;
            currentModalComSeq = comSeq;
            
            // ì¦‰ì‹œ ëª¨ë‹¬ ì—´ê¸° (ë¡œë”© í‘œì‹œì™€ í•¨ê»˜)
            const modal = new bootstrap.Modal(modalElement);
            
            // ë²„íŠ¼ ë¹„í™œì„±í™”
            const cancelBtn = document.getElementById('apiModalCancelBtn');
            const updateBtn = document.getElementById('apiModalUpdateBtn');
            const closeBtn = document.getElementById('apiModalCloseBtn');
            if (cancelBtn) cancelBtn.disabled = true;
            if (updateBtn) updateBtn.disabled = true;
            if (closeBtn) closeBtn.style.pointerEvents = 'none';
            
            // ëª¨ë‹¬ bodyì— ë¡œë”© í‘œì‹œ
            const modalBody = modalElement.querySelector('.modal-body');
            const originalContent = modalBody.innerHTML;
            modalBody.innerHTML = `
                <div style="text-align: center; padding: 60px;">
                    <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <h5 class="text-light mb-0">í”„ë¡œì íŠ¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</h5>
                    <p class="text-muted mt-2 mb-0">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>
                </div>
            `;
            
            modal.show();
            
            try {
                const response = await fetch(`/api/data-supply-api/projects/${comSeq}`);
                if (!response.ok) {
                    throw new Error('í”„ë¡œì íŠ¸ ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
                const detail = await response.json();
                
                console.log('í”„ë¡œì íŠ¸ ìƒì„¸ ì •ë³´:', detail);
                console.log('updateSearchDateYn:', detail.updateSearchDateYn);
                console.log('searchCountYn:', detail.searchCountYn);
                console.log('komoranYn:', detail.komoranYn);
                
                // ì›ë˜ ë‚´ìš© ë³µì›
                modalBody.innerHTML = originalContent;
                
                // ëª¨ë‹¬ì— ë°ì´í„° ì±„ìš°ê¸°
                document.getElementById('apiModalComName').value = detail.comName || '';
                document.getElementById('apiModalComKey').value = detail.comKey || '';
                
                // ë‚ ì§œ í¬ë§·íŒ… (YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ ë³€í™˜)
                if (detail.startDate) {
                    const startDate = new Date(detail.startDate);
                    const startDateStr = startDate.toISOString().split('T')[0];
                    document.getElementById('apiModalStartDate').value = startDateStr;
                } else {
                    document.getElementById('apiModalStartDate').value = '';
                }
                
                if (detail.endDate) {
                    const endDate = new Date(detail.endDate);
                    const endDateStr = endDate.toISOString().split('T')[0];
                    document.getElementById('apiModalEndDate').value = endDateStr;
                } else {
                    document.getElementById('apiModalEndDate').value = '';
                }
                
                // API_SUPPLY_SYSTEM í•„ë“œ (0 ê°’ë„ í‘œì‹œë˜ë„ë¡ nullish coalescing ì‚¬ìš©)
                document.getElementById('apiModalSearchStartDate').value = detail.searchStartDate != null ? detail.searchStartDate : '';
                document.getElementById('apiModalSearchDateDiff').value = detail.searchDateDiff != null ? detail.searchDateDiff : '';
                document.getElementById('apiModalUpdateSearchDateOffset').value = detail.updateSearchDateOffset != null ? detail.updateSearchDateOffset : '';
                document.getElementById('apiModalSearchByteLength').value = detail.searchByteLength != null ? detail.searchByteLength : '';
                document.getElementById('apiModalDailySearchTotalCount').value = detail.dailySearchTotalCount != null ? detail.dailySearchTotalCount : '';
                document.getElementById('apiModalMonthlySearchTotalCount').value = detail.monthlySearchTotalCount != null ? detail.monthlySearchTotalCount : '';
                document.getElementById('apiModalDailyTotalCount').value = detail.dailyTotalCount != null ? detail.dailyTotalCount : '';
                document.getElementById('apiModalMonthlyTotalCount').value = detail.monthlyTotalCount != null ? detail.monthlyTotalCount : '';
                document.getElementById('apiModalCommand').value = detail.command ?? '';
                
                // API_SUPPLY_HOST (ì—¬ëŸ¬ ê°œ)
                const hostsContainer = document.getElementById('apiModalHostsContainer');
                hostsContainer.innerHTML = '';
                if (detail.hosts && detail.hosts.length > 0) {
                    detail.hosts.forEach((host, index) => {
                        addApiHostInput(host, index);
                    });
                } else {
                    addApiHostInput('', 0);
                }
                
                // ë¼ë””ì˜¤ ë²„íŠ¼ ì„¤ì • (ë°ì´í„° ì±„ìš´ ì§í›„)
                // ê²€ìƒ‰ ì‹œì‘ ë‚ ì§œ ë™ì  ë³€ê²½ ì‚¬ìš© ì—¬ë¶€ ë¼ë””ì˜¤ ë²„íŠ¼
                const updateSearchDateYnY = document.getElementById('apiModalUpdateSearchDateYnY');
                const updateSearchDateYnN = document.getElementById('apiModalUpdateSearchDateYnN');
                if (updateSearchDateYnY && updateSearchDateYnN) {
                    updateSearchDateYnY.checked = false;
                    updateSearchDateYnN.checked = false;
                    if (detail.updateSearchDateYn) {
                        const value = String(detail.updateSearchDateYn).toUpperCase().trim();
                        console.log('Setting updateSearchDateYn to:', value);
                        if (value === 'Y') {
                            updateSearchDateYnY.checked = true;
                        } else if (value === 'N') {
                            updateSearchDateYnN.checked = true;
                        }
                    }
                }
                
                // ë¬¸ì„œ ê²€ìƒ‰ ìˆ˜ ì œí•œ ì‚¬ìš©ì—¬ë¶€ ë¼ë””ì˜¤ ë²„íŠ¼
                const searchCountYnY = document.getElementById('apiModalSearchCountYnY');
                const searchCountYnN = document.getElementById('apiModalSearchCountYnN');
                if (searchCountYnY && searchCountYnN) {
                    searchCountYnY.checked = false;
                    searchCountYnN.checked = false;
                    if (detail.searchCountYn) {
                        const value = String(detail.searchCountYn).toUpperCase().trim();
                        console.log('Setting searchCountYn to:', value);
                        if (value === 'Y') {
                            searchCountYnY.checked = true;
                        } else if (value === 'N') {
                            searchCountYnN.checked = true;
                        }
                    }
                }
                
                // ì½”ëª¨ë€ ì‚¬ìš© ì—¬ë¶€ ë¼ë””ì˜¤ ë²„íŠ¼
                const komoranYnY = document.getElementById('apiModalKomoranYnY');
                const komoranYnN = document.getElementById('apiModalKomoranYnN');
                if (komoranYnY && komoranYnN) {
                    komoranYnY.checked = false;
                    komoranYnN.checked = false;
                    if (detail.komoranYn) {
                        const value = String(detail.komoranYn).toUpperCase().trim();
                        console.log('Setting komoranYn to:', value);
                        if (value === 'Y') {
                            komoranYnY.checked = true;
                        } else if (value === 'N') {
                            komoranYnN.checked = true;
                        }
                    }
                }
                
                // ë²„íŠ¼ í™œì„±í™”
                if (cancelBtn) cancelBtn.disabled = false;
                if (updateBtn) updateBtn.disabled = false;
                if (closeBtn) closeBtn.style.pointerEvents = 'auto';
                
                // ëª¨ë‹¬ì´ ë‹«í ë•Œ ë¡œë”© ìƒíƒœ ì´ˆê¸°í™”
                modalElement.addEventListener('hidden.bs.modal', function() {
                    window.isApiProjectModalLoading = false;
                    currentModalComSeq = null;
                    // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³µêµ¬
                    const cancelBtn = document.getElementById('apiModalCancelBtn');
                    const updateBtn = document.getElementById('apiModalUpdateBtn');
                    const closeBtn = document.getElementById('apiModalCloseBtn');
                    if (cancelBtn) cancelBtn.disabled = false;
                    if (updateBtn) updateBtn.disabled = false;
                    if (closeBtn) closeBtn.style.pointerEvents = 'auto';
                }, { once: true });
                
                // ë¡œë”© ìƒíƒœ í•´ì œ
                window.isApiProjectModalLoading = false;
            } catch (error) {
                console.error('í”„ë¡œì íŠ¸ ìƒì„¸ ì •ë³´ ì¡°íšŒ ì˜¤ë¥˜:', error);
                
                // ì—ëŸ¬ ë°œìƒ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
                const modalElement = document.getElementById('apiProjectDetailModal');
                const existingModal = bootstrap.Modal.getInstance(modalElement);
                if (existingModal) {
                    existingModal.hide();
                }
                
                // ë¡œë”© ìƒíƒœ ì´ˆê¸°í™”
                window.isApiProjectModalLoading = false;
                currentModalComSeq = null;
                
                // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³µêµ¬
                const cancelBtn = document.getElementById('apiModalCancelBtn');
                const updateBtn = document.getElementById('apiModalUpdateBtn');
                const closeBtn = document.getElementById('apiModalCloseBtn');
                if (cancelBtn) cancelBtn.disabled = false;
                if (updateBtn) updateBtn.disabled = false;
                if (closeBtn) closeBtn.style.pointerEvents = 'auto';
                
                // ì—ëŸ¬ ëª¨ë‹¬ í‘œì‹œ
                const errorModal = new bootstrap.Modal(document.getElementById('apiProjectAddErrorModal'));
                document.getElementById('apiProjectAddErrorMessage').textContent = 
                    'í”„ë¡œì íŠ¸ ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message;
                errorModal.show();
            }
        }

        // IP ì…ë ¥ í•„ë“œ ì¶”ê°€ í•¨ìˆ˜
        function addApiHostInput(value = '', index = null) {
            const container = document.getElementById('apiModalHostsContainer');
            const hostIndex = index !== null ? index : container.children.length;
            const hostDiv = document.createElement('div');
            hostDiv.className = 'mb-2 d-flex gap-2';
            hostDiv.innerHTML = `
                <input type="text" class="form-control api-host-input" data-index="${hostIndex}" value="${value}" placeholder="IP ì£¼ì†Œ ì…ë ¥" style="background: #3a3f52; border: 1px solid #495057; color: #ffffff; max-width: 100%;">
                <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeApiHostInput(this)" style="border-color: #dc3545; color: #dc3545;">
                    <i class="fas fa-times"></i>
                </button>
            `;
            container.appendChild(hostDiv);
        }

        // IP ì…ë ¥ í•„ë“œ ì œê±° í•¨ìˆ˜
        function removeApiHostInput(button) {
            button.parentElement.remove();
        }

        // í”„ë¡œì íŠ¸ ìˆ˜ì • í•¨ìˆ˜
        async function updateApiProject() {
            // í˜„ì¬ ëª¨ë‹¬ì— í‘œì‹œëœ comSeq ê°€ì ¸ì˜¤ê¸°
            const modalElement = document.getElementById('apiProjectDetailModal');
            const comSeq = currentModalComSeq;
            
            if (!comSeq) {
                alert('í”„ë¡œì íŠ¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ëª¨ë‹¬ì„ ë‹«ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™”
            const cancelBtn = document.getElementById('apiModalCancelBtn');
            const updateBtn = document.getElementById('apiModalUpdateBtn');
            const closeBtn = modalElement.querySelector('.btn-close');
            
            if (cancelBtn) cancelBtn.disabled = true;
            if (updateBtn) updateBtn.disabled = true;
            if (closeBtn) closeBtn.style.pointerEvents = 'none';
            
            // ë²„íŠ¼ í™œì„±í™” í•¨ìˆ˜
            const enableButtons = () => {
                if (cancelBtn) cancelBtn.disabled = false;
                if (updateBtn) updateBtn.disabled = false;
                if (closeBtn) closeBtn.style.pointerEvents = 'auto';
            };
            
            try {
                // ì…ë ¥ê°’ ìˆ˜ì§‘
                const comName = document.getElementById('apiModalComName').value.trim();
                const startDate = document.getElementById('apiModalStartDate').value;
                const endDate = document.getElementById('apiModalEndDate').value;
                
                // í•„ìˆ˜ í•„ë“œ ê²€ì¦
                if (!comName) {
                    enableButtons();
                    alert('í”„ë¡œì íŠ¸ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                // ì‹œìŠ¤í…œ ì„¤ì • ê°’ ìˆ˜ì§‘
                const searchStartDate = document.getElementById('apiModalSearchStartDate').value ? 
                    parseInt(document.getElementById('apiModalSearchStartDate').value) : null;
                const searchDateDiff = document.getElementById('apiModalSearchDateDiff').value ? 
                    parseInt(document.getElementById('apiModalSearchDateDiff').value) : null;
                const updateSearchDateYn = document.querySelector('input[name="apiModalUpdateSearchDateYn"]:checked')?.value || null;
                const updateSearchDateOffset = document.getElementById('apiModalUpdateSearchDateOffset').value ? 
                    parseInt(document.getElementById('apiModalUpdateSearchDateOffset').value) : null;
                const searchByteLength = document.getElementById('apiModalSearchByteLength').value ? 
                    parseInt(document.getElementById('apiModalSearchByteLength').value) : null;
                const searchCountYn = document.querySelector('input[name="apiModalSearchCountYn"]:checked')?.value || null;
                const dailySearchTotalCount = document.getElementById('apiModalDailySearchTotalCount').value ? 
                    parseInt(document.getElementById('apiModalDailySearchTotalCount').value) : null;
                const monthlySearchTotalCount = document.getElementById('apiModalMonthlySearchTotalCount').value ? 
                    parseInt(document.getElementById('apiModalMonthlySearchTotalCount').value) : null;
                const dailyTotalCount = document.getElementById('apiModalDailyTotalCount').value ? 
                    parseInt(document.getElementById('apiModalDailyTotalCount').value) : null;
                const monthlyTotalCount = document.getElementById('apiModalMonthlyTotalCount').value ? 
                    parseInt(document.getElementById('apiModalMonthlyTotalCount').value) : null;
                const command = document.getElementById('apiModalCommand').value.trim() || null;
                const komoranYn = document.querySelector('input[name="apiModalKomoranYn"]:checked')?.value || null;
                
                // IP ì£¼ì†Œ ìˆ˜ì§‘
                const hostInputs = document.querySelectorAll('.api-host-input');
                const hosts = [];
                hostInputs.forEach(input => {
                    const host = input.value.trim();
                    if (host) {
                        hosts.push(host);
                    }
                });
                
                // ìš”ì²­ ë°ì´í„° êµ¬ì„±
                const requestData = {
                    comName: comName,
                    startDate: startDate || null,
                    endDate: endDate || null,
                    searchStartDate: searchStartDate,
                    searchDateDiff: searchDateDiff,
                    updateSearchDateYn: updateSearchDateYn,
                    updateSearchDateOffset: updateSearchDateOffset,
                    searchByteLength: searchByteLength,
                    searchCountYn: searchCountYn,
                    dailySearchTotalCount: dailySearchTotalCount,
                    monthlySearchTotalCount: monthlySearchTotalCount,
                    dailyTotalCount: dailyTotalCount,
                    monthlyTotalCount: monthlyTotalCount,
                    command: command,
                    komoranYn: komoranYn,
                    hosts: hosts
                };
                
                console.log('í”„ë¡œì íŠ¸ ìˆ˜ì • ìš”ì²­ ë°ì´í„°:', requestData);
                
                // API í˜¸ì¶œ
                const response = await fetch(`/api/data-supply-api/projects/${comSeq}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                const result = await response.json();
                
                if (!result.success) {
                    enableButtons();
                    // ì—ëŸ¬ ëª¨ë‹¬ í‘œì‹œ
                    const errorModal = new bootstrap.Modal(document.getElementById('apiProjectAddErrorModal'));
                    document.getElementById('apiProjectAddErrorMessage').textContent = 
                        'í”„ë¡œì íŠ¸ ìˆ˜ì • ì‹¤íŒ¨: ' + (result.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    errorModal.show();
                    return;
                }
                
                // UPDATE ì„±ê³µ í›„ ì™¸ë¶€ API í˜¸ì¶œ
                try {
                    console.log('ì™¸ë¶€ API í˜¸ì¶œ ì¤‘: reloadCompanyBySeq, ascSeq:', comSeq);
                    
                    // ë°±ì—”ë“œ í”„ë¡ì‹œë¥¼ í†µí•´ ì™¸ë¶€ API í˜¸ì¶œ
                    const proxyResponse = await fetch(`/api/data-supply-api/proxy/reloadCompanyBySeq?ascSeq=${comSeq}`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (!proxyResponse.ok) {
                        const proxyError = await proxyResponse.json();
                        console.error('ì™¸ë¶€ API í˜¸ì¶œ ì‹¤íŒ¨:', proxyError);
                        enableButtons();
                        // ì—ëŸ¬ ëª¨ë‹¬ í‘œì‹œ
                        const errorModal = new bootstrap.Modal(document.getElementById('apiProjectAddErrorModal'));
                        document.getElementById('apiProjectAddErrorMessage').textContent = 
                            'í”„ë¡œì íŠ¸ëŠ” ìˆ˜ì •ë˜ì—ˆì§€ë§Œ, ì™¸ë¶€ API í˜¸ì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (proxyError.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜');
                        errorModal.show();
                        return;
                    }
                    
                    const proxyResult = await proxyResponse.json();
                    console.log('ì™¸ë¶€ API ì‘ë‹µ:', proxyResult);
                    
                    if (!proxyResult.success) {
                        enableButtons();
                        // ì—ëŸ¬ ëª¨ë‹¬ í‘œì‹œ
                        const errorModal = new bootstrap.Modal(document.getElementById('apiProjectAddErrorModal'));
                        document.getElementById('apiProjectAddErrorMessage').textContent = 
                            'í”„ë¡œì íŠ¸ëŠ” ìˆ˜ì •ë˜ì—ˆì§€ë§Œ, ì™¸ë¶€ API í˜¸ì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (proxyResult.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜');
                        errorModal.show();
                        return;
                    }
                    
                    // ì‹¤ì œ API ì‘ë‹µ í™•ì¸
                    const apiResult = proxyResult.data;
                    console.log('ì™¸ë¶€ API ì‹¤ì œ ì‘ë‹µ:', apiResult);
                    
                    // ì •ìƒ ì‘ë‹µ í™•ì¸: {"result":null,"responseType":"NORMAL","query":"","responseFootprint":[],"errorMessageList":null}
                    if (!apiResult || apiResult.errorMessageList !== null) {
                        enableButtons();
                        // ì—ëŸ¬ ëª¨ë‹¬ í‘œì‹œ
                        const errorModal = new bootstrap.Modal(document.getElementById('apiProjectAddErrorModal'));
                        const errorMessage = apiResult.errorMessageList ? JSON.stringify(apiResult.errorMessageList) : 'ì˜¤ë¥˜ ë©”ì‹œì§€ê°€ ìˆìŠµë‹ˆë‹¤';
                        document.getElementById('apiProjectAddErrorMessage').textContent = 
                            'í”„ë¡œì íŠ¸ëŠ” ìˆ˜ì •ë˜ì—ˆì§€ë§Œ, ì™¸ë¶€ API ì‘ë‹µì— ì˜¤ë¥˜ê°€ ìˆìŠµë‹ˆë‹¤: ' + errorMessage;
                        errorModal.show();
                        return;
                    }
                    
                    console.log('ì™¸ë¶€ API í˜¸ì¶œ ì„±ê³µ');
                } catch (apiError) {
                    console.error('ì™¸ë¶€ API í˜¸ì¶œ ì˜¤ë¥˜:', apiError);
                    enableButtons();
                    // ì—ëŸ¬ ëª¨ë‹¬ í‘œì‹œ
                    const errorModal = new bootstrap.Modal(document.getElementById('apiProjectAddErrorModal'));
                    document.getElementById('apiProjectAddErrorMessage').textContent = 
                        'í”„ë¡œì íŠ¸ëŠ” ìˆ˜ì •ë˜ì—ˆì§€ë§Œ, ì™¸ë¶€ API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + apiError.message;
                    errorModal.show();
                    return;
                }
                
                // ëª¨ë“  ì‘ì—… ì„±ê³µ
                // ì„±ê³µ ëª¨ë‹¬ í‘œì‹œ
                const successModal = new bootstrap.Modal(document.getElementById('apiProjectAddSuccessModal'));
                document.getElementById('apiProjectAddSuccessMessage').textContent = 'í”„ë¡œì íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.';
                successModal.show();
                
                // ì„±ê³µ ëª¨ë‹¬ì´ ë‹«í ë•Œ í”„ë¡œì íŠ¸ ìƒì„¸ ëª¨ë‹¬ë„ ë‹«ê³  ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                document.getElementById('apiProjectAddSuccessModal').addEventListener('hidden.bs.modal', function() {
                    const modal = bootstrap.Modal.getInstance(modalElement);
                    if (modal) {
                        modal.hide();
                    }
                    loadDataSupplyApiContent();
                }, { once: true });
            } catch (error) {
                console.error('í”„ë¡œì íŠ¸ ìˆ˜ì • ì˜¤ë¥˜:', error);
                enableButtons();
                
                // ì—ëŸ¬ ëª¨ë‹¬ í‘œì‹œ
                const errorModal = new bootstrap.Modal(document.getElementById('apiProjectAddErrorModal'));
                document.getElementById('apiProjectAddErrorMessage').textContent = 
                    'í”„ë¡œì íŠ¸ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message;
                errorModal.show();
            }
        }
        
        // ì‹¤ì‹œê°„ ì£¼ìš” í‚¤ì›Œë“œ ì½˜í…ì¸  ë¡œë“œ í•¨ìˆ˜
        function loadKeywordsContent() {
            // 50ê°œì˜ ì„ì˜ í‚¤ì›Œë“œ ë°ì´í„° ìƒì„±
            const keywords = [
                { word: 'ì¸ê³µì§€ëŠ¥', count: 1250, rank: 1 },
                { word: 'ë¨¸ì‹ ëŸ¬ë‹', count: 1180, rank: 2 },
                { word: 'ë”¥ëŸ¬ë‹', count: 1150, rank: 3 },
                { word: 'ë°ì´í„° ë¶„ì„', count: 1100, rank: 4 },
                { word: 'ë¹…ë°ì´í„°', count: 1080, rank: 5 },
                { word: 'í´ë¼ìš°ë“œ', count: 1050, rank: 6 },
                { word: 'ë¸”ë¡ì²´ì¸', count: 1020, rank: 7 },
                { word: 'ì‚¬ì´ë²„ë³´ì•ˆ', count: 980, rank: 8 },
                { word: 'IoT', count: 950, rank: 9 },
                { word: '5G', count: 920, rank: 10 },
                { word: 'ììœ¨ì£¼í–‰', count: 890, rank: 11 },
                { word: 'ë©”íƒ€ë²„ìŠ¤', count: 860, rank: 12 },
                { word: 'NFT', count: 830, rank: 13 },
                { word: 'ìŠ¤ë§ˆíŠ¸íŒ©í† ë¦¬', count: 800, rank: 14 },
                { word: 'ë””ì§€í„¸íŠ¸ìœˆ', count: 770, rank: 15 },
                { word: 'ì–‘ìì»´í“¨íŒ…', count: 740, rank: 16 },
                { word: 'ë¡œë³´í‹±ìŠ¤', count: 710, rank: 17 },
                { word: 'ì¦ê°•í˜„ì‹¤', count: 680, rank: 18 },
                { word: 'ê°€ìƒí˜„ì‹¤', count: 650, rank: 19 },
                { word: 'ë„¤íŠ¸ì›Œí¬', count: 620, rank: 20 },
                { word: 'ì„œë²„', count: 590, rank: 21 },
                { word: 'ë°ì´í„°ë² ì´ìŠ¤', count: 560, rank: 22 },
                { word: 'ì•Œê³ ë¦¬ì¦˜', count: 530, rank: 23 },
                { word: 'í”„ë¡œê·¸ë˜ë°', count: 500, rank: 24 },
                { word: 'ê°œë°œ', count: 470, rank: 25 },
                { word: 'ì†Œí”„íŠ¸ì›¨ì–´', count: 440, rank: 26 },
                { word: 'í•˜ë“œì›¨ì–´', count: 410, rank: 27 },
                { word: 'ì‹œìŠ¤í…œ', count: 380, rank: 28 },
                { word: 'í”Œë«í¼', count: 350, rank: 29 },
                { word: 'API', count: 320, rank: 30 },
                { word: 'ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤', count: 290, rank: 31 },
                { word: 'ì»¨í…Œì´ë„ˆ', count: 260, rank: 32 },
                { word: 'ë„ì»¤', count: 230, rank: 33 },
                { word: 'ì¿ ë²„ë„¤í‹°ìŠ¤', count: 200, rank: 34 },
                { word: 'ë°ë¸Œì˜µìŠ¤', count: 170, rank: 35 },
                { word: 'CI/CD', count: 140, rank: 36 },
                { word: 'ì• ìì¼', count: 110, rank: 37 },
                { word: 'ìŠ¤í¬ëŸ¼', count: 100, rank: 38 },
                { word: 'ë§ˆì´ê·¸ë ˆì´ì…˜', count: 90, rank: 39 },
                { word: 'ìµœì í™”', count: 80, rank: 40 },
                { word: 'ì„±ëŠ¥', count: 70, rank: 41 },
                { word: 'ë³´ì•ˆ', count: 60, rank: 42 },
                { word: 'ì¸ì¦', count: 50, rank: 43 },
                { word: 'ì•”í˜¸í™”', count: 40, rank: 44 },
                { word: 'ë°±ì—…', count: 35, rank: 45 },
                { word: 'ë³µêµ¬', count: 30, rank: 46 },
                { word: 'ëª¨ë‹ˆí„°ë§', count: 25, rank: 47 },
                { word: 'ë¡œê¹…', count: 20, rank: 48 },
                { word: 'í…ŒìŠ¤íŠ¸', count: 15, rank: 49 },
                { word: 'ë””ë²„ê¹…', count: 10, rank: 50 }
            ];

            // í‚¤ì›Œë“œ ì°¨íŠ¸ ë Œë”ë§
            renderKeywordChart(keywords);
            
            // í‚¤ì›Œë“œ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
            renderKeywordList(keywords);
        }

        // ì „ì—­ ë³€ìˆ˜ë¡œ í‚¤ì›Œë“œ ë°ì´í„° ì €ì¥ (ì–‘ë°©í–¥ ì„ íƒì„ ìœ„í•´)
        let currentKeywordsData = null;
        let currentWordCloudCanvas = null;
        let selectedKeyword = null;

        // í‚¤ì›Œë“œ ì°¨íŠ¸ ë Œë”ë§ í•¨ìˆ˜ (WordCloud2.js ì‚¬ìš©)
        function renderKeywordChart(keywords) {
            const canvas = document.getElementById('wordcloudCanvas');
            
            // ì „ì—­ ë³€ìˆ˜ì— í‚¤ì›Œë“œ ë°ì´í„° ì €ì¥
            currentKeywordsData = keywords;
            
            // WordCloud2.js ë¼ì´ë¸ŒëŸ¬ë¦¬ í™•ì¸ (wordcloud2.jsëŠ” WordCloudë¡œ ì „ì—­ì— ë“±ë¡ë¨)
            if (!canvas) {
                console.error('Canvas ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (typeof WordCloud === 'undefined') {
                console.error('WordCloud2.jsê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
                // í´ë°±: ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
                const chartContainer = document.getElementById('keywordChart');
                if (chartContainer) {
                    chartContainer.innerHTML = '<div style="color: #e74c3c; text-align: center; padding: 50px;">ì›Œë“œ í´ë¼ìš°ë“œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
                }
                return;
            }

            // maxCountì™€ minCount ê³„ì‚°
            const maxCount = Math.max(...keywords.map(k => k.count));
            const minCount = Math.min(...keywords.map(k => k.count));

            // ìº”ë²„ìŠ¤ í¬ê¸° ì¡°ì • (ì•½ê°„ì˜ ì§€ì—°ì„ ì£¼ì–´ DOMì´ ì™„ì „íˆ ë Œë”ë§ëœ í›„ ì‹¤í–‰)
            setTimeout(() => {
                const chartContainer = document.getElementById('keywordChart');
                if (chartContainer && canvas) {
                    const rect = chartContainer.getBoundingClientRect();
                    // ìº”ë²„ìŠ¤ í¬ê¸°ë¥¼ í•©ë¦¬ì ì¸ ë²”ìœ„ë¡œ ì œí•œ (ë©”ëª¨ë¦¬ ì˜¤ë¥˜ ë°©ì§€)
                    // ìµœëŒ€ í¬ê¸°: 1200x800ìœ¼ë¡œ ì œí•œ (ë¸Œë¼ìš°ì € ë©”ëª¨ë¦¬ ì œí•œ ê³ ë ¤)
                    const maxWidth = 1200;
                    const maxHeight = 800;
                    const padding = 20;
                    const width = Math.min(Math.max(300, Math.floor(rect.width - padding)), maxWidth);
                    const height = Math.min(Math.max(300, Math.floor(rect.height - padding)), maxHeight);
                    
                    // ìº”ë²„ìŠ¤ í¬ê¸° ì„¤ì •
                    canvas.width = width;
                    canvas.height = height;
                    
                    // ì „ì—­ ë³€ìˆ˜ì— canvas ì €ì¥
                    currentWordCloudCanvas = canvas;
                    
                    console.log('ìº”ë²„ìŠ¤ í¬ê¸°:', width, 'x', height);
                    
                    // í¬ê¸° ì¡°ì • í›„ ì›Œë“œ í´ë¼ìš°ë“œ ìƒì„± (ì„ íƒëœ í‚¤ì›Œë“œê°€ ìˆìœ¼ë©´ ê°•ì¡°)
                    createWordCloud(canvas, keywords, maxCount, minCount, selectedKeyword);
                } else {
                    console.error('Chart container ë˜ëŠ” canvasë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            }, 200); // ì§€ì—° ì‹œê°„ì„ ì¡°ê¸ˆ ë” ëŠ˜ë¦¼
        }

        // ì›Œë“œ í´ë¼ìš°ë“œ ìƒì„± í•¨ìˆ˜
        function createWordCloud(canvas, keywords, maxCount, minCount, highlightWord = null) {
            if (!canvas) {
                console.error('Canvasê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (typeof WordCloud === 'undefined') {
                console.error('WordCloud í•¨ìˆ˜ê°€ ì •ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }

            // ìƒ‰ìƒ íŒ”ë ˆíŠ¸ ì •ì˜
            const colorPalette = [
                '#f39c12', '#e67e22', // ì£¼í™©ìƒ‰ (ìƒìœ„)
                '#e74c3c', '#c0392b', // ë¹¨ê°„ìƒ‰ (ìƒìœ„)
                '#4a90e2', '#357abd', // íŒŒë€ìƒ‰ (ì¤‘ìœ„)
                '#3498db', '#2980b9', // ë°ì€ íŒŒë€ìƒ‰ (ì¤‘ìœ„)
                '#2ecc71', '#27ae60', // ì´ˆë¡ìƒ‰ (ì¤‘ìœ„)
                '#6c7a89', '#5a6575', // íšŒìƒ‰ (í•˜ìœ„)
                '#95a5a6', '#7f8c8d'  // ì—°í•œ íšŒìƒ‰ (í•˜ìœ„)
            ];

            // WordCloud2.js í˜•ì‹ì˜ wordList ìƒì„±: [word, weight] ë˜ëŠ” [word, weight, color]
            const wordList = keywords.map(keyword => {
                const intensity = (keyword.count - minCount) / (maxCount - minCount || 1);
                let colorIndex;
                let color;
                
                // ì„ íƒëœ í‚¤ì›Œë“œì¸ ê²½ìš° ë°ì€ ìƒ‰ìƒìœ¼ë¡œ ê°•ì¡°
                const isHighlighted = highlightWord && keyword.word === highlightWord;
                
                if (isHighlighted) {
                    console.log('í‚¤ì›Œë“œ ê°•ì¡°:', keyword.word);
                    color = '#ffeb3b'; // ë…¸ë€ìƒ‰ìœ¼ë¡œ ê°•ì¡° (ë” ëˆˆì— ë„ê²Œ)
                } else {
                    if (intensity > 0.8) {
                        colorIndex = Math.floor(Math.random() * 2); // ì£¼í™©/ë¹¨ê°•
                    } else if (intensity > 0.5) {
                        colorIndex = 2 + Math.floor(Math.random() * 4); // íŒŒë‘/ì´ˆë¡
                    } else {
                        colorIndex = 6 + Math.floor(Math.random() * 2); // íšŒìƒ‰
                    }
                    color = colorPalette[colorIndex];
                }
                
                // WordCloud2.jsëŠ” [word, weight] ë˜ëŠ” [word, weight, color] í˜•ì‹ì„ ì§€ì›
                // ì„ íƒëœ í‚¤ì›Œë“œëŠ” ì•½ê°„ ë” í¬ê²Œ í‘œì‹œ
                let weight = Math.max(10, Math.floor(keyword.count / maxCount * 100));
                if (isHighlighted) {
                    weight = Math.min(100, weight + 30); // 30% ë” í¬ê²Œ (ë” ëˆˆì— ë„ê²Œ)
                    console.log('ê°•ì¡°ëœ í‚¤ì›Œë“œ weight:', weight, keyword.word);
                }
                return [keyword.word, weight, color];
            });

            // WordCloud2.js ì˜µì…˜ ì„¤ì •
            // ìº”ë²„ìŠ¤ í¬ê¸°ì— ë”°ë¼ ì ì ˆí•œ gridSizeì™€ weightFactor ê³„ì‚°
            const canvasSize = Math.min(canvas.width, canvas.height);
            // gridSizeë¥¼ ë” í¬ê²Œ ì„¤ì •í•˜ì—¬ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ê°ì†Œ
            const gridSize = Math.max(8, Math.min(20, Math.round(12 + canvasSize / 300)));
            
            const options = {
                list: wordList,
                gridSize: gridSize,
                weightFactor: function (size) {
                    // sizeëŠ” wordListì˜ weight ê°’ (0-100)
                    // ìº”ë²„ìŠ¤ í¬ê¸°ì— ë¹„ë¡€í•˜ë˜, ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ê³ ë ¤í•˜ì—¬ ì œí•œ
                    const baseSize = Math.min(canvasSize, 600); // ìµœëŒ€ 600px ê¸°ì¤€ìœ¼ë¡œ ë” ë³´ìˆ˜ì 
                    // weightFactorë¥¼ ë” ì‘ê²Œ ì„¤ì •í•˜ì—¬ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ê°ì†Œ
                    return Math.pow(size / 100, 1.3) * (baseSize / 15);
                },
                fontFamily: 'Segoe UI, Tahoma, Geneva, Verdana, sans-serif',
                color: function (word, weight, fontSize, distance, theta) {
                    // wordListì—ì„œ í•´ë‹¹ ë‹¨ì–´ì˜ ìƒ‰ìƒ ì°¾ê¸°
                    const item = wordList.find(w => w[0] === word);
                    return item && item[2] ? item[2] : '#4a90e2';
                },
                rotateRatio: 0, // ëª¨ë“  í…ìŠ¤íŠ¸ë¥¼ ê°€ë¡œ ë°©í–¥ìœ¼ë¡œ
                rotationSteps: 0,
                backgroundColor: 'transparent',
                minSize: 10,
                shuffle: false,
                shape: 'circle',
                ellipticity: 0.65,
                drawOutOfBound: false,
                shrinkToFit: true,
                hover: function(item) {
                    if (item) {
                        canvas.style.cursor = 'pointer';
                    } else {
                        canvas.style.cursor = 'default';
                    }
                },
                click: function(item) {
                    if (item) {
                        const clickedWord = item[0];
                        // ë¦¬ìŠ¤íŠ¸ì—ì„œ í•´ë‹¹ í‚¤ì›Œë“œ ì°¾ì•„ì„œ ìŠ¤í¬ë¡¤ ë° í•˜ì´ë¼ì´íŠ¸
                        if (currentKeywordsData) {
                            highlightKeywordInList(clickedWord);
                        }
                    }
                }
            };

            // ì›Œë“œ í´ë¼ìš°ë“œ ìƒì„±
            try {
                // ìº”ë²„ìŠ¤ ì´ˆê¸°í™” (ì´ì „ ê·¸ë¦¬ê¸° ì œê±°)
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // WordCloud2.js ì‹¤í–‰
                WordCloud(canvas, options);
            } catch (e) {
                console.error('ì›Œë“œ í´ë¼ìš°ë“œ ìƒì„± ì˜¤ë¥˜:', e);
                console.error('ì˜¤ë¥˜ ìƒì„¸:', e.message, e.stack);
            }
        }

        // í‚¤ì›Œë“œ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ í•¨ìˆ˜
        function renderKeywordList(keywords) {
            const listDiv = document.getElementById('keywordList');
            if (!listDiv) return;

            let html = '<div style="display: flex; flex-direction: column; gap: 6px;">';
            
            keywords.forEach(keyword => {
                const percentage = (keyword.count / Math.max(...keywords.map(k => k.count))) * 100;
                
                html += `
                    <div id="keyword-item-${keyword.rank}" class="keyword-list-item" data-keyword="${keyword.word}" style="
                        background: linear-gradient(135deg, #3a3f52, #2d3142);
                        border: 1px solid #4a4f62;
                        border-radius: 8px;
                        padding: 10px 12px;
                        display: flex;
                        align-items: center;
                        justify-content: space-between;
                        transition: all 0.3s ease;
                    " 
                    onmouseover="if (!this.classList.contains('selected')) { this.style.borderColor='#4a90e2'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(74, 144, 226, 0.3)'; }"
                    onmouseout="if (!this.classList.contains('selected')) { this.style.borderColor='#4a4f62'; this.style.transform='translateY(0)'; this.style.boxShadow='none'; }">
                        <div style="display: flex; align-items: center; gap: 15px; flex: 1;">
                            <div style="
                                width: 32px;
                                height: 32px;
                                border-radius: 6px;
                                background: ${keyword.rank <= 3 ? 'linear-gradient(135deg, #f39c12, #e67e22)' : keyword.rank <= 10 ? 'linear-gradient(135deg, #4a90e2, #357abd)' : '#3a3f52'};
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                color: #ffffff;
                                font-weight: 700;
                                font-size: 0.85rem;
                                flex-shrink: 0;
                            ">
                                ${keyword.rank}
                            </div>
                            <div style="flex: 1; min-width: 0;">
                                <div style="color: #ffffff; font-weight: 600; font-size: 0.95rem; margin-bottom: 6px;">
                                    ${keyword.word}
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <div style="
                                        flex: 1;
                                        height: 4px;
                                        background: #1a1d29;
                                        border-radius: 2px;
                                        overflow: hidden;
                                    ">
                                        <div style="
                                            width: ${percentage}%;
                                            height: 100%;
                                            background: ${keyword.rank <= 3 ? 'linear-gradient(90deg, #f39c12, #e67e22)' : keyword.rank <= 10 ? 'linear-gradient(90deg, #4a90e2, #357abd)' : 'linear-gradient(90deg, #6c7a89, #5a6575)'};
                                            transition: width 0.5s ease;
                                        "></div>
                                    </div>
                                    <span style="color: #a0a6b8; font-size: 0.85rem; min-width: 60px; text-align: right; flex-shrink: 0;">
                                        ${keyword.count.toLocaleString()}íšŒ
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            listDiv.innerHTML = html;
        }

        // ë¦¬ìŠ¤íŠ¸ì—ì„œ í‚¤ì›Œë“œ í•˜ì´ë¼ì´íŠ¸ ë° ìŠ¤í¬ë¡¤ í•¨ìˆ˜
        function highlightKeywordInList(word) {
            // ëª¨ë“  ì„ íƒ ìƒíƒœ ì œê±°
            document.querySelectorAll('.keyword-list-item').forEach(item => {
                item.classList.remove('selected');
                item.style.background = 'linear-gradient(135deg, #3a3f52, #2d3142)';
                item.style.borderColor = '#4a4f62';
                item.style.boxShadow = 'none';
            });

            // í•´ë‹¹ í‚¤ì›Œë“œ ì°¾ê¸°
            const keywordItem = document.querySelector(`[data-keyword="${word}"]`);
            if (keywordItem) {
                // ì„ íƒ ìƒíƒœ ì¶”ê°€
                keywordItem.classList.add('selected');
                keywordItem.style.background = 'linear-gradient(135deg, #4a90e2, #357abd)';
                keywordItem.style.borderColor = '#ffffff';
                keywordItem.style.boxShadow = '0 4px 20px rgba(74, 144, 226, 0.5)';
                keywordItem.style.transform = 'scale(1.02)';

                // ìŠ¤í¬ë¡¤í•˜ì—¬ í•´ë‹¹ ìš”ì†Œê°€ ë³´ì´ë„ë¡
                keywordItem.scrollIntoView({ behavior: 'smooth', block: 'center' });

                // 3ì´ˆ í›„ ì„ íƒ ìƒíƒœ ì œê±° (ì„ íƒì‚¬í•­)
                setTimeout(() => {
                    keywordItem.classList.remove('selected');
                    keywordItem.style.background = 'linear-gradient(135deg, #3a3f52, #2d3142)';
                    keywordItem.style.borderColor = '#4a4f62';
                    keywordItem.style.boxShadow = 'none';
                    keywordItem.style.transform = 'scale(1)';
                }, 3000);
            }
        }

        // ì›Œë“œ í´ë¼ìš°ë“œì—ì„œ í‚¤ì›Œë“œ í•˜ì´ë¼ì´íŠ¸ í•¨ìˆ˜ (ë¦¬ìŠ¤íŠ¸ ê°•ì¡°ë§Œ)
        function highlightKeywordInWordCloud(word) {
            // ë¦¬ìŠ¤íŠ¸ì—ì„œ í•˜ì´ë¼ì´íŠ¸ë§Œ ìˆ˜í–‰
            highlightKeywordInList(word);
        }

        // ì±„íŒ… ë©”ì‹œì§€ ë¹„ìš°ê¸° í•¨ìˆ˜
        function clearChatMessages() {
            const chatMessages = document.getElementById('chatMessages');
            const chatInput = document.getElementById('chatInput');
            if (!chatMessages || !chatInput) {
                return;
            }
            
            // ê²€ìƒ‰ ì¤‘ì´ë©´ ì‹¤í–‰ ë¶ˆê°€
            if (chatInput.disabled) {
                return;
            }
            
            // í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
            if (!confirm('ëª¨ë“  ì±„íŒ… ë©”ì‹œì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            // ëª¨ë“  ë©”ì‹œì§€ ì œê±°
            chatMessages.innerHTML = '';
            
            // ì´ˆê¸° í™˜ì˜ ë©”ì‹œì§€ ë‹¤ì‹œ ì¶”ê°€
            const welcomeDiv = document.createElement('div');
            welcomeDiv.className = 'chat-message bot-message';
            welcomeDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="message-content">
                    <div class="message-bubble bot-bubble">
                        ì•ˆë…•í•˜ì„¸ìš”! ì‹œìŠ¤í…œ ì±—ë´‡ì…ë‹ˆë‹¤. ì‹œìŠ¤í…œì— ëŒ€í•´ ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ì§ˆë¬¸í•´ì£¼ì„¸ìš”.
                    </div>
                    <div class="message-time">ì˜¤ëŠ˜</div>
                </div>
            `;
            chatMessages.appendChild(welcomeDiv);
            
            // ìŠ¤í¬ë¡¤ì„ ë§¨ ìœ„ë¡œ
            chatMessages.scrollTop = 0;
        }

        // ES ì—°ê²° ìƒíƒœ í™•ì¸ í•¨ìˆ˜
        function checkElasticsearchConnection() {
            // ES ì—°ê²° í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ê°„ë‹¨í•œ ì§ˆë¬¸ ì „ì†¡
            fetch('/api/chatbot/ask', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                credentials: 'same-origin',
                body: JSON.stringify({ question: 'í…ŒìŠ¤íŠ¸' })
            })
            .then(response => response.json())
            .then(data => {
                const answer = data.answer || '';
                const isEsError = answer.includes('Elasticsearch í´ëŸ¬ìŠ¤í„°ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤') || 
                                 answer.includes('ì±—ë´‡ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                
                if (isEsError) {
                    // í™˜ì˜ ë©”ì‹œì§€ë¥¼ ES ì—°ê²° ì‹¤íŒ¨ ë©”ì‹œì§€ë¡œ êµì²´
                    const chatMessages = document.getElementById('chatMessages');
                    if (chatMessages) {
                        const welcomeMsg = chatMessages.querySelector('.chat-message.bot-message');
                        if (welcomeMsg) {
                            welcomeMsg.innerHTML = `
                                <div class="message-avatar">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <div class="message-content">
                                    <div class="message-bubble bot-bubble" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                                        <span style="color: #ffcc00; font-weight: bold;">âš ï¸ </span>
                                        ${escapeHtml(answer)}
                                    </div>
                                    <div class="message-time">ì§€ê¸ˆ</div>
                                </div>
                            `;
                        }
                    }
                }
            })
            .catch(error => {
                console.error('ES ì—°ê²° í™•ì¸ ì˜¤ë¥˜:', error);
            });
        }

        // ì±—ë´‡ ë©”ì‹œì§€ ì „ì†¡ í•¨ìˆ˜
        function sendChatMessage() {
            const chatInput = document.getElementById('chatInput');
            const sendChatBtn = document.getElementById('sendChatBtn');
            const clearChatBtn = document.getElementById('clearChatBtn');
            const message = chatInput.value.trim();
            
            if (!message) {
                return;
            }
            
            // ì´ë¯¸ ê²€ìƒ‰ ì¤‘ì´ë©´ ì‹¤í–‰ ë¶ˆê°€
            if (chatInput.disabled) {
                return;
            }
            
            const chatMessages = document.getElementById('chatMessages');
            
            // ì…ë ¥ì°½, ì „ì†¡ ë²„íŠ¼, ì±„íŒ… ë¹„ìš°ê¸° ë²„íŠ¼ ë¹„í™œì„±í™”
            chatInput.disabled = true;
            if (sendChatBtn) {
                sendChatBtn.disabled = true;
                sendChatBtn.style.opacity = '0.5';
                sendChatBtn.style.cursor = 'not-allowed';
            }
            if (clearChatBtn) {
                clearChatBtn.disabled = true;
                clearChatBtn.style.opacity = '0.5';
                clearChatBtn.style.cursor = 'not-allowed';
            }
            
            // ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
            const userMessageDiv = document.createElement('div');
            userMessageDiv.className = 'chat-message user-message';
            const now = new Date();
            const timeString = now.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
            
            // í˜„ì¬ ì‚¬ìš©ìì˜ í”„ë¡œí•„ ì´ë¯¸ì§€ ê°€ì ¸ì˜¤ê¸°
            const profileImage = document.getElementById('profileImage');
            const userProfileImageSrc = profileImage ? profileImage.src : '/images/default/default-avatar.svg';
            
            userMessageDiv.innerHTML = `
                <div class="message-avatar">
                    <img src="${userProfileImageSrc}" 
                         alt="ì‚¬ìš©ì í”„ë¡œí•„" 
                         style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 2px solid #4a90e2;">
                </div>
                <div class="message-content">
                    <div class="message-bubble user-bubble">
                        ${escapeHtml(message)}
                    </div>
                    <div class="message-time">${timeString}</div>
                </div>
            `;
            
            chatMessages.appendChild(userMessageDiv);
            chatInput.value = '';
            
            // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // ë¡œë”© ë©”ì‹œì§€ ì¶”ê°€
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'chat-message bot-message';
            loadingDiv.id = 'loading-message';
            loadingDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="message-content">
                    <div class="message-bubble bot-bubble">
                        <i class="fas fa-spinner fa-spin me-2"></i>ë‹µë³€ì„ ê²€ìƒ‰í•˜ê³  ìˆìŠµë‹ˆë‹¤...
                    </div>
                </div>
            `;
            chatMessages.appendChild(loadingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // API í˜¸ì¶œ
            fetch('/api/chatbot/ask', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                credentials: 'same-origin',
                body: JSON.stringify({ question: message })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('ì„œë²„ ì˜¤ë¥˜: ' + response.status);
                }
                return response.json();
            })
            .then(data => {
                // ë¡œë”© ë©”ì‹œì§€ ì œê±°
                const loadingMsg = document.getElementById('loading-message');
                if (loadingMsg) {
                    loadingMsg.remove();
                }
                
                // ES ì—°ê²° ì‹¤íŒ¨ í™•ì¸
                const answer = data.answer || '';
                const isEsError = answer.includes('Elasticsearch í´ëŸ¬ìŠ¤í„°ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤') || 
                                 answer.includes('ì±—ë´‡ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤') ||
                                 data.success === false;
                
                // ì±—ë´‡ ì‘ë‹µ ì¶”ê°€
                const botMessageDiv = document.createElement('div');
                botMessageDiv.className = 'chat-message bot-message';
                const responseTime = new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
                
                let messageHtml = escapeHtml(answer || 'ì£„ì†¡í•©ë‹ˆë‹¤. ë‹µë³€ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                if (isEsError) {
                    messageHtml = `<span style="color: #ffcc00; font-weight: bold;">âš ï¸ </span>` + messageHtml;
                }
                
                botMessageDiv.innerHTML = `
                    <div class="message-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content">
                        <div class="message-bubble bot-bubble" style="${isEsError ? 'background: linear-gradient(135deg, #e74c3c, #c0392b);' : ''}">
                            ${messageHtml}
                        </div>
                        <div class="message-time">${responseTime}</div>
                    </div>
                `;
                
                chatMessages.appendChild(botMessageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // ì…ë ¥ì°½, ì „ì†¡ ë²„íŠ¼, ì±„íŒ… ë¹„ìš°ê¸° ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
                chatInput.disabled = false;
                if (sendChatBtn) {
                    sendChatBtn.disabled = false;
                    sendChatBtn.style.opacity = '1';
                    sendChatBtn.style.cursor = 'pointer';
                }
                if (clearChatBtn) {
                    clearChatBtn.disabled = false;
                    clearChatBtn.style.opacity = '1';
                    clearChatBtn.style.cursor = 'pointer';
                }
                chatInput.focus();
            })
            .catch(error => {
                console.error('ì±—ë´‡ API ì˜¤ë¥˜:', error);
                
                // ë¡œë”© ë©”ì‹œì§€ ì œê±°
                const loadingMsg = document.getElementById('loading-message');
                if (loadingMsg) {
                    loadingMsg.remove();
                }
                
                // ì—ëŸ¬ ë©”ì‹œì§€ ì¶”ê°€
                const errorDiv = document.createElement('div');
                errorDiv.className = 'chat-message bot-message';
                const errorTime = new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
                
                errorDiv.innerHTML = `
                    <div class="message-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content">
                        <div class="message-bubble bot-bubble">
                            ì£„ì†¡í•©ë‹ˆë‹¤. ì¼ì‹œì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.
                        </div>
                        <div class="message-time">${errorTime}</div>
                    </div>
                `;
                
                chatMessages.appendChild(errorDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // ì…ë ¥ì°½, ì „ì†¡ ë²„íŠ¼, ì±„íŒ… ë¹„ìš°ê¸° ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
                chatInput.disabled = false;
                if (sendChatBtn) {
                    sendChatBtn.disabled = false;
                    sendChatBtn.style.opacity = '1';
                    sendChatBtn.style.cursor = 'pointer';
                }
                if (clearChatBtn) {
                    clearChatBtn.disabled = false;
                    clearChatBtn.style.opacity = '1';
                    clearChatBtn.style.cursor = 'pointer';
                }
                chatInput.focus();
            });
        }
        
        // HTML ì´ìŠ¤ì¼€ì´í”„ í•¨ìˆ˜
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // ë°ì´í„° ì±—ë´‡ ë©”ì‹œì§€ ì „ì†¡ í•¨ìˆ˜
        function sendDataChatMessage() {
            const chatInput = document.getElementById('dataChatInput');
            const sendChatBtn = document.getElementById('sendDataChatBtn');
            const clearChatBtn = document.getElementById('clearDataChatBtn');
            const message = chatInput.value.trim();
            
            if (!message) {
                return;
            }
            
            // ì´ë¯¸ ê²€ìƒ‰ ì¤‘ì´ë©´ ì‹¤í–‰ ë¶ˆê°€
            if (chatInput.disabled) {
                return;
            }
            
            const chatMessages = document.getElementById('dataChatMessages');
            
            // ì…ë ¥ì°½, ì „ì†¡ ë²„íŠ¼, ì±„íŒ… ë¹„ìš°ê¸° ë²„íŠ¼ ë¹„í™œì„±í™”
            chatInput.disabled = true;
            if (sendChatBtn) {
                sendChatBtn.disabled = true;
                sendChatBtn.style.opacity = '0.5';
                sendChatBtn.style.cursor = 'not-allowed';
            }
            if (clearChatBtn) {
                clearChatBtn.disabled = true;
                clearChatBtn.style.opacity = '0.5';
                clearChatBtn.style.cursor = 'not-allowed';
            }
            
            // ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
            const userMessageDiv = document.createElement('div');
            userMessageDiv.className = 'chat-message user-message';
            const now = new Date();
            const timeString = now.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
            
            // í˜„ì¬ ì‚¬ìš©ìì˜ í”„ë¡œí•„ ì´ë¯¸ì§€ ê°€ì ¸ì˜¤ê¸°
            const profileImage = document.getElementById('profileImage');
            const userProfileImageSrc = profileImage ? profileImage.src : '/images/default/default-avatar.svg';
            
            userMessageDiv.innerHTML = `
                <div class="message-avatar">
                    <img src="${userProfileImageSrc}" 
                         alt="ì‚¬ìš©ì í”„ë¡œí•„" 
                         style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 2px solid #4a90e2;">
                </div>
                <div class="message-content">
                    <div class="message-bubble user-bubble">
                        ${escapeHtml(message)}
                    </div>
                    <div class="message-time">${timeString}</div>
                </div>
            `;
            
            chatMessages.appendChild(userMessageDiv);
            chatInput.value = '';
            
            // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // ë¡œë”© ë©”ì‹œì§€ ì¶”ê°€
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'chat-message bot-message';
            loadingDiv.id = 'data-loading-message';
            loadingDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="fas fa-database"></i>
                </div>
                <div class="message-content">
                    <div class="message-bubble bot-bubble">
                        <i class="fas fa-spinner fa-spin me-2"></i>ë°ì´í„°ë¥¼ ê²€ìƒ‰í•˜ê³  ë‹µë³€ì„ ìƒì„±í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...
                    </div>
                </div>
            `;
            chatMessages.appendChild(loadingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // API í˜¸ì¶œ
            fetch('/api/data-chatbot/ask', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                credentials: 'same-origin',
                body: JSON.stringify({ question: message })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('ì„œë²„ ì˜¤ë¥˜: ' + response.status);
                }
                return response.json();
            })
            .then(data => {
                // ë¡œë”© ë©”ì‹œì§€ ì œê±°
                const loadingMsg = document.getElementById('data-loading-message');
                if (loadingMsg) {
                    loadingMsg.remove();
                }
                
                const answer = data.answer || 'ì£„ì†¡í•©ë‹ˆë‹¤. ë‹µë³€ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                const sources = data.sources || [];
                
                // ë””ë²„ê¹…: sources í™•ì¸
                console.log('ë°ì´í„° ì±—ë´‡ ì‘ë‹µ:', data);
                console.log('ì°¸ê³  ìë£Œ ê°œìˆ˜:', sources.length);
                if (sources.length > 0) {
                    console.log('ì²« ë²ˆì§¸ ì°¸ê³  ìë£Œ:', sources[0]);
                }
                
                const isError = answer.includes('ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤') || 
                               answer.includes('ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤') ||
                               data.success === false;
                
                // ì±—ë´‡ ì‘ë‹µ ì¶”ê°€
                const botMessageDiv = document.createElement('div');
                botMessageDiv.className = 'chat-message bot-message';
                const responseTime = new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
                
                let messageHtml = escapeHtml(answer);
                if (isError) {
                    messageHtml = `<span style="color: #ffcc00; font-weight: bold;">âš ï¸ </span>` + messageHtml;
                }
                
                // ì†ŒìŠ¤ ì •ë³´ ì¶”ê°€ (ìˆëŠ” ê²½ìš°) - íŒŒë€ ë°°ê²½ì— ë§ê²Œ í°ìƒ‰ ê³„ì—´ ìƒ‰ìƒ ì‚¬ìš©
                // ìŠ¤ì½”ì–´ê°€ ì¶©ë¶„íˆ ë†’ì€ ê²½ìš°ì—ë§Œ ì°¸ê³  ìë£Œ í‘œì‹œ
                if (sources.length > 0 && !isError) {
                    messageHtml += '<div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255, 255, 255, 0.3);">';
                    messageHtml += '<div style="font-size: 0.85rem; color: #ffffff; margin-bottom: 8px; font-weight: 500;">ğŸ“š ì°¸ê³  ìë£Œ (' + sources.length + 'ê°œ):</div>';
                    sources.forEach((source, index) => {
                        messageHtml += '<div style="margin-bottom: 8px; padding: 8px; background: rgba(255, 255, 255, 0.15); border-radius: 6px; font-size: 0.85rem; border: 1px solid rgba(255, 255, 255, 0.2);">';
                        if (source.title) {
                            messageHtml += '<div style="font-weight: bold; color: #ffffff; margin-bottom: 4px;">' + escapeHtml(source.title) + '</div>';
                        }
                        if (source.siteName || source.writerNick) {
                            messageHtml += '<div style="color: #e8f4f8;">';
                            if (source.siteName) messageHtml += 'ì‚¬ì´íŠ¸: ' + escapeHtml(source.siteName) + ' ';
                            if (source.writerNick) messageHtml += 'ì‘ì„±ì: ' + escapeHtml(source.writerNick);
                            messageHtml += '</div>';
                        }
                        if (source.url) {
                            // URLì€ HTML ì†ì„±ì— ì‚¬ìš©ë˜ë¯€ë¡œ íŠ¹ìˆ˜ë¬¸ìë§Œ ì´ìŠ¤ì¼€ì´í”„
                            let safeUrl = source.url;
                            // HTML ì†ì„±ì—ì„œ ìœ„í—˜í•œ ë¬¸ìë§Œ ì´ìŠ¤ì¼€ì´í”„
                            safeUrl = safeUrl.replace(/"/g, '&quot;').replace(/'/g, '&#39;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                            messageHtml += '<div style="margin-top: 4px;"><a href="' + safeUrl + '" target="_blank" rel="noopener noreferrer" style="color: #ffd700; text-decoration: underline; font-weight: 500;">ğŸ”— ì›ë¬¸ ë³´ê¸°</a></div>';
                        }
                        messageHtml += '</div>';
                    });
                    messageHtml += '</div>';
                } else if (!isError && data.confidence !== undefined) {
                    // ì°¸ê³  ìë£Œê°€ ì—†ì§€ë§Œ ë‹µë³€ì€ ìˆëŠ” ê²½ìš° (ìŠ¤ì½”ì–´ê°€ ë‚®ì•„ì„œ í•„í„°ë§ë¨)
                    // confidenceê°€ ë‚®ìœ¼ë©´ ì°¸ê³  ìë£Œê°€ í•„í„°ë§ë˜ì—ˆì„ ê°€ëŠ¥ì„±ì´ ë†’ìŒ
                    if (data.confidence < 0.8) {
                        messageHtml += '<div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255, 255, 255, 0.3);">';
                        messageHtml += '<div style="font-size: 0.85rem; color: #e8f4f8; font-style: italic;">ğŸ’¡ ê´€ë ¨ì„±ì´ ë†’ì€ ì°¸ê³  ìë£Œë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë” êµ¬ì²´ì ì¸ ì§ˆë¬¸ì„ í•´ì£¼ì‹œë©´ ë” ì •í™•í•œ ë‹µë³€ì„ ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>';
                        messageHtml += '</div>';
                    }
                }
                
                // DOM ìš”ì†Œ ìƒì„± ë°©ì‹ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ ë§í¬ê°€ ì œëŒ€ë¡œ ì‘ë™í•˜ë„ë¡ í•¨
                const avatarDiv = document.createElement('div');
                avatarDiv.className = 'message-avatar';
                avatarDiv.innerHTML = '<i class="fas fa-database"></i>';
                
                const contentDiv = document.createElement('div');
                contentDiv.className = 'message-content';
                
                const bubbleDiv = document.createElement('div');
                bubbleDiv.className = 'message-bubble bot-bubble';
                if (isError) {
                    bubbleDiv.style.background = 'linear-gradient(135deg, #e74c3c, #c0392b)';
                }
                bubbleDiv.innerHTML = messageHtml;
                
                const timeDiv = document.createElement('div');
                timeDiv.className = 'message-time';
                timeDiv.textContent = responseTime;
                
                contentDiv.appendChild(bubbleDiv);
                contentDiv.appendChild(timeDiv);
                
                botMessageDiv.appendChild(avatarDiv);
                botMessageDiv.appendChild(contentDiv);
                
                chatMessages.appendChild(botMessageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // ë§í¬ê°€ ì œëŒ€ë¡œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸ (ë””ë²„ê¹…ìš©)
                const links = bubbleDiv.querySelectorAll('a');
                links.forEach((link, index) => {
                    const url = link.getAttribute('href');
                    console.log(`ì°¸ê³  ìë£Œ ë§í¬ ${index + 1}:`, url);
                    console.log(`ì°¸ê³  ìë£Œ ì†ŒìŠ¤ ${index + 1}:`, sources[index]);
                    // hrefê°€ ì—†ê±°ë‚˜ ìœ íš¨í•˜ì§€ ì•Šìœ¼ë©´ ê²½ê³ 
                    if (!url || url.trim() === '' || url === 'null' || url === '#') {
                        console.warn('ìœ íš¨í•˜ì§€ ì•Šì€ URL:', url);
                        // ì†ŒìŠ¤ì—ì„œ ì§ì ‘ URL ê°€ì ¸ì˜¤ê¸° ì‹œë„
                        if (sources[index] && sources[index].url) {
                            const sourceUrl = sources[index].url;
                            console.log('ì†ŒìŠ¤ì—ì„œ ì§ì ‘ URL ê°€ì ¸ì˜´:', sourceUrl);
                            link.setAttribute('href', sourceUrl);
                            link.style.color = '#ffd700';
                            link.style.textDecoration = 'underline';
                        } else {
                            link.style.pointerEvents = 'none';
                            link.style.opacity = '0.5';
                        }
                    }
                });
                
                // ì…ë ¥ì°½, ì „ì†¡ ë²„íŠ¼, ì±„íŒ… ë¹„ìš°ê¸° ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
                chatInput.disabled = false;
                if (sendChatBtn) {
                    sendChatBtn.disabled = false;
                    sendChatBtn.style.opacity = '1';
                    sendChatBtn.style.cursor = 'pointer';
                }
                if (clearChatBtn) {
                    clearChatBtn.disabled = false;
                    clearChatBtn.style.opacity = '1';
                    clearChatBtn.style.cursor = 'pointer';
                }
                chatInput.focus();
            })
            .catch(error => {
                console.error('ë°ì´í„° ì±—ë´‡ API ì˜¤ë¥˜:', error);
                
                // ë¡œë”© ë©”ì‹œì§€ ì œê±°
                const loadingMsg = document.getElementById('data-loading-message');
                if (loadingMsg) {
                    loadingMsg.remove();
                }
                
                // ì—ëŸ¬ ë©”ì‹œì§€ ì¶”ê°€
                const errorDiv = document.createElement('div');
                errorDiv.className = 'chat-message bot-message';
                const errorTime = new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
                
                errorDiv.innerHTML = `
                    <div class="message-avatar">
                        <i class="fas fa-database"></i>
                    </div>
                    <div class="message-content">
                        <div class="message-bubble bot-bubble" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                            <span style="color: #ffcc00; font-weight: bold;">âš ï¸ </span>
                            ${escapeHtml(error.message || 'ì¼ì‹œì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.')}
                        </div>
                        <div class="message-time">${errorTime}</div>
                    </div>
                `;
                
                chatMessages.appendChild(errorDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // ì…ë ¥ì°½, ì „ì†¡ ë²„íŠ¼, ì±„íŒ… ë¹„ìš°ê¸° ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
                chatInput.disabled = false;
                if (sendChatBtn) {
                    sendChatBtn.disabled = false;
                    sendChatBtn.style.opacity = '1';
                    sendChatBtn.style.cursor = 'pointer';
                }
                if (clearChatBtn) {
                    clearChatBtn.disabled = false;
                    clearChatBtn.style.opacity = '1';
                    clearChatBtn.style.cursor = 'pointer';
                }
                chatInput.focus();
            });
        }
        
        // ë°ì´í„° ì±—ë´‡ ë©”ì‹œì§€ ë¹„ìš°ê¸° í•¨ìˆ˜
        function clearDataChatMessages() {
            const chatMessages = document.getElementById('dataChatMessages');
            const chatInput = document.getElementById('dataChatInput');
            if (!chatMessages || !chatInput) {
                return;
            }
            
            // ê²€ìƒ‰ ì¤‘ì´ë©´ ì‹¤í–‰ ë¶ˆê°€
            if (chatInput.disabled) {
                return;
            }
            
            // í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
            if (!confirm('ëª¨ë“  ì±„íŒ… ë©”ì‹œì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            // ëª¨ë“  ë©”ì‹œì§€ ì œê±°
            chatMessages.innerHTML = '';
            
            // ì´ˆê¸° í™˜ì˜ ë©”ì‹œì§€ ë‹¤ì‹œ ì¶”ê°€
            const welcomeDiv = document.createElement('div');
            welcomeDiv.className = 'chat-message bot-message';
            welcomeDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="fas fa-database"></i>
                </div>
                <div class="message-content">
                    <div class="message-bubble bot-bubble">
                        ì•ˆë…•í•˜ì„¸ìš”! ë°ì´í„° ì±—ë´‡ì…ë‹ˆë‹¤. ì†Œì…œ ë°ì´í„°ì— ëŒ€í•´ ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹œë©´ ì§ˆë¬¸í•´ì£¼ì„¸ìš”.
                    </div>
                    <div class="message-time">ì˜¤ëŠ˜</div>
                </div>
            `;
            chatMessages.appendChild(welcomeDiv);
            
            // ìŠ¤í¬ë¡¤ì„ ë§¨ ìœ„ë¡œ
            chatMessages.scrollTop = 0;
        }
        
        // ë©¤ë²„ ê´€ë¦¬ ì½˜í…ì¸  ë¡œë“œ í•¨ìˆ˜
        function loadMembersContent() {
            const contentDiv = document.getElementById('members-content');
            
            // ë¡œë”© í‘œì‹œ
            contentDiv.innerHTML = `
                <div style="text-align: center; padding: 60px;">
                    <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p style="color: #a0a6b8; font-size: 1.1rem;">ë©¤ë²„ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>
            `;
            
            // AJAXë¡œ ë©¤ë²„ ë°ì´í„° ë¡œë“œ
            fetch('/members/api')
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        throw new Error(data.error);
                    }
                    
                    // í…Œì´ë¸” HTML ìƒì„±
                    let tableHtml = '';
                    if (data.content && data.content.length > 0) {
                        tableHtml = `
                            <table class="table" style="width: 100%; border-collapse: collapse; background: #2d3142; border-radius: 8px; overflow: hidden;">
                                <thead style="background: linear-gradient(135deg, #3a3f52, #2d3142);">
                                    <tr>
                                        <th style="padding: 10px 12px; text-align: center; color: #ffffff; font-weight: 600; border: none; font-size: 0.85rem;">í”„ë¡œí•„</th>
                                        <th style="padding: 10px 12px; text-align: center; color: #ffffff; font-weight: 600; border: none; font-size: 0.85rem;">ì‚¬ìš©ìëª…</th>
                                        <th style="padding: 10px 12px; text-align: center; color: #ffffff; font-weight: 600; border: none; font-size: 0.85rem;">ì´ë¦„</th>
                                        <th style="padding: 10px 12px; text-align: center; color: #ffffff; font-weight: 600; border: none; font-size: 0.85rem;">ì´ë©”ì¼</th>
                                        <th style="padding: 10px 12px; text-align: center; color: #ffffff; font-weight: 600; border: none; font-size: 0.85rem;">ì—­í• </th>
                                        <th style="padding: 10px 12px; text-align: center; color: #ffffff; font-weight: 600; border: none; font-size: 0.85rem;">ìƒíƒœ</th>
                                        <th style="padding: 10px 12px; text-align: center; color: #ffffff; font-weight: 600; border: none; font-size: 0.85rem;">ê°€ì…ì¼</th>
                                    </tr>
                                </thead>
                                <tbody>
                        `;
                        
                        data.content.forEach(user => {
                            const roleClass = user.role === 'ADMIN' ? 'role-admin' : 
                                           user.role === 'MANAGER' ? 'role-manager' : 'role-user';
                            const statusClass = user.enabled ? 'status-enabled' : 'status-disabled';
                            const statusText = user.enabled ? 'í™œì„±' : 'ë¹„í™œì„±';
                            const profileImage = user.profileImage || '/images/default/default-avatar.svg';
                            const createdAt = new Date(user.createdAt).toLocaleString('ko-KR', {
                                year: 'numeric',
                                month: '2-digit',
                                day: '2-digit',
                                hour: '2-digit',
                                minute: '2-digit'
                            });
                            
                            tableHtml += `
                                <tr style="border-bottom: 1px solid #3a3f52;">
                                    <td style="padding: 10px 12px; text-align: center; vertical-align: middle;">
                                        <img src="${profileImage}" class="profile-image" alt="${user.name}" style="width: 35px; height: 35px;">
                                    </td>
                                    <td style="padding: 10px 12px; text-align: center; vertical-align: middle; color: #ffffff; font-size: 0.85rem;">${user.username}</td>
                                    <td style="padding: 10px 12px; text-align: center; vertical-align: middle; color: #ffffff; font-size: 0.85rem;">${user.name}</td>
                                    <td style="padding: 10px 12px; text-align: center; vertical-align: middle; color: #ffffff; font-size: 0.85rem;">${user.email || '-'}</td>
                                    <td style="padding: 10px 12px; text-align: center; vertical-align: middle;">
                                        <span class="role-badge ${roleClass}" style="font-size: 0.75rem; padding: 4px 8px;">${user.role}</span>
                                    </td>
                                    <td style="padding: 10px 12px; text-align: center; vertical-align: middle;">
                                        <span class="status-badge ${statusClass}" style="font-size: 0.75rem; padding: 4px 8px;">${statusText}</span>
                                    </td>
                                    <td style="padding: 10px 12px; text-align: center; vertical-align: middle; color: #ffffff; font-size: 0.85rem;">${createdAt}</td>
                                </tr>
                            `;
                        });
                        
                        tableHtml += `
                                </tbody>
                            </table>
                        `;
                    } else {
                        tableHtml = `
                            <div class="no-data">
                                <i class="fas fa-users"></i>
                                <h3>ë“±ë¡ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                                <p>ìƒˆë¡œìš´ ì‚¬ìš©ìë¥¼ ë“±ë¡í•´ë³´ì„¸ìš”.</p>
                            </div>
                        `;
                    }
                    
                    // í˜ì´ì§€ë„¤ì´ì…˜ HTML ìƒì„±
                    let paginationHtml = '';
                    if (data.totalPages > 1) {
                        paginationHtml = `
                            <div style="display: flex; justify-content: center; margin-top: 15px;">
                                <nav>
                                    <ul class="pagination" style="display: flex; list-style: none; margin: 0; padding: 0;">
                                        <li class="page-item ${data.isFirst ? 'disabled' : ''}" style="margin: 0 2px;">
                                            <a class="page-link" href="#" onclick="loadMembersPage(0); return false;" style="color: #4a90e2; border: 1px solid #3a3f52; padding: 6px 12px; margin: 0 2px; border-radius: 6px; text-decoration: none; font-size: 0.85rem; transition: all 0.3s ease;">
                                                <i class="fas fa-angle-double-left"></i>
                                            </a>
                                        </li>
                                        <li class="page-item ${data.isFirst ? 'disabled' : ''}" style="margin: 0 2px;">
                                            <a class="page-link" href="#" onclick="loadMembersPage(${data.currentPage - 1}); return false;" style="color: #4a90e2; border: 1px solid #3a3f52; padding: 6px 12px; margin: 0 2px; border-radius: 6px; text-decoration: none; font-size: 0.85rem; transition: all 0.3s ease;">
                                                <i class="fas fa-angle-left"></i>
                                            </a>
                                        </li>
                        `;
                        
                        for (let i = 0; i < data.totalPages; i++) {
                            paginationHtml += `
                                <li class="page-item ${i === data.currentPage ? 'active' : ''}" style="margin: 0 2px;">
                                    <a class="page-link" href="#" onclick="loadMembersPage(${i}); return false;" style="color: ${i === data.currentPage ? '#ffffff' : '#4a90e2'}; background: ${i === data.currentPage ? 'linear-gradient(135deg, #4a90e2, #357abd)' : 'transparent'}; border: 1px solid #3a3f52; padding: 6px 12px; margin: 0 2px; border-radius: 6px; text-decoration: none; font-size: 0.85rem; transition: all 0.3s ease;">${i + 1}</a>
                                </li>
                            `;
                        }
                        
                        paginationHtml += `
                                        <li class="page-item ${data.isLast ? 'disabled' : ''}" style="margin: 0 2px;">
                                            <a class="page-link" href="#" onclick="loadMembersPage(${data.currentPage + 1}); return false;" style="color: #4a90e2; border: 1px solid #3a3f52; padding: 6px 12px; margin: 0 2px; border-radius: 6px; text-decoration: none; font-size: 0.85rem; transition: all 0.3s ease;">
                                                <i class="fas fa-angle-right"></i>
                                            </a>
                                        </li>
                                        <li class="page-item ${data.isLast ? 'disabled' : ''}" style="margin: 0 2px;">
                                            <a class="page-link" href="#" onclick="loadMembersPage(${data.totalPages - 1}); return false;" style="color: #4a90e2; border: 1px solid #3a3f52; padding: 6px 12px; margin: 0 2px; border-radius: 6px; text-decoration: none; font-size: 0.85rem; transition: all 0.3s ease;">
                                                <i class="fas fa-angle-double-right"></i>
                                            </a>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        `;
                    }
                    
                    // ìµœì¢… ì½˜í…ì¸  êµ¬ì„±
                    const content = `
                        <div class="data-table">
                            <div class="table-header">
                                <h3 class="table-title">ë©¤ë²„ ê´€ë¦¬</h3>
                                <p style="color: #a0a6b8; margin: 0; font-size: 0.9rem;">ì‚¬ìš©ì ê³„ì • ë° ê¶Œí•œ ê´€ë¦¬</p>
                            </div>
                            <div style="padding: 15px;">
                                ${tableHtml}
                                ${paginationHtml}
                            </div>
                        </div>
                    `;
                    
                    contentDiv.innerHTML = content
                })
                .catch(error => {
                    console.error('ë©¤ë²„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                    contentDiv.innerHTML = `
                        <div class="data-table">
                            <div class="table-header">
                                <h3 class="table-title">ë©¤ë²„ ê´€ë¦¬</h3>
                            </div>
                            <div style="text-align: center; padding: 60px;">
                                <div style="font-size: 3rem; color: #e74c3c; margin-bottom: 20px;">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <h3 style="color: #ffffff; margin-bottom: 10px;">ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</h3>
                                <p style="color: #a0a6b8;">ë©¤ë²„ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
                                <button class="btn btn-primary mt-3" onclick="loadMembersContent()">
                                    <i class="fas fa-redo me-2"></i>ë‹¤ì‹œ ì‹œë„
                                </button>
                            </div>
                        </div>
                    `;
                });
        }
        
        // ë©¤ë²„ í˜ì´ì§€ ë¡œë“œ í•¨ìˆ˜ (í˜ì´ì§€ë„¤ì´ì…˜ìš©)
        function loadMembersPage(page) {
            const contentDiv = document.getElementById('members-content');
            
            // ë¡œë”© í‘œì‹œ
            contentDiv.innerHTML = `
                <div style="text-align: center; padding: 60px;">
                    <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p style="color: #a0a6b8; font-size: 1.1rem;">ë©¤ë²„ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>
            `;
            
            // AJAXë¡œ ë©¤ë²„ ë°ì´í„° ë¡œë“œ
            fetch(`/members/api?page=${page}&size=10`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        throw new Error(data.error);
                    }
                    
                    // í…Œì´ë¸” HTML ìƒì„± (loadMembersContentì™€ ë™ì¼í•œ ë¡œì§)
                    let tableHtml = '';
                    if (data.content && data.content.length > 0) {
                        tableHtml = `
                            <table class="table" style="width: 100%; border-collapse: collapse; background: #2d3142; border-radius: 8px; overflow: hidden;">
                                <thead style="background: linear-gradient(135deg, #3a3f52, #2d3142);">
                                    <tr>
                                        <th style="padding: 10px 12px; text-align: center; color: #ffffff; font-weight: 600; border: none; font-size: 0.85rem;">í”„ë¡œí•„</th>
                                        <th style="padding: 10px 12px; text-align: center; color: #ffffff; font-weight: 600; border: none; font-size: 0.85rem;">ì‚¬ìš©ìëª…</th>
                                        <th style="padding: 10px 12px; text-align: center; color: #ffffff; font-weight: 600; border: none; font-size: 0.85rem;">ì´ë¦„</th>
                                        <th style="padding: 10px 12px; text-align: center; color: #ffffff; font-weight: 600; border: none; font-size: 0.85rem;">ì´ë©”ì¼</th>
                                        <th style="padding: 10px 12px; text-align: center; color: #ffffff; font-weight: 600; border: none; font-size: 0.85rem;">ì—­í• </th>
                                        <th style="padding: 10px 12px; text-align: center; color: #ffffff; font-weight: 600; border: none; font-size: 0.85rem;">ìƒíƒœ</th>
                                        <th style="padding: 10px 12px; text-align: center; color: #ffffff; font-weight: 600; border: none; font-size: 0.85rem;">ê°€ì…ì¼</th>
                                    </tr>
                                </thead>
                                <tbody>
                        `;
                        
                        data.content.forEach(user => {
                            const roleClass = user.role === 'ADMIN' ? 'role-admin' : 
                                           user.role === 'MANAGER' ? 'role-manager' : 'role-user';
                            const statusClass = user.enabled ? 'status-enabled' : 'status-disabled';
                            const statusText = user.enabled ? 'í™œì„±' : 'ë¹„í™œì„±';
                            const profileImage = user.profileImage || '/images/default/default-avatar.svg';
                            const createdAt = new Date(user.createdAt).toLocaleString('ko-KR', {
                                year: 'numeric',
                                month: '2-digit',
                                day: '2-digit',
                                hour: '2-digit',
                                minute: '2-digit'
                            });
                            
                            tableHtml += `
                                <tr style="border-bottom: 1px solid #3a3f52;">
                                    <td style="padding: 10px 12px; text-align: center; vertical-align: middle;">
                                        <img src="${profileImage}" class="profile-image" alt="${user.name}" style="width: 35px; height: 35px;">
                                    </td>
                                    <td style="padding: 10px 12px; text-align: center; vertical-align: middle; color: #ffffff; font-size: 0.85rem;">${user.username}</td>
                                    <td style="padding: 10px 12px; text-align: center; vertical-align: middle; color: #ffffff; font-size: 0.85rem;">${user.name}</td>
                                    <td style="padding: 10px 12px; text-align: center; vertical-align: middle; color: #ffffff; font-size: 0.85rem;">${user.email || '-'}</td>
                                    <td style="padding: 10px 12px; text-align: center; vertical-align: middle;">
                                        <span class="role-badge ${roleClass}" style="font-size: 0.75rem; padding: 4px 8px;">${user.role}</span>
                                    </td>
                                    <td style="padding: 10px 12px; text-align: center; vertical-align: middle;">
                                        <span class="status-badge ${statusClass}" style="font-size: 0.75rem; padding: 4px 8px;">${statusText}</span>
                                    </td>
                                    <td style="padding: 10px 12px; text-align: center; vertical-align: middle; color: #ffffff; font-size: 0.85rem;">${createdAt}</td>
                                </tr>
                            `;
                        });
                        
                        tableHtml += `
                                </tbody>
                            </table>
                        `;
                    } else {
                        tableHtml = `
                            <div class="no-data">
                                <i class="fas fa-users"></i>
                                <h3>ë“±ë¡ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                                <p>ìƒˆë¡œìš´ ì‚¬ìš©ìë¥¼ ë“±ë¡í•´ë³´ì„¸ìš”.</p>
                            </div>
                        `;
                    }
                    
                    // í˜ì´ì§€ë„¤ì´ì…˜ HTML ìƒì„±
                    let paginationHtml = '';
                    if (data.totalPages > 1) {
                        paginationHtml = `
                            <div style="display: flex; justify-content: center; margin-top: 15px;">
                                <nav>
                                    <ul class="pagination" style="display: flex; list-style: none; margin: 0; padding: 0;">
                                        <li class="page-item ${data.isFirst ? 'disabled' : ''}" style="margin: 0 2px;">
                                            <a class="page-link" href="#" onclick="loadMembersPage(0); return false;" style="color: #4a90e2; border: 1px solid #3a3f52; padding: 6px 12px; margin: 0 2px; border-radius: 6px; text-decoration: none; font-size: 0.85rem; transition: all 0.3s ease;">
                                                <i class="fas fa-angle-double-left"></i>
                                            </a>
                                        </li>
                                        <li class="page-item ${data.isFirst ? 'disabled' : ''}" style="margin: 0 2px;">
                                            <a class="page-link" href="#" onclick="loadMembersPage(${data.currentPage - 1}); return false;" style="color: #4a90e2; border: 1px solid #3a3f52; padding: 6px 12px; margin: 0 2px; border-radius: 6px; text-decoration: none; font-size: 0.85rem; transition: all 0.3s ease;">
                                                <i class="fas fa-angle-left"></i>
                                            </a>
                                        </li>
                        `;
                        
                        for (let i = 0; i < data.totalPages; i++) {
                            paginationHtml += `
                                <li class="page-item ${i === data.currentPage ? 'active' : ''}" style="margin: 0 2px;">
                                    <a class="page-link" href="#" onclick="loadMembersPage(${i}); return false;" style="color: ${i === data.currentPage ? '#ffffff' : '#4a90e2'}; background: ${i === data.currentPage ? 'linear-gradient(135deg, #4a90e2, #357abd)' : 'transparent'}; border: 1px solid #3a3f52; padding: 6px 12px; margin: 0 2px; border-radius: 6px; text-decoration: none; font-size: 0.85rem; transition: all 0.3s ease;">${i + 1}</a>
                                </li>
                            `;
                        }
                        
                        paginationHtml += `
                                        <li class="page-item ${data.isLast ? 'disabled' : ''}" style="margin: 0 2px;">
                                            <a class="page-link" href="#" onclick="loadMembersPage(${data.currentPage + 1}); return false;" style="color: #4a90e2; border: 1px solid #3a3f52; padding: 6px 12px; margin: 0 2px; border-radius: 6px; text-decoration: none; font-size: 0.85rem; transition: all 0.3s ease;">
                                                <i class="fas fa-angle-right"></i>
                                            </a>
                                        </li>
                                        <li class="page-item ${data.isLast ? 'disabled' : ''}" style="margin: 0 2px;">
                                            <a class="page-link" href="#" onclick="loadMembersPage(${data.totalPages - 1}); return false;" style="color: #4a90e2; border: 1px solid #3a3f52; padding: 6px 12px; margin: 0 2px; border-radius: 6px; text-decoration: none; font-size: 0.85rem; transition: all 0.3s ease;">
                                                <i class="fas fa-angle-double-right"></i>
                                            </a>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        `;
                    }
                    
                    // ìµœì¢… ì½˜í…ì¸  êµ¬ì„±
                    const content = `
                        <div class="data-table">
                            <div class="table-header">
                                <h3 class="table-title">ë©¤ë²„ ê´€ë¦¬</h3>
                                <p style="color: #a0a6b8; margin: 0; font-size: 0.9rem;">ì‚¬ìš©ì ê³„ì • ë° ê¶Œí•œ ê´€ë¦¬</p>
                            </div>
                            <div style="padding: 15px;">
                                ${tableHtml}
                                ${paginationHtml}
                            </div>
                        </div>
                    `;
                    
                    contentDiv.innerHTML = content;
                })
                .catch(error => {
                    console.error('ë©¤ë²„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                    contentDiv.innerHTML = `
                        <div class="data-table">
                            <div class="table-header">
                                <h3 class="table-title">ë©¤ë²„ ê´€ë¦¬</h3>
                            </div>
                            <div style="text-align: center; padding: 60px;">
                                <div style="font-size: 3rem; color: #e74c3c; margin-bottom: 20px;">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                                <h3 style="color: #ffffff; margin-bottom: 10px;">ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</h3>
                                <p style="color: #a0a6b8;">ë©¤ë²„ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
                                <button class="btn btn-primary mt-3" onclick="loadMembersContent()">
                                    <i class="fas fa-redo me-2"></i>ë‹¤ì‹œ ì‹œë„
                                </button>
                            </div>
                        </div>
                    `;
                });
        }
        
        // í†µê³„ ì¹´ë“œ í´ë¦­ í•¸ë“¤ëŸ¬
        function handleSummaryCardClick(event) {
            event.preventDefault();
            const onclickAttr = this.getAttribute('onclick');
            if (onclickAttr) {
                // onclick ì†ì„±ì—ì„œ ìƒíƒœ ì¶”ì¶œ
                const match = onclickAttr.match(/filterByStatus\('([^']+)'\)/);
                if (match) {
                    const status = match[1];
                    console.log('í†µê³„ ì¹´ë“œ í´ë¦­:', status);
                    filterByStatus(status);
                }
            }
        }
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ë“±ë¡ í•¨ìˆ˜
        function reattachEventListeners() {
            // í†µê³„ ì¹´ë“œ í´ë¦­ ì´ë²¤íŠ¸
            document.querySelectorAll('.summary-card.clickable').forEach(card => {
                // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
                card.removeEventListener('click', handleSummaryCardClick);
                // ìƒˆ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                card.addEventListener('click', handleSummaryCardClick);
            });
            
            // í”„ë¡œì íŠ¸ëª… í´ë¦­ ì´ë²¤íŠ¸
            document.querySelectorAll('.project-name.clickable').forEach(project => {
                project.addEventListener('click', function() {
                    const projectName = this.getAttribute('data-project-name');
                    const userName = this.getAttribute('data-user-name');
                    const query = this.getAttribute('data-query');
                    const progress = this.getAttribute('data-progress');
                    showProjectDetail(projectName, userName, query, progress, '', '', '', '', '');
                });
            });
            
            // í”„ë¡œì íŠ¸ ìƒì„± ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            const createProjectBtn = document.querySelector('button[onclick="showProjectCreateModal()"]');
            if (createProjectBtn) {
                createProjectBtn.addEventListener('click', showProjectCreateModal);
            }
        }

        // ë©”ë‰´ í´ë¦­ ì´ë²¤íŠ¸
        document.querySelectorAll('.menu-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const pageId = this.getAttribute('data-page');
                showPage(pageId);
            });
        });


        // ì›”ê°„ ë³´ê³ ì„œ ìƒì„± í•¨ìˆ˜
        function generateReport() {
            const button = event.target;
            const originalText = button.textContent;
            
            // ë¡œë”© ëª¨ë‹¬ í‘œì‹œ
            const loadingModal = new bootstrap.Modal(document.getElementById('loadingModal'));
            loadingModal.show();
            
            // ë²„íŠ¼ ë¹„í™œì„±í™”
            button.disabled = true;
            button.textContent = 'ìƒì„± ì¤‘...';
            
            // ì‹¤ì œ ë³´ê³ ì„œ ìƒì„± ìš”ì²­
            fetch('/report/generate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                loadingModal.hide();
                
                if (data.success) {
                    // ë‹¤ìš´ë¡œë“œ ë§í¬ ìƒì„±
                    const downloadLink = document.createElement('a');
                    downloadLink.href = '/report/download';
                    downloadLink.download = data.filename || 'RnD_ì›”ê°„ë³´ê³ _í˜„í™©.pptx';
                    document.body.appendChild(downloadLink);
                    downloadLink.click();
                    document.body.removeChild(downloadLink);
                    
                    alert('ë‹¤ìš´ë¡œë“œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    alert('ë³´ê³ ì„œ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + (data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            })
            .catch(error => {
                loadingModal.hide();
                console.error('Error:', error);
                alert('ë³´ê³ ì„œ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            })
            .finally(() => {
                // ë²„íŠ¼ ìƒíƒœ ë³µì›
                button.disabled = false;
                button.textContent = originalText;
            });
        }

        // ì‚¬ì´ë“œë°” í† ê¸€ ê¸°ëŠ¥
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const mainContent = document.querySelector('.main-content');
            const toggleIcon = document.querySelector('#sidebarToggle i');
            
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
            
            // ì•„ì´ì½˜ ë³€ê²½
            if (sidebar.classList.contains('collapsed')) {
                toggleIcon.className = 'fas fa-chevron-right';
            } else {
                toggleIcon.className = 'fas fa-bars';
            }
        }
        
        // í”„ë¡œì íŠ¸ ìƒì„± ëª¨ë‹¬ í‘œì‹œ í•¨ìˆ˜
        function showProjectCreateModal() {
            // ëª¨ë‹¬ ì—´ê¸° ì „ì— í•„ë“œ ëª©ë¡ ì´ˆê¸°í™”
            clearAllSelections();
            
            // í¼ í•„ë“œë“¤ë„ ì´ˆê¸°í™”
            document.getElementById('createProjectName').value = '';
            document.getElementById('createDataQuery').value = '';
            document.getElementById('dbHost').value = '';
            document.getElementById('dbDatabase').value = '';
            document.getElementById('dbTable').value = '';
            document.getElementById('dbUser').value = '';
            document.getElementById('dbPassword').value = '';
            
            const modalElement = document.getElementById('projectCreateModal');
            const modal = new bootstrap.Modal(modalElement, {
                backdrop: true,
                keyboard: true,
                focus: true
            });
            
            // ëª¨ë‹¬ì´ ë‹«í ë•Œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ (ì¤‘ë³µ ë°©ì§€)
            modalElement.removeEventListener('hidden.bs.modal', handleModalClose);
            modalElement.addEventListener('hidden.bs.modal', handleModalClose);
            
            modal.show();
        }
        
        // ëª¨ë‹¬ ë‹«ê¸° í•¸ë“¤ëŸ¬ í•¨ìˆ˜
        function handleModalClose() {
                // ë°±ë“œë¡­ ì œê±°
                const backdrops = document.querySelectorAll('.modal-backdrop');
                backdrops.forEach(backdrop => backdrop.remove());
                
                // body í´ë˜ìŠ¤ ì •ë¦¬
                document.body.classList.remove('modal-open');
                document.body.style.overflow = '';
                document.body.style.paddingRight = '';
                
                console.log('í”„ë¡œì íŠ¸ ìƒì„± ëª¨ë‹¬ì´ ë‹«í˜”ìŠµë‹ˆë‹¤.');
        }
        
        // í•„ë“œ ëª©ë¡ ë¡œë“œ í•¨ìˆ˜ (í´ë¦­ ë°©ì‹)
        function loadFieldList() {
            const availableFieldsDiv = document.getElementById('availableFields');
            const selectedFieldsDiv = document.getElementById('selectedFields');
            
            // AJAXë¡œ í•„ë“œ ëª©ë¡ ë¡œë“œ
            fetch('/data/create')
                .then(response => response.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const fieldList = doc.querySelector('.field-list');
                    
                    if (fieldList) {
                        const fieldItems = fieldList.querySelectorAll('.field-checkbox');
                        let availableHTML = '';
                        
                        fieldItems.forEach((item, index) => {
                            const checkbox = item.querySelector('input[type="checkbox"]');
                            const label = item.querySelector('label');
                            
                            if (checkbox && label) {
                                availableHTML += `
                                    <div class="field-item mb-2 p-2 clickable-field" 
                                         style="background: #2a2f42; border: 1px solid #4a4f62; border-radius: 6px; cursor: pointer; transition: all 0.3s ease;"
                                         data-field-id="${checkbox.value}" 
                                         data-field-name="${label.textContent}"
                                         onclick="moveFieldToSelected('${checkbox.value}', '${label.textContent}')">
                                        <div class="d-flex align-items-center">
                                            <i class="fas fa-plus-circle me-2" style="color: #28a745;"></i>
                                            <i class="fas fa-tag me-2" style="color: #6c757d;"></i>
                                            <span class="text-light" style="font-size: 14px;">${label.textContent}</span>
                                        </div>
                                    </div>
                                `;
                            }
                        });
                        
                        // í•„ë“œê°€ ì—†ëŠ” ê²½ìš°
                        if (fieldItems.length === 0) {
                            availableHTML = `
                                <div class="text-center py-4">
                                    <i class="fas fa-info-circle fa-2x mb-3" style="color: #6c757d;"></i>
                                    <p style="color: #a0a6b8; margin: 0;">ì‚¬ìš© ê°€ëŠ¥í•œ í•„ë“œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                                </div>
                            `;
                        }
                        
                        availableFieldsDiv.innerHTML = availableHTML;
                        
                        // í˜¸ë²„ íš¨ê³¼ ì¶”ê°€
                        setupFieldHoverEffects();
                        
                    } else {
                        availableFieldsDiv.innerHTML = `
                            <div class="text-center py-4">
                                <i class="fas fa-exclamation-triangle fa-2x mb-3" style="color: #e74c3c;"></i>
                                <p style="color: #e74c3c; margin: 0;">í•„ë“œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                            </div>
                        `;
                    }
                })
                .catch(error => {
                    console.error('í•„ë“œ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                    availableFieldsDiv.innerHTML = `
                        <div class="text-center py-4">
                            <i class="fas fa-exclamation-triangle fa-2x mb-3" style="color: #e74c3c;"></i>
                            <p style="color: #e74c3c; margin: 0;">í•„ë“œ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨</p>
                        </div>
                    `;
                });
        }
        
        // í˜¸ë²„ íš¨ê³¼ ì„¤ì • í•¨ìˆ˜
        function setupFieldHoverEffects() {
            const availableFields = document.querySelectorAll('.clickable-field');
            
            availableFields.forEach(field => {
                field.addEventListener('mouseenter', function() {
                    this.style.background = '#3a3f52';
                    this.style.borderColor = '#6c757d';
                    this.style.transform = 'translateX(5px)';
                });
                
                field.addEventListener('mouseleave', function() {
                    this.style.background = '#2a2f42';
                    this.style.borderColor = '#4a4f62';
                    this.style.transform = 'translateX(0)';
                });
            });
        }
        
        // í•„ë“œë¥¼ ì„ íƒëœ ì˜ì—­ìœ¼ë¡œ ì´ë™
        function moveFieldToSelected(fieldId, fieldName) {
            const selectedFieldsDiv = document.getElementById('selectedFields');
            
            // ì´ë¯¸ ì„ íƒëœ í•„ë“œì¸ì§€ í™•ì¸
            if (selectedFieldsDiv.querySelector(`[data-field-id="${fieldId}"]`)) {
                return;
            }
            
            const fieldHTML = `
                <div class="selected-field-item mb-2 p-2" 
                     style="background: #3a3f52; border: 1px solid #6c757d; border-radius: 6px; display: flex; align-items: center; justify-content: space-between; cursor: pointer; transition: all 0.3s ease;"
                     data-field-id="${fieldId}"
                     data-field-name="${fieldName}"
                     onclick="moveFieldToAvailable('${fieldId}', '${fieldName}')">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-check-circle me-2" style="color: #28a745;"></i>
                        <i class="fas fa-tag me-2" style="color: #6c757d;"></i>
                        <span class="text-light" style="font-size: 14px;">${fieldName}</span>
                    </div>
                    <i class="fas fa-times text-danger" style="font-size: 12px;"></i>
                </div>
            `;
            
            // ê¸°ì¡´ ì•ˆë‚´ ë©”ì‹œì§€ ì œê±°
            const placeholder = selectedFieldsDiv.querySelector('.text-muted');
            if (placeholder) {
                placeholder.remove();
            }
            
            selectedFieldsDiv.insertAdjacentHTML('beforeend', fieldHTML);
            
            // ì‚¬ìš© ê°€ëŠ¥í•œ í•„ë“œì—ì„œ í•´ë‹¹ í•„ë“œ ì œê±°
            const availableField = document.querySelector(`.clickable-field[data-field-id="${fieldId}"]`);
            if (availableField) {
                availableField.remove();
            }
        }
        
        // í•„ë“œë¥¼ ì‚¬ìš© ê°€ëŠ¥í•œ ì˜ì—­ìœ¼ë¡œ ì´ë™
        function moveFieldToAvailable(fieldId, fieldName) {
            const availableFieldsDiv = document.getElementById('availableFields');
            
            const fieldHTML = `
                <div class="field-item mb-2 p-2 clickable-field" 
                     style="background: #2a2f42; border: 1px solid #4a4f62; border-radius: 6px; cursor: pointer; transition: all 0.3s ease;"
                     data-field-id="${fieldId}" 
                     data-field-name="${fieldName}"
                     onclick="moveFieldToSelected('${fieldId}', '${fieldName}')">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-plus-circle me-2" style="color: #28a745;"></i>
                        <i class="fas fa-tag me-2" style="color: #6c757d;"></i>
                        <span class="text-light" style="font-size: 14px;">${fieldName}</span>
                    </div>
                </div>
            `;
            
            availableFieldsDiv.insertAdjacentHTML('beforeend', fieldHTML);
            
            // ì„ íƒëœ í•„ë“œì—ì„œ í•´ë‹¹ í•„ë“œ ì œê±°
            const selectedField = document.querySelector(`.selected-field-item[data-field-id="${fieldId}"]`);
            if (selectedField) {
                selectedField.remove();
            }
            
            // ì„ íƒëœ í•„ë“œê°€ ì—†ìœ¼ë©´ ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ
            const selectedFieldsDiv = document.getElementById('selectedFields');
            if (selectedFieldsDiv.children.length === 0) {
                selectedFieldsDiv.innerHTML = `
                    <p class="text-muted text-center mb-0">
                        <i class="fas fa-arrow-left me-2"></i>í•„ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”
                    </p>
                `;
            }
            
            // í˜¸ë²„ íš¨ê³¼ ì¬ì„¤ì •
            setupFieldHoverEffects();
        }
        
        // ì „ì²´ ì„ íƒ
        function moveAllToSelected() {
            const availableFields = document.querySelectorAll('.clickable-field');
            availableFields.forEach(field => {
                const fieldId = field.dataset.fieldId;
                const fieldName = field.dataset.fieldName;
                moveFieldToSelected(fieldId, fieldName);
            });
        }
        
        // ì „ì²´ í•´ì œ
        function moveAllToAvailable() {
            const selectedFields = document.querySelectorAll('.selected-field-item');
            selectedFields.forEach(field => {
                const fieldId = field.dataset.fieldId;
                const fieldName = field.dataset.fieldName || field.querySelector('span.text-light')?.textContent || `Field_${fieldId}`;
                moveFieldToAvailable(fieldId, fieldName);
            });
        }
        
        // ì´ˆê¸°í™”
        function clearAllSelections() {
            const selectedFieldsDiv = document.getElementById('selectedFields');
            const availableFieldsDiv = document.getElementById('availableFields');
            
            // ì„ íƒëœ í•„ë“œ ëª¨ë‘ ì œê±°
            selectedFieldsDiv.innerHTML = `
                <p class="text-muted text-center mb-0">
                    <i class="fas fa-arrow-left me-2"></i>í•„ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”
                </p>
            `;
            
            // ì‚¬ìš© ê°€ëŠ¥í•œ í•„ë“œ ë‹¤ì‹œ ë¡œë“œ
            loadFieldList();
        }
        
        // í”„ë¡œì íŠ¸ ìƒì„± ì œì¶œ í•¨ìˆ˜
        function createProjectSubmit() {
            const projectName = document.getElementById('createProjectName').value.trim();
            const dataQuery = document.getElementById('createDataQuery').value.trim();
            const dbHost = document.getElementById('dbHost').value.trim();
            const dbDatabase = document.getElementById('dbDatabase').value.trim();
            const dbTable = document.getElementById('dbTable').value.trim();
            const dbUser = document.getElementById('dbUser').value.trim();
            const dbPassword = document.getElementById('dbPassword').value.trim();
            
            // ê²½ê³  ëª¨ë‹¬ í‘œì‹œ í•¨ìˆ˜
            function showWarningModal(message) {
                const warningModal = new bootstrap.Modal(document.getElementById('projectCreateWarningModal'));
                document.getElementById('projectCreateWarningMessage').textContent = message;
                warningModal.show();
            }
            
            if (!projectName) {
                showWarningModal('í”„ë¡œì íŠ¸ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!dataQuery) {
                showWarningModal('ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ queryë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!dbHost) {
                showWarningModal('ë°ì´í„°ë² ì´ìŠ¤ í˜¸ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!dbDatabase) {
                showWarningModal('ë°ì´í„°ë² ì´ìŠ¤ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!dbTable) {
                showWarningModal('í…Œì´ë¸”ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!dbUser) {
                showWarningModal('ì‚¬ìš©ìëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!dbPassword) {
                showWarningModal('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ì„ íƒëœ í•„ë“œë“¤ ìˆ˜ì§‘ (ë“œë˜ê·¸ ì•¤ ë“œë¡­ ë°©ì‹)
            const selectedFields = [];
            const selectedFieldItems = document.querySelectorAll('#selectedFields .selected-field-item');
            selectedFieldItems.forEach(item => {
                selectedFields.push(item.dataset.fieldId);
            });
            
            // ì„ íƒëœ í•„ë“œê°€ ì—†ëŠ” ê²½ìš° ê²½ê³  ëª¨ë‹¬ í‘œì‹œ
            if (selectedFields.length === 0) {
                showWarningModal('ìµœì†Œ 1ê°œ ì´ìƒì˜ í•„ë“œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // API ìš”ì²­ ë°ì´í„° ìƒì„± (ì‹¤ì œ API í˜•ì‹ì— ë§ì¶¤)
            const apiData = {
                project_name: projectName,  // í”„ë¡œì íŠ¸ëª…
                query: {
                    query: {
                        query_string: {
                            query: dataQuery  // ë°ì´í„° ì¿¼ë¦¬ (í˜„ì¬ * ë¡œ ë˜ì–´ìˆëŠ” ë¶€ë¶„ì— ë“¤ì–´ê°)
                        }
                    }
                },
                host: dbHost,  // Host
                database: dbDatabase,  // Database
                table: dbTable,  // Table
                user: dbUser,  // User
                password: dbPassword,  // Password
                elasticsearch_index: "lucy_main_bac1_20250831",  // Elasticsearch ì¸ë±ìŠ¤ (ê³ ì •ê°’)
                fields: selectedFields  // ì„ íƒëœ í•„ë“œì˜ valueê°’ (ë°°ì—´ í˜•ì‹)
            };
            
            // ë¡œë”© ìƒíƒœ í™œì„±í™”
            const submitBtn = document.getElementById('projectCreateSubmitBtn');
            const cancelBtn = document.getElementById('projectCreateCancelBtn');
            
            // ë²„íŠ¼ ë¹„í™œì„±í™”
            submitBtn.disabled = true;
            cancelBtn.disabled = true;
            
            // ë¡œë”© ëª¨ë‹¬ í‘œì‹œ (ëª¨ë‹¬ ìœ„ì— í‘œì‹œ)
            const loadingModal = new bootstrap.Modal(document.getElementById('projectCreateLoadingModal'), {
                backdrop: 'static',
                keyboard: false
            });
            loadingModal.show();
            
            // API í˜¸ì¶œí•˜ì—¬ ê²€ì¦ (ë°±ì—”ë“œ í”„ë¡ì‹œë¥¼ í†µí•œ í˜¸ì¶œë¡œ CORS ë¬¸ì œ í•´ê²°)
            console.log('=== API í˜¸ì¶œ ì‹œì‘ ===');
            console.log('ìš”ì²­ ë°ì´í„°:', JSON.stringify(apiData, null, 2));
            
            fetch('/data/api/register-project', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(apiData)
            })
            .then(response => {
                console.log('í”„ë¡ì‹œ API ì‘ë‹µ ìƒíƒœ:', response.status);
                if (!response.ok) {
                    throw new Error(`API í˜¸ì¶œ ì‹¤íŒ¨: ${response.status}`);
                }
                return response.json();
            })
            .then(result => {
                console.log('í”„ë¡ì‹œ API ì‘ë‹µ ë°ì´í„°:', result);
                
                // í”„ë¡ì‹œ ì‘ë‹µì—ì„œ ì‹¤ì œ API ì‘ë‹µ ì¶”ì¶œ
                const apiResponse = result.data || result;
                console.log('ì‹¤ì œ API ì‘ë‹µ ë°ì´í„°:', apiResponse);
                
                // API ì‘ë‹µì—ì„œ "successfully" í™•ì¸
                // {"message":"Schema and metadata files created successfully"} í˜•ì‹
                const isSuccess = apiResponse && 
                    apiResponse.message && 
                    apiResponse.message.toLowerCase().includes('successfully');
                
                if (isSuccess) {
                    console.log('API í˜¸ì¶œ ì„±ê³µ í™•ì¸ë¨. DB insert ì§„í–‰...');
                    
                    // API ì„±ê³µ ì‹œ DBì— insert
                    const formData = new FormData();
                    formData.append('projectName', projectName);
                    formData.append('dataQuery', dataQuery);
                    formData.append('dbHost', dbHost);
                    formData.append('dbDatabase', dbDatabase);
                    formData.append('dbTable', dbTable);
                    formData.append('dbUser', dbUser);
                    formData.append('dbPassword', dbPassword);
                    formData.append('selectedFields', selectedFields.join(','));
                    
                    // DB insert ìš”ì²­
                    return fetch('/data/create', {
                        method: 'POST',
                        body: formData
                    });
                } else {
                    // ë¡œë”© ëª¨ë‹¬ ë‹«ê¸°
                    const loadingModalInstance = bootstrap.Modal.getInstance(document.getElementById('projectCreateLoadingModal'));
                    if (loadingModalInstance) {
                        loadingModalInstance.hide();
                    }
                    
                    // ì—ëŸ¬ ëª¨ë‹¬ í‘œì‹œ
                    const errorModal = new bootstrap.Modal(document.getElementById('projectCreateErrorModal'));
                    document.getElementById('projectCreateErrorMessage').innerHTML = 
                        'í”„ë¡œì íŠ¸ ìƒì„± ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br>ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.';
                    errorModal.show();
                    
                    // ë²„íŠ¼ ìƒíƒœ ë³µêµ¬
                    submitBtn.disabled = false;
                    cancelBtn.disabled = false;
                    
                    throw new Error('API ì‘ë‹µì´ ì„±ê³µì ì´ì§€ ì•ŠìŠµë‹ˆë‹¤. ì‘ë‹µ: ' + JSON.stringify(apiResponse));
                }
            })
            .then(response => {
                if (response.ok) {
                    console.log('DB insert ì„±ê³µ');
                    
                    // ë¡œë”© ëª¨ë‹¬ ë‹«ê¸°
                    const loadingModalInstance = bootstrap.Modal.getInstance(document.getElementById('projectCreateLoadingModal'));
                    if (loadingModalInstance) {
                        loadingModalInstance.hide();
                    }
                    
                    // ë²„íŠ¼ ìƒíƒœ ë³µêµ¬
                    submitBtn.disabled = false;
                    cancelBtn.disabled = false;
                    
                    // ì„±ê³µ ì‹œ ëª¨ë‹¬ ë‹«ê¸° ë° ë°ì´í„° ìƒˆë¡œê³ ì¹¨
                    const modal = bootstrap.Modal.getInstance(document.getElementById('projectCreateModal'));
                    modal.hide();
                    
                    // í¼ ì´ˆê¸°í™”
                    document.getElementById('projectCreateForm').reset();
                    
                    // ë°ì´í„° ìƒì„± ì½˜í…ì¸  ìƒˆë¡œê³ ì¹¨
                    loadDataSupplyContent();
                    
                    // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
                    showSuccessMessage('í”„ë¡œì íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    throw new Error('DB insert ì‹¤íŒ¨');
                }
            })
            .catch(error => {
                console.error('í”„ë¡œì íŠ¸ ìƒì„± ì‹¤íŒ¨:', error);
                
                // ë¡œë”© ëª¨ë‹¬ ë‹«ê¸°
                const loadingModalInstance = bootstrap.Modal.getInstance(document.getElementById('projectCreateLoadingModal'));
                if (loadingModalInstance) {
                    loadingModalInstance.hide();
                }
                
                // ì—ëŸ¬ ëª¨ë‹¬ í‘œì‹œ
                const errorModal = new bootstrap.Modal(document.getElementById('projectCreateErrorModal'));
                document.getElementById('projectCreateErrorMessage').innerHTML = 
                    'í”„ë¡œì íŠ¸ ìƒì„± ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br>ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.';
                errorModal.show();
                
                // ë²„íŠ¼ ìƒíƒœ ë³µêµ¬
                submitBtn.disabled = false;
                cancelBtn.disabled = false;
            });
        }
        
        // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
        function showSuccessMessage(message) {
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert alert-success alert-dismissible fade show';
            alertDiv.style.position = 'fixed';
            alertDiv.style.top = '20px';
            alertDiv.style.right = '20px';
            alertDiv.style.zIndex = '9999';
            alertDiv.innerHTML = `
                <i class="fas fa-check-circle me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `;
            
            document.body.appendChild(alertDiv);
            
            // 3ì´ˆ í›„ ìë™ ì œê±°
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.parentNode.removeChild(alertDiv);
                }
            }, 3000);
        }
        
        // ëŒ€ì‹œë³´ë“œ ì¶”ê°€ ëª¨ë‹¬ í‘œì‹œ í•¨ìˆ˜
        function showDashboardAddModal() {
            const modal = new bootstrap.Modal(document.getElementById('dashboardAddModal'));
            
            // ì•„ì´ì½˜ ëª©ë¡ ìƒì„± (ëŒ€ì‹œë³´ë“œ ì¹´ë“œì™€ ìœ ì‚¬í•œ ê¸°ìˆ /ë¶„ì„ ê´€ë ¨ ì•„ì´ì½˜)
            const icons = [
                'fas fa-chart-line', 'fas fa-chart-bar', 'fas fa-chart-pie', 'fas fa-chart-area',
                'fas fa-server', 'fas fa-database', 'fas fa-bolt', 'fas fa-stream',
                'fas fa-fire', 'fas fa-gauge', 'fas fa-microchip', 'fas fa-network-wired',
                'fas fa-cloud', 'fas fa-gear', 'fas fa-tools', 'fas fa-cog',
                'fas fa-sliders-h', 'fas fa-search', 'fas fa-filter', 'fas fa-eye',
                'fas fa-camera', 'fas fa-folder', 'fas fa-file', 'fas fa-code',
                'fas fa-terminal', 'fas fa-desktop', 'fas fa-laptop', 'fas fa-mobile-alt',
                'fas fa-tablet-alt', 'fas fa-globe', 'fas fa-link', 'fas fa-shield-alt',
                'fas fa-lock', 'fas fa-key', 'fas fa-bell', 'fas fa-calendar',
                'fas fa-clock', 'fas fa-stopwatch', 'fas fa-hourglass-half', 'fas fa-history',
                'fas fa-sync', 'fas fa-redo', 'fas fa-undo', 'fas fa-save',
                'fas fa-download', 'fas fa-upload', 'fas fa-share', 'fas fa-copy',
                'fas fa-cut', 'fas fa-paste', 'fas fa-edit', 'fas fa-trash',
                'fas fa-archive', 'fas fa-box', 'fas fa-cube', 'fas fa-layer-group'
            ];
            const emojiSelection = document.getElementById('emojiSelection');
            emojiSelection.innerHTML = '';
            
            icons.forEach(iconClass => {
                const iconBtn = document.createElement('button');
                iconBtn.type = 'button';
                iconBtn.className = 'emoji-btn';
                iconBtn.innerHTML = `<i class="${iconClass}"></i>`;
                iconBtn.style.cssText = 'background: #3a3f52; border: 2px solid #4a4f62; border-radius: 8px; padding: 10px; font-size: 1.5rem; cursor: pointer; transition: all 0.3s ease; color: #ffffff; display: flex; align-items: center; justify-content: center;';
                iconBtn.onmouseover = function() {
                    this.style.background = '#4a4f62';
                    this.style.transform = 'scale(1.1)';
                };
                iconBtn.onmouseout = function() {
                    if (!this.classList.contains('selected')) {
                        this.style.background = '#3a3f52';
                        this.style.transform = 'scale(1)';
                    }
                };
                iconBtn.onclick = function() {
                    // ëª¨ë“  ë²„íŠ¼ì—ì„œ selected í´ë˜ìŠ¤ ì œê±°
                    document.querySelectorAll('.emoji-btn').forEach(btn => {
                        btn.classList.remove('selected');
                        btn.style.background = '#3a3f52';
                        btn.style.borderColor = '#4a4f62';
                    });
                    // ì„ íƒëœ ë²„íŠ¼ì— selected í´ë˜ìŠ¤ ì¶”ê°€
                    this.classList.add('selected');
                    this.style.background = '#4a90e2';
                    this.style.borderColor = '#ffffff';
                    
                    // ì„ íƒëœ ì•„ì´ì½˜ ì €ì¥
                    window.selectedDashboardIcon = iconClass;
                };
                emojiSelection.appendChild(iconBtn);
            });
            
            // í¼ ì´ˆê¸°í™”
            document.getElementById('dashboardAddForm').reset();
            window.selectedDashboardIcon = null;
            
            modal.show();
        }
        
        // ëŒ€ì‹œë³´ë“œ ì¶”ê°€ ì œì¶œ í•¨ìˆ˜
        function addDashboardSubmit() {
            const name = document.getElementById('dashboardName').value.trim();
            const description = document.getElementById('dashboardDescription').value.trim();
            const icon = window.selectedDashboardIcon;
            const url = document.getElementById('dashboardUrl') ? document.getElementById('dashboardUrl').value.trim() : '';
            
            if (!name) {
                document.getElementById('dashboardErrorMessage').innerHTML = 'ëŒ€ì‹œë³´ë“œëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                const errorModal = new bootstrap.Modal(document.getElementById('dashboardErrorModal'));
                errorModal.show();
                return;
            }
            
            if (!description) {
                document.getElementById('dashboardErrorMessage').innerHTML = 'ì„¤ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                const errorModal = new bootstrap.Modal(document.getElementById('dashboardErrorModal'));
                errorModal.show();
                return;
            }
            
            if (!icon) {
                document.getElementById('dashboardErrorMessage').innerHTML = 'ì•„ì´ì½˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”.';
                const errorModal = new bootstrap.Modal(document.getElementById('dashboardErrorModal'));
                errorModal.show();
                return;
            }
            
            // ì„œë²„ì— ëŒ€ì‹œë³´ë“œ ì¶”ê°€ API í˜¸ì¶œ
            const formData = new FormData();
            formData.append('name', name);
            formData.append('description', description);
            formData.append('icon', icon);
            if (url) {
                formData.append('url', url);
            }
            
            fetch('/api/dashboard/add', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                // ëŒ€ì‹œë³´ë“œ ì¶”ê°€ ëª¨ë‹¬ ë‹«ê¸°
                const addModal = bootstrap.Modal.getInstance(document.getElementById('dashboardAddModal'));
                if (addModal) {
                    addModal.hide();
                }
                
                if (data.success) {
                    // í¼ ì´ˆê¸°í™”
                    document.getElementById('dashboardAddForm').reset();
                    window.selectedDashboardIcon = null;
                    
                    // ì„±ê³µ ëª¨ë‹¬ í‘œì‹œ
                    document.getElementById('dashboardSuccessMessage').textContent = 'ëŒ€ì‹œë³´ë“œê°€ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.';
                    const successModal = new bootstrap.Modal(document.getElementById('dashboardSuccessModal'));
                    successModal.show();
                    
                    // ëª¨ë‹¬ì´ ë‹«íŒ í›„ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                    document.getElementById('dashboardSuccessModal').addEventListener('hidden.bs.modal', function() {
                        location.reload();
                    }, { once: true });
                } else {
                    // ì‹¤íŒ¨ ëª¨ë‹¬ í‘œì‹œ
                    document.getElementById('dashboardErrorMessage').innerHTML = 
                        'ëŒ€ì‹œë³´ë“œ ì¶”ê°€ ì‹¤íŒ¨: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜') + '<br>ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.';
                    const errorModal = new bootstrap.Modal(document.getElementById('dashboardErrorModal'));
                    errorModal.show();
                }
            })
            .catch(error => {
                console.error('ëŒ€ì‹œë³´ë“œ ì¶”ê°€ ì‹¤íŒ¨:', error);
                
                // ëŒ€ì‹œë³´ë“œ ì¶”ê°€ ëª¨ë‹¬ ë‹«ê¸°
                const addModal = bootstrap.Modal.getInstance(document.getElementById('dashboardAddModal'));
                if (addModal) {
                    addModal.hide();
                }
                
                // ì‹¤íŒ¨ ëª¨ë‹¬ í‘œì‹œ
                document.getElementById('dashboardErrorMessage').innerHTML = 
                    'ëŒ€ì‹œë³´ë“œ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br>ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.';
                const errorModal = new bootstrap.Modal(document.getElementById('dashboardErrorModal'));
                errorModal.show();
            });
        }
        
        // ëŒ€ì‹œë³´ë“œ ì¹´ë“œ í´ë¦­ ì²˜ë¦¬ í•¨ìˆ˜
        function handleDashboardCardClick(cardType, url) {
            console.log('ëŒ€ì‹œë³´ë“œ ì¹´ë“œ í´ë¦­:', cardType, url);
            
            // ë¹„í™œì„±í™”ëœ ì¹´ë“œ í´ë¦­ ì‹œ ë¬´ì‹œ
            if (cardType === 'disabled' || !url) {
                return;
            }
            
            // URLì´ ìˆìœ¼ë©´ í•´ë‹¹ URLë¡œ ì´ë™
            if (url && url.trim() !== '') {
                window.open(url, '_blank');
            }
        }
        
        // ëŒ€ì‹œë³´ë“œ ì‚­ì œ í•¨ìˆ˜
        function deleteDashboard(dashboardSeq, event) {
            // ì´ë²¤íŠ¸ ì „íŒŒ ì¤‘ì§€ (ì¹´ë“œ í´ë¦­ ì´ë²¤íŠ¸ ë°©ì§€)
            if (event) {
                event.stopPropagation();
            }
            
            // ì‚­ì œ í™•ì¸ ëª¨ë‹¬ í‘œì‹œ
            const confirmModal = new bootstrap.Modal(document.getElementById('dashboardDeleteConfirmModal'));
            
            // ì‚­ì œ ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ (í•œ ë²ˆë§Œ)
            const confirmBtn = document.getElementById('dashboardDeleteConfirmBtn');
            const newConfirmBtn = confirmBtn.cloneNode(true);
            confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);
            
            newConfirmBtn.addEventListener('click', function() {
                // ëª¨ë‹¬ ë‹«ê¸°
                const modalInstance = bootstrap.Modal.getInstance(document.getElementById('dashboardDeleteConfirmModal'));
                if (modalInstance) {
                    modalInstance.hide();
                }
                
                // ì‚­ì œ API í˜¸ì¶œ
                performDashboardDelete(dashboardSeq);
            });
            
            confirmModal.show();
        }
        
        // ëŒ€ì‹œë³´ë“œ ì‚­ì œ ì‹¤í–‰ í•¨ìˆ˜
        function performDashboardDelete(dashboardSeq) {
            // ì‚­ì œ API í˜¸ì¶œ
            fetch('/api/dashboard/delete/' + dashboardSeq, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // ì„±ê³µ ëª¨ë‹¬ í‘œì‹œ
                    document.getElementById('dashboardSuccessMessage').textContent = 'ëŒ€ì‹œë³´ë“œê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.';
                    const successModal = new bootstrap.Modal(document.getElementById('dashboardSuccessModal'));
                    successModal.show();
                    
                    // ëª¨ë‹¬ì´ ë‹«íŒ í›„ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                    document.getElementById('dashboardSuccessModal').addEventListener('hidden.bs.modal', function() {
                        location.reload();
                    }, { once: true });
                } else {
                    // ì‹¤íŒ¨ ëª¨ë‹¬ í‘œì‹œ
                    document.getElementById('dashboardErrorMessage').innerHTML = 
                        'ëŒ€ì‹œë³´ë“œ ì‚­ì œ ì‹¤íŒ¨: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜') + '<br>ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.';
                    const errorModal = new bootstrap.Modal(document.getElementById('dashboardErrorModal'));
                    errorModal.show();
                }
            })
            .catch(error => {
                console.error('ëŒ€ì‹œë³´ë“œ ì‚­ì œ ì‹¤íŒ¨:', error);
                
                // ì‹¤íŒ¨ ëª¨ë‹¬ í‘œì‹œ
                document.getElementById('dashboardErrorMessage').innerHTML = 
                    'ëŒ€ì‹œë³´ë“œ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br>ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.';
                const errorModal = new bootstrap.Modal(document.getElementById('dashboardErrorModal'));
                errorModal.show();
            });
        }
        
        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ê´€ë ¨ ë³€ìˆ˜
        let draggedElement = null;
        let draggedIndex = -1;
        
        // ë“œë˜ê·¸ ì‹œì‘
        function handleDragStart(event) {
            // ë“œë˜ê·¸ í•¸ë“¤ì—ì„œ ë“œë˜ê·¸ ì‹œì‘
            draggedElement = event.currentTarget.closest('.dashboard-card');
            if (!draggedElement) {
                event.preventDefault();
                return false;
            }
            
            draggedIndex = Array.from(draggedElement.parentElement.children).indexOf(draggedElement);
            
            // ë“œë˜ê·¸ ì¤‘ì¸ ìš”ì†Œë¥¼ í´ë¡ í•˜ì—¬ ì»¤ìŠ¤í…€ ë“œë˜ê·¸ ì´ë¯¸ì§€ ìƒì„±
            const dragClone = draggedElement.cloneNode(true);
            dragClone.style.position = 'absolute';
            dragClone.style.top = '-1000px';
            dragClone.style.left = '-1000px';
            dragClone.style.width = draggedElement.offsetWidth + 'px';
            dragClone.style.height = draggedElement.offsetHeight + 'px';
            dragClone.style.opacity = '0.8';
            dragClone.style.transform = 'rotate(3deg)';
            dragClone.style.boxShadow = '0 10px 30px rgba(0, 0, 0, 0.5)';
            dragClone.style.pointerEvents = 'none';
            dragClone.style.zIndex = '9999';
            document.body.appendChild(dragClone);
            
            // ì»¤ìŠ¤í…€ ë“œë˜ê·¸ ì´ë¯¸ì§€ ì„¤ì •
            event.dataTransfer.setDragImage(dragClone, draggedElement.offsetWidth / 2, draggedElement.offsetHeight / 2);
            
            // ë“œë˜ê·¸ ì´ë¯¸ì§€ ìš”ì†Œë¥¼ ë‚˜ì¤‘ì— ì œê±°í•˜ê¸° ìœ„í•´ ì €ì¥
            setTimeout(() => {
                if (dragClone && dragClone.parentNode) {
                    dragClone.parentNode.removeChild(dragClone);
                }
            }, 0);
            
            draggedElement.style.opacity = '0.5';
            draggedElement.style.cursor = 'grabbing';
            event.dataTransfer.effectAllowed = 'move';
            event.dataTransfer.setData('text/html', draggedElement.outerHTML);
            event.dataTransfer.setData('text/plain', draggedElement.dataset.seq);
        }
        
        // ë“œë˜ê·¸ ì˜¤ë²„
        function handleDragOver(event) {
            event.preventDefault();
            event.dataTransfer.dropEffect = 'move';
            
            const target = event.currentTarget;
            if (target === draggedElement) {
                return;
            }
            
            const allCards = Array.from(target.parentElement.children);
            const targetIndex = allCards.indexOf(target);
            const draggedIndex = allCards.indexOf(draggedElement);
            
            if (draggedIndex < targetIndex) {
                target.parentElement.insertBefore(draggedElement, target.nextSibling);
            } else {
                target.parentElement.insertBefore(draggedElement, target);
            }
        }
        
        // ë“œë¡­
        function handleDrop(event) {
            event.preventDefault();
            event.stopPropagation();
            
            if (draggedElement) {
                draggedElement.style.opacity = '1';
                
                // ìƒˆë¡œìš´ ìˆœì„œë¡œ DB ì—…ë°ì´íŠ¸
                updateDashboardOrder();
            }
            
            return false;
        }
        
        // ë“œë˜ê·¸ ì¢…ë£Œ
        function handleDragEnd(event) {
            if (draggedElement) {
                draggedElement.style.opacity = '1';
                draggedElement.style.cursor = 'pointer';
            }
            draggedElement = null;
            draggedIndex = -1;
        }
        
        // ëŒ€ì‹œë³´ë“œ ìˆœì„œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateDashboardOrder() {
            const container = document.getElementById('dashboardCardsContainer');
            const cards = Array.from(container.children);
            
            // ìˆœì„œ ì •ë³´ ìˆ˜ì§‘
            const orderData = [];
            cards.forEach((card, index) => {
                const seq = card.dataset.seq;
                if (seq) {
                    orderData.push({
                        seq: parseInt(seq),
                        order: index + 1
                    });
                }
            });
            
            // API í˜¸ì¶œí•˜ì—¬ ìˆœì„œ ì—…ë°ì´íŠ¸
            fetch('/api/dashboard/update-order', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(orderData)
            })
            .then(response => response.json())
            .then(data => {
                if (!data.success) {
                    console.error('ìˆœì„œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', data.error);
                    // ì‹¤íŒ¨ ì‹œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ì›ë˜ ìˆœì„œë¡œ ë³µêµ¬
                    location.reload();
                }
            })
            .catch(error => {
                console.error('ìˆœì„œ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ ì‹œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ì›ë˜ ìˆœì„œë¡œ ë³µêµ¬
                location.reload();
            });
        }

        // í”„ë¡œì íŠ¸ ìƒì„¸ ì •ë³´ í‘œì‹œ í•¨ìˆ˜
        function showProjectDetail(seq, projectName, userName, query, progress, status, host, database, table, dbUser) {
            // ëª¨ë‹¬ì— ë°ì´í„° ì„¤ì •
            document.getElementById('modalProjectName').textContent = projectName;
            document.getElementById('modalUserName').textContent = userName;
            
            // ì¿¼ë¦¬ ì •ë³´ ì„¤ì •
            const queryElement = document.getElementById('modalQuery');
            if (queryElement) {
                queryElement.value = query || 'ì¿¼ë¦¬ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.';
            }
            
            // ì§„í–‰ë¥  ì„¤ì •
            const progressValue = parseInt(progress) || 0;
            const progressBar = document.getElementById('modalProgress');
            const progressText = document.getElementById('modalProgressText');
            
            if (progressBar) {
                progressBar.style.width = progressValue + '%';
                progressBar.setAttribute('aria-valuenow', progressValue);
                
                // ì§„í–‰ë¥ ì— ë”°ë¥¸ ìƒ‰ìƒ ë³€ê²½
                let backgroundColor = '';
                if (progressValue === 0) {
                    backgroundColor = 'linear-gradient(135deg, #6c757d, #495057)'; // íšŒìƒ‰
                } else if (progressValue < 25) {
                    backgroundColor = 'linear-gradient(135deg, #dc3545, #c82333)'; // ë¹¨ê°„ìƒ‰
                } else if (progressValue < 50) {
                    backgroundColor = 'linear-gradient(135deg, #fd7e14, #e55a00)'; // ì£¼í™©ìƒ‰
                } else if (progressValue < 75) {
                    backgroundColor = 'linear-gradient(135deg, #ffc107, #e0a800)'; // ë…¸ë€ìƒ‰
                } else if (progressValue < 100) {
                    backgroundColor = 'linear-gradient(135deg, #20c997, #1aa179)'; // ì²­ë¡ìƒ‰
                } else {
                    backgroundColor = 'linear-gradient(135deg, #28a745, #1e7e34)'; // ì´ˆë¡ìƒ‰
                }
                
                progressBar.style.background = backgroundColor;
            }
            if (progressText) {
                progressText.textContent = progressValue + '%';
            }
            
            // ìƒíƒœ ì„¤ì •
            const statusMap = {
                'S': 'ì§„í–‰ ğŸ”„',
                'C': 'ì™„ë£Œ âœ…',
                'W': 'ëŒ€ê¸° â³',
                'E': 'ì˜¤ë¥˜ ğŸš§'
            };
            const statusElement = document.getElementById('modalStatus');
            if (statusElement) {
                statusElement.textContent = statusMap[status] || status;
            }
            
            // ì €ì¥ì†Œ ì •ë³´ ì„¤ì •
            document.getElementById('modalHost').textContent = host || '-';
            document.getElementById('modalDatabase').textContent = database || '-';
            document.getElementById('modalTable').textContent = table || '-';
            document.getElementById('modalDbUser').textContent = dbUser || '-';
            
            // ëª¨ë‹¬ í‘œì‹œ
            const modalElement = document.getElementById('projectDetailModal');
            const modal = new bootstrap.Modal(modalElement, {
                backdrop: true,
                keyboard: true,
                focus: true
            });
            
            // ëª¨ë‹¬ì´ ë‹«í ë•Œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            modalElement.addEventListener('hidden.bs.modal', function() {
                // ë°±ë“œë¡­ ì œê±°
                const backdrops = document.querySelectorAll('.modal-backdrop');
                backdrops.forEach(backdrop => backdrop.remove());
                
                // body í´ë˜ìŠ¤ ì •ë¦¬
                document.body.classList.remove('modal-open');
                document.body.style.overflow = '';
                document.body.style.paddingRight = '';
                
                console.log('í”„ë¡œì íŠ¸ ìƒì„¸ ëª¨ë‹¬ì´ ë‹«í˜”ìŠµë‹ˆë‹¤.');
            });
            
            modal.show();
        }
        
        // ìƒíƒœë³„ í•„í„°ë§ í•¨ìˆ˜
        function filterByStatus(status) {
            console.log('í•„í„°ë§ ìƒíƒœ:', status);
            
            // í˜„ì¬ í•„í„° ìƒíƒœ ì €ì¥
            window.currentFilterStatus = status;
            
            // ë°ì´í„° ìƒì„± ì½˜í…ì¸ ë¥¼ ë‹¤ì‹œ ë¡œë“œ
            loadDataSupplyContent();
        }

        // í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë¡œë“œ í•¨ìˆ˜
        function uploadProfileImage(input) {
            const file = input.files[0];
            if (!file) return;
            
            // íŒŒì¼ í¬ê¸° ê²€ì¦ (5MB ì œí•œ)
            if (file.size > 5 * 1024 * 1024) {
                alert('íŒŒì¼ í¬ê¸°ëŠ” 5MBë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // íŒŒì¼ íƒ€ì… ê²€ì¦
            if (!file.type.startsWith('image/')) {
                alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', file);
            
            // ì—…ë¡œë“œ ì§„í–‰ í‘œì‹œ
            const avatar = document.querySelector('.user-avatar');
            const originalContent = avatar.innerHTML;
            avatar.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            
            fetch('/members/upload-profile', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                console.log('ì—…ë¡œë“œ ì‘ë‹µ ë°ì´í„°:', data);
                if (data.success) {
                    // ì„±ê³µ ì‹œ ì›ë˜ ë‚´ìš© ë³µì› í›„ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸
                    avatar.innerHTML = originalContent;
                    console.log('ì—…ë¡œë“œ ì„±ê³µ, ì´ë¯¸ì§€ ê²½ë¡œ:', data.imagePath);
                    updateSidebarProfileImage(data.imagePath);
                    // ëª¨ë‹¬ ë¯¸ë¦¬ë³´ê¸°ë„ ì—…ë°ì´íŠ¸
                    const preview = document.getElementById('profileEditPreview');
                    if (preview) {
                        const ts = new Date().getTime();
                        preview.src = data.imagePath + '?t=' + ts;
                    }
                    showSuccessMessage(data.message);
                } else {
                    console.error('ì—…ë¡œë“œ ì‹¤íŒ¨:', data.message);
                    alert(data.message);
                    avatar.innerHTML = originalContent;
                }
            })
            .catch(error => {
                console.error('ì—…ë¡œë“œ ì‹¤íŒ¨:', error);
                alert('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                avatar.innerHTML = originalContent;
            })
            .finally(() => {
                // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
                input.value = '';
            });
        }
        
        // ì‚¬ì´ë“œë°” í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateSidebarProfileImage(imagePath) {
            console.log('updateSidebarProfileImage í˜¸ì¶œë¨, imagePath:', imagePath);
            
            // ì‚¬ì´ë“œë°”ì˜ user-avatar ë‚´ img ìš”ì†Œ ì°¾ê¸°
            const userAvatar = document.querySelector('.sidebar .user-avatar');
            if (!userAvatar) {
                console.error('ì‚¬ì´ë“œë°”ì˜ user-avatar ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            let profileImage = userAvatar.querySelector('img');
            if (!profileImage) {
                console.error('user-avatar ë‚´ img ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                console.log('user-avatar ë‚´ë¶€ HTML:', userAvatar.innerHTML);
                return;
            }
            
            const timestamp = new Date().getTime();
            const imageUrl = imagePath + '?t=' + timestamp;
            profileImage.src = imageUrl;
            console.log('í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸ ì„±ê³µ:', imageUrl);
        }

        // í† ê¸€ ë²„íŠ¼ ì´ë²¤íŠ¸
        document.getElementById('sidebarToggle').addEventListener('click', toggleSidebar);

        // ìƒë‹¨ ì‚¬ìš©ì ì•„ì´ì½˜ â†’ ê°œì¸ì •ë³´ ìˆ˜ì • ëª¨ë‹¬
        const headerProfileIcon = document.getElementById('headerProfileIcon');
        if (headerProfileIcon) {
            headerProfileIcon.addEventListener('click', function() {
                // í˜„ì¬ ì‚¬ì´ë“œë°” ì•„ë°”íƒ€ ì´ë¯¸ì§€ë¥¼ ë¯¸ë¦¬ë³´ê¸°ë¡œ ë°˜ì˜
                const sidebarAvatarImg = document.querySelector('.user-avatar img');
                const preview = document.getElementById('profileEditPreview');
                if (sidebarAvatarImg && preview) {
                    preview.src = sidebarAvatarImg.src;
                }
                // ì´ë¦„/ì´ë©”ì¼ ì…ë ¥ê°’ ì´ˆê¸°í™” ë° í˜„ì¬ê°’ ë°˜ì˜
                const nameEl = document.querySelector('.user-name');
                const emailSpan = document.getElementById('currentUserEmail');
                const nameInput = document.getElementById('editName');
                const emailInput = document.getElementById('editEmail');
                const curPwInput = document.getElementById('currentPassword');
                const newPwInput = document.getElementById('editPassword');
                if (nameInput && nameEl) nameInput.value = nameEl.textContent || '';
                if (emailInput && emailSpan) emailInput.value = emailSpan.textContent || '';
                // ëª¨ë‹¬ í—¤ë” í‘œì‹œê°’ë„ ë™ê¸°í™”
                const headerName = document.getElementById('profileEditUserName');
                const headerUsername = document.getElementById('profileEditUserUsername');
                const sidebarUsernameEl = document.querySelector('.user-username');
                if (headerName && nameEl) headerName.textContent = nameEl.textContent || '';
                if (headerUsername && sidebarUsernameEl) headerUsername.textContent = sidebarUsernameEl.textContent || '';
                if (curPwInput) curPwInput.value = '';
                if (newPwInput) newPwInput.value = '';
                const newPwConfirm = document.getElementById('editPasswordConfirm');
                if (newPwConfirm) newPwConfirm.value = '';
                // ë‹¨ê³„ í‘œì‹œ: ê²€ì¦ ë³´ì´ê¸°, ìˆ˜ì • ìˆ¨ê¹€
                const stepVerify = document.getElementById('profileStepVerify');
                const stepEdit = document.getElementById('profileStepEdit');
                if (stepVerify) stepVerify.style.display = '';
                if (stepEdit) stepEdit.style.display = 'none';
                const delBtn = document.getElementById('profileEditDeleteBtn');
                if (delBtn) delBtn.style.display = 'none';
                const saveBtn = document.getElementById('profileSaveBtn');
                if (saveBtn) saveBtn.style.display = 'none';

                const modal = new bootstrap.Modal(document.getElementById('profileEditModal'));
                modal.show();
            });
        }

        // í”„ë¡œí•„ ì´ë¯¸ì§€ ì‚­ì œ
        function deleteProfileImage() {
            fetch('/members/delete-profile', { method: 'POST' })
                .then(r => r.json())
                .then(data => {
                    if (data.success) {
                        // ì‚¬ì´ë“œë°” ì´ë¯¸ì§€ì™€ ëª¨ë‹¬ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
                        const defaultImg = '/images/default/default-avatar.svg';
                        const sidebarImg = document.querySelector('.user-avatar img');
                        const preview = document.getElementById('profileEditPreview');
                        if (sidebarImg) sidebarImg.src = defaultImg;
                        if (preview) preview.src = defaultImg;
                    } else {
                        alert(data.message || 'í”„ë¡œí•„ ì´ë¯¸ì§€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                })
                .catch(() => alert('í”„ë¡œí•„ ì´ë¯¸ì§€ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'));
        }

        // ê°œì¸ì •ë³´ ì €ì¥
        function saveProfileInfo() {
            const currentPassword = document.getElementById('currentPassword').value.trim();
            if (!currentPassword) {
                alert('í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            const name = document.getElementById('editName').value.trim();
            const email = document.getElementById('editEmail').value.trim();
            const password = document.getElementById('editPassword').value.trim();
            const passwordConfirm = document.getElementById('editPasswordConfirm').value.trim();
            if (password && password !== passwordConfirm) {
                alert('ìƒˆ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.');
                return;
            }
            const formData = new FormData();
            formData.append('currentPassword', currentPassword);
            if (name) formData.append('name', name);
            if (email) formData.append('email', email);
            if (password) formData.append('password', password);

            fetch('/members/update-profile', {
                method: 'POST',
                body: formData
            })
                .then(r => r.json())
                .then(data => {
                    if (data.success) {
                        // ì—…ë°ì´íŠ¸ ì„±ê³µ í›„ ì´ë¯¸ì§€ ë³€ê²½/ì‚­ì œë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì²˜ë¦¬ (ì €ì¥ ëˆ„ë¥´ê¸° ì „ê¹Œì§€ ì„œë²„ ë°˜ì˜ ì•ˆ í•¨)
                        let uploadedPath = null;
                        const runImageOps = () => {
                            return new Promise((resolve) => {
                                if (pendingDeleteImage) {
                                    fetch('/members/delete-profile', { method: 'POST' })
                                        .then(res => res.json()).then(() => resolve())
                                        .catch(() => resolve());
                                } else if (pendingProfileFile) {
                                    const fd = new FormData();
                                    fd.append('file', pendingProfileFile);
                                    fetch('/members/upload-profile', { method: 'POST', body: fd })
                                        .then(res => res.json())
                                        .then(j => { uploadedPath = j && j.imagePath ? j.imagePath : null; resolve(); })
                                        .catch(() => resolve());
                                } else {
                                    resolve();
                                }
                            });
                        };

                        runImageOps().then(() => {
                            // ì‚¬ì´ë“œë°” ì´ë¦„ ê°±ì‹ 
                            const nameEl = document.querySelector('.user-name');
                            if (nameEl && data.name) nameEl.textContent = data.name;
                            // ëª¨ë‹¬ í—¤ë” í‘œì‹œê°’ë„ ì¦‰ì‹œ ë™ê¸°í™” (ë‹¤ìŒ ì˜¤í”ˆ ì‹œì—ë„ ë°˜ì˜ë˜ì§€ë§Œ í˜„ì¬ í™”ë©´ë„ ì¼ê´€ì„± ìœ ì§€)
                            const headerName = document.getElementById('profileEditUserName');
                            if (headerName && data.name) headerName.textContent = data.name;
                            // ì´ë©”ì¼ ìŠ¤íŒ¬ ê°±ì‹ 
                            const emailSpan = document.getElementById('currentUserEmail');
                            if (emailSpan && data.email) emailSpan.textContent = data.email;
                            // ì‚¬ì´ë“œë°” ì´ë¯¸ì§€ ê°±ì‹ 
                            if (uploadedPath) {
                                updateSidebarProfileImage(uploadedPath);
                            } else if (pendingDeleteImage) {
                                updateSidebarProfileImage('/images/default/default-avatar.svg');
                            }
                            // ìƒíƒœ ì´ˆê¸°í™” ë° ëª¨ë‹¬ ë‹«ê¸°
                            pendingProfileFile = null;
                            pendingDeleteImage = false;
                            document.getElementById('editPassword').value = '';
                            document.getElementById('editPasswordConfirm').value = '';
                            document.getElementById('currentPassword').value = '';
                            const modal = bootstrap.Modal.getInstance(document.getElementById('profileEditModal'));
                            if (modal) modal.hide();
                        });
                    } else {
                        alert(data.message || 'ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    }
                })
                .catch(() => alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'));
        }

        // ì´ë¯¸ì§€ í´ë¦­ â†’ íŒŒì¼ ì„ íƒ ì—´ê¸°, ì‚­ì œ ë²„íŠ¼ ë™ì‘
        // ëª¨ë‹¬ ë‚´ ì´ë¯¸ì§€ ë³€ê²½/ì‚­ì œëŠ” ì €ì¥ ëˆ„ë¥´ê¸° ì „ê¹Œì§€ ì„œë²„ì— ë°˜ì˜í•˜ì§€ ì•ŠìŒ
        let pendingProfileFile = null;
        let pendingDeleteImage = false;

        (function bindProfileImageControls() {
            const preview = document.getElementById('profileEditPreview');
            const deleteBtn = document.getElementById('profileEditDeleteBtn');
            const fileInput = document.getElementById('profileEditFileInput');
            if (preview && fileInput) {
                preview.addEventListener('click', function() {
                    // í¸ì§‘ ë‹¨ê³„ì—ì„œë§Œ ë™ì‘
                    const stepEdit = document.getElementById('profileStepEdit');
                    if (stepEdit && stepEdit.style.display !== 'none') {
                        fileInput.click();
                    }
                });
                fileInput.addEventListener('change', function() {
                    const file = fileInput.files && fileInput.files[0];
                    if (!file) return;
                    pendingProfileFile = file;
                    pendingDeleteImage = false; // ìƒˆ íŒŒì¼ ì„ íƒ ì‹œ ì‚­ì œ í”Œë˜ê·¸ í•´ì œ
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        preview.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                });
            }
            if (deleteBtn) {
                deleteBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    // í¸ì§‘ ë‹¨ê³„ì—ì„œë§Œ ë™ì‘
                    const stepEdit = document.getElementById('profileStepEdit');
                    if (stepEdit && stepEdit.style.display === 'none') return;
                    pendingDeleteImage = true;
                    pendingProfileFile = null;
                    const defaultImg = '/images/default/default-avatar.svg';
                    const previewImg = document.getElementById('profileEditPreview');
                    if (previewImg) previewImg.src = defaultImg;
                });
            }
        })();

        // ì „ì—­ ëª¨ë‹¬ ì•„í‹°íŒ©íŠ¸ ì •ë¦¬ í•¨ìˆ˜
        function resetModalArtifacts() {
            const backdrops = document.querySelectorAll('.modal-backdrop');
            backdrops.forEach(b => b.remove());
            document.body.classList.remove('modal-open');
            document.body.style.overflow = '';
            document.body.style.paddingRight = '';
        }

        // ê°œì¸ì •ë³´ ìˆ˜ì • ëª¨ë‹¬ ë‹«í ë•Œë„ ì •ë¦¬
        (function bindProfileModalCleanup(){
            const m = document.getElementById('profileEditModal');
            if (!m) return;
            m.addEventListener('hidden.bs.modal', resetModalArtifacts);
        })();

        // ì‚¬ìš©ìê°€ ë°”ë””ë¥¼ í´ë¦­í–ˆëŠ”ë° ëª¨ë‹¬ì´ ì—†ëŠ”ë°ë„ í´ë¦­ì´ ë§‰í ê²½ìš° ëŒ€ë¹„í•œ ì•ˆì „ì¥ì¹˜
        document.addEventListener('click', function(){
            const anyOpenModal = document.querySelector('.modal.show');
            if (!anyOpenModal) {
                resetModalArtifacts();
            }
        }, true);

        function verifyCurrentPassword() {
            const currentPassword = document.getElementById('currentPassword').value.trim();
            if (!currentPassword) {
                alert('í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            const formData = new FormData();
            formData.append('currentPassword', currentPassword);
            fetch('/members/verify-password', { method: 'POST', body: formData })
                .then(r => r.json())
                .then(data => {
                    if (data.success) {
                        // ë‹¨ê³„ ì „í™˜
                        const stepVerify = document.getElementById('profileStepVerify');
                        const stepEdit = document.getElementById('profileStepEdit');
                        if (stepVerify) stepVerify.style.display = 'none';
                        if (stepEdit) {
                            stepEdit.style.display = '';
                            const delBtn = document.getElementById('profileEditDeleteBtn');
                            if (delBtn) delBtn.style.display = 'flex';
                            const saveBtn = document.getElementById('profileSaveBtn');
                            if (saveBtn) saveBtn.style.display = '';
                        }
                        // ì´ë¦„/ì´ë©”ì¼ ì…ë ¥ê°’ ì±„ìš°ê¸° (ì´ë¯¸ ì˜¤í”ˆ ì‹œ ì±„ì›€)
                    } else {
                        alert(data.message || 'ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    }
                })
                .catch(() => alert('ê²€ì¦ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'));
        }

        // í”Œë¡œíŒ… ì±—ë´‡ ì°½ ì—´ê¸°/ë‹«ê¸°
        function toggleFloatingChat() {
            const chatWindow = document.getElementById('floatingChatWindow');
            if (chatWindow) {
                chatWindow.classList.toggle('open');
                // ì±—ë´‡ ì°½ì´ ì—´ë¦´ ë•Œ ES ì—°ê²° í™•ì¸
                if (chatWindow.classList.contains('open')) {
                    checkFloatingChatElasticsearchConnection();
                }
            }
        }

        // í”Œë¡œíŒ… ì±—ë´‡ ES ì—°ê²° ìƒíƒœ í™•ì¸
        function checkFloatingChatElasticsearchConnection() {
            fetch('/api/chatbot/ask', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                credentials: 'same-origin',
                body: JSON.stringify({ question: 'í…ŒìŠ¤íŠ¸' })
            })
            .then(response => response.json())
            .then(data => {
                const answer = data.answer || '';
                const isEsError = answer.includes('Elasticsearch í´ëŸ¬ìŠ¤í„°ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤') || 
                                 answer.includes('ì±—ë´‡ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                
                if (isEsError) {
                    const chatMessages = document.getElementById('floatingChatMessages');
                    if (chatMessages && chatMessages.children.length === 0) {
                        const errorMsg = document.createElement('div');
                        errorMsg.className = 'floating-chat-message bot-message';
                        errorMsg.innerHTML = `
                            <div class="floating-chat-avatar">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="floating-chat-bubble" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                                <span style="color: #ffcc00; font-weight: bold;">âš ï¸ </span>
                                ${escapeHtml(answer)}
                            </div>
                        `;
                        chatMessages.appendChild(errorMsg);
                    }
                } else {
                    // ì •ìƒ ì—°ê²° ì‹œ í™˜ì˜ ë©”ì‹œì§€ í‘œì‹œ
                    const chatMessages = document.getElementById('floatingChatMessages');
                    if (chatMessages && chatMessages.children.length === 0) {
                        const welcomeMsg = document.createElement('div');
                        welcomeMsg.className = 'floating-chat-message bot-message';
                        welcomeMsg.innerHTML = `
                            <div class="floating-chat-avatar">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="floating-chat-bubble">
                                ì•ˆë…•í•˜ì„¸ìš”! ì‹œìŠ¤í…œ ì±—ë´‡ì…ë‹ˆë‹¤. ì‹œìŠ¤í…œì— ëŒ€í•´ ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ì§ˆë¬¸í•´ì£¼ì„¸ìš”.
                            </div>
                        `;
                        chatMessages.appendChild(welcomeMsg);
                    }
                }
            })
            .catch(error => {
                console.error('ES ì—°ê²° í™•ì¸ ì˜¤ë¥˜:', error);
            });
        }

        // í”Œë¡œíŒ… ì±—ë´‡ ë©”ì‹œì§€ ì „ì†¡
        function sendFloatingChatMessage() {
            const chatInput = document.getElementById('floatingChatInput');
            const sendBtn = document.getElementById('floatingChatSend');
            const chatMessages = document.getElementById('floatingChatMessages');
            
            if (!chatInput || !sendBtn || !chatMessages) return;
            
            const message = chatInput.value.trim();
            if (!message || sendBtn.disabled) return;
            
            // ì‚¬ìš©ì ë©”ì‹œì§€ í‘œì‹œ
            const userMessageDiv = document.createElement('div');
            userMessageDiv.className = 'floating-chat-message user-message';
            userMessageDiv.innerHTML = `
                <div class="floating-chat-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="floating-chat-bubble">${escapeHtml(message)}</div>
            `;
            chatMessages.appendChild(userMessageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // ì…ë ¥ í•„ë“œ ë¹„í™œì„±í™”
            chatInput.value = '';
            chatInput.disabled = true;
            sendBtn.disabled = true;
            
            // ë¡œë”© ë©”ì‹œì§€
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'floating-chat-message bot-message';
            loadingDiv.id = 'floatingChatLoading';
            loadingDiv.innerHTML = `
                <div class="floating-chat-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="floating-chat-bubble">
                    <i class="fas fa-spinner fa-spin"></i> ë‹µë³€ì„ ìƒì„±í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...
                </div>
            `;
            chatMessages.appendChild(loadingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // API í˜¸ì¶œ
            fetch('/api/chatbot/ask', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                credentials: 'same-origin',
                body: JSON.stringify({ question: message })
            })
            .then(response => response.json())
            .then(data => {
                // ë¡œë”© ë©”ì‹œì§€ ì œê±°
                const loading = document.getElementById('floatingChatLoading');
                if (loading) loading.remove();
                
                const answer = data.answer || 'ì£„ì†¡í•©ë‹ˆë‹¤. ë‹µë³€ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                const isError = answer.includes('Elasticsearch í´ëŸ¬ìŠ¤í„°ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤') || 
                               answer.includes('ì±—ë´‡ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                
                // ë´‡ ì‘ë‹µ í‘œì‹œ
                const botMessageDiv = document.createElement('div');
                botMessageDiv.className = 'floating-chat-message bot-message';
                botMessageDiv.innerHTML = `
                    <div class="floating-chat-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="floating-chat-bubble" style="${isError ? 'background: linear-gradient(135deg, #e74c3c, #c0392b);' : ''}">
                        ${isError ? '<span style="color: #ffcc00; font-weight: bold;">âš ï¸ </span>' : ''}
                        ${escapeHtml(answer)}
                    </div>
                `;
                chatMessages.appendChild(botMessageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // ì…ë ¥ í•„ë“œ í™œì„±í™”
                chatInput.disabled = false;
                sendBtn.disabled = false;
                chatInput.focus();
            })
            .catch(error => {
                // ë¡œë”© ë©”ì‹œì§€ ì œê±°
                const loading = document.getElementById('floatingChatLoading');
                if (loading) loading.remove();
                
                // ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
                const errorDiv = document.createElement('div');
                errorDiv.className = 'floating-chat-message bot-message';
                errorDiv.innerHTML = `
                    <div class="floating-chat-avatar">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="floating-chat-bubble" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                        <span style="color: #ffcc00; font-weight: bold;">âš ï¸ </span>
                        ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.
                    </div>
                `;
                chatMessages.appendChild(errorDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // ì…ë ¥ í•„ë“œ í™œì„±í™”
                chatInput.disabled = false;
                sendBtn.disabled = false;
                chatInput.focus();
            });
        }

        // í”Œë¡œíŒ… ì±—ë´‡ ì…ë ¥ í•„ë“œì—ì„œ Enter í‚¤ ì²˜ë¦¬
        function handleFloatingChatEnter(event) {
            if (event.key === 'Enter') {
                sendFloatingChatMessage();
            }
        }

        // ê¸€ë¡œë²Œ ìì‚° ë™í–¥ ì°¨íŠ¸ ë¡œë“œ í•¨ìˆ˜
        let globalAssetsCharts = [];
        let globalAssetsUpdateInterval = null;
        
        // ìì‚°ë³„ API ì—”ë“œí¬ì¸íŠ¸ (í•­ìƒ 1ë‹¬ ì¶”ì„¸)
        const assetEndpoints = {
            'asset1': '/api/global-assets/bitcoin-usdt?period=1month',
            'asset2': '/api/global-assets/ethereum-usdt?period=1month',
            'asset3': '/api/global-assets/nasdaq?period=1month',
            'asset4': '/api/global-assets/bitcoin-dominance?period=1month',
            'asset5': '/api/global-assets/gold?period=1month',
            'asset6': '/api/global-assets/dollar-index?period=1month'
        };
        
        // ìì‚°ë³„ ì°¨íŠ¸ ìƒ‰ìƒ
        const assetColors = {
            'asset1': { border: '#f7931a', background: 'rgba(247, 147, 26, 0.1)' }, // BTC/USDT
            'asset2': { border: '#627eea', background: 'rgba(98, 126, 234, 0.1)' }, // ETH/USDT
            'asset3': { border: '#28a745', background: 'rgba(40, 167, 69, 0.1)' }, // NASDAQ
            'asset4': { border: '#ffc107', background: 'rgba(255, 193, 7, 0.1)' }, // BTC.D
            'asset5': { border: '#ff9800', background: 'rgba(255, 152, 0, 0.1)' }, // XAU/USD
            'asset6': { border: '#9c27b0', background: 'rgba(156, 39, 176, 0.1)' }  // USD/KRW
        };
        
        async function loadGlobalAssetsCharts() {
            // ê¸°ì¡´ ì°¨íŠ¸ê°€ ìˆìœ¼ë©´ ì œê±°
            globalAssetsCharts.forEach(chart => {
                if (chart) chart.destroy();
            });
            globalAssetsCharts = [];
            
            // ê¸°ì¡´ ì¸í„°ë²Œì´ ìˆìœ¼ë©´ ì œê±°
            if (globalAssetsUpdateInterval) {
                clearInterval(globalAssetsUpdateInterval);
                globalAssetsUpdateInterval = null;
            }
            
            // ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
            for (let i = 1; i <= 6; i++) {
                const statusEl = document.getElementById(`asset${i}Status`);
                if (statusEl) {
                    statusEl.textContent = 'ë¡œë”© ì¤‘...';
                    statusEl.style.color = '#ffc107';
                }
            }
            
            // ì°¨íŠ¸ ì„¤ì •
            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                animation: {
                    duration: 500
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        backgroundColor: 'rgba(45, 49, 66, 0.9)',
                        titleColor: '#ffffff',
                        bodyColor: '#ffffff',
                        borderColor: '#4a4f62',
                        borderWidth: 1
                    }
                },
                scales: {
                    x: {
                        ticks: {
                            color: '#a0a6b8',
                            maxRotation: 45,
                            minRotation: 45,
                            maxTicksLimit: 10
                        },
                        grid: {
                            color: '#4a4f62'
                        }
                    },
                    y: {
                        ticks: {
                            color: '#a0a6b8'
                        },
                        grid: {
                            color: '#4a4f62'
                        }
                    }
                }
            };
            
            // ê° ìì‚°ë³„ ì°¨íŠ¸ ìƒì„±
            const assetKeys = ['asset1', 'asset2', 'asset3', 'asset4', 'asset5', 'asset6'];
            const chartPromises = assetKeys.map(async (assetKey, index) => {
                const chartId = `assetChart${index + 1}`;
                const ctx = document.getElementById(chartId);
                if (!ctx) return;
                
                try {
                    const endpoint = assetEndpoints[assetKey];
                    const response = await fetch(endpoint);
                    const result = await response.json();
                    
                    // Rate Limit ì—ëŸ¬ ì²´í¬
                    if (result.rateLimitExceeded || (result.error && result.error.includes('Rate Limit'))) {
                        // ì°¨íŠ¸ ëŒ€ì‹  ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ
                        ctx.parentElement.innerHTML = `
                            <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; padding: 20px; text-align: center;">
                                <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: #ffc107; margin-bottom: 15px;"></i>
                                <h5 style="color: #ffffff; margin-bottom: 10px;">API í˜¸ì¶œ í•œë„ ì´ˆê³¼</h5>
                                <p style="color: #a0a6b8; font-size: 0.9rem; margin: 0;">
                                    ${result.message || 'API í˜¸ì¶œ í•œë„ê°€ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.'}<br>
                                    ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.
                                </p>
                            </div>
                        `;
                        
                        const statusEl = document.getElementById(`asset${index + 1}Status`);
                        if (statusEl) {
                            statusEl.textContent = 'í•œë„ ì´ˆê³¼';
                            statusEl.style.color = '#ffc107';
                        }
                        return;
                    }
                    
                    if (result.success && result.data) {
                        const labels = result.data.map(item => item.date);
                        const values = result.data.map(item => item.value);
                        
                        // ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬
                        if (labels.length === 0 || values.length === 0) {
                            throw new Error('ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                        }
                        
                        const chart = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: labels,
                                datasets: [{
                                    label: assetKey === 'asset1' ? 'BTC/USDT' :
                                           assetKey === 'asset2' ? 'ETH/USDT' :
                                           assetKey === 'asset3' ? 'NASDAQ' :
                                           assetKey === 'asset4' ? 'BTC.D' :
                                           assetKey === 'asset5' ? 'XAU/USD' : 'USD/KRW',
                                    data: values,
                                    borderColor: assetColors[assetKey].border,
                                    backgroundColor: assetColors[assetKey].background,
                                    borderWidth: 2,
                                    fill: true,
                                    tension: 0.4,
                                    pointRadius: 3,
                                    pointHoverRadius: 5
                                }]
                            },
                            options: chartOptions
                        });
                        
                        globalAssetsCharts.push(chart);
                        
                        // ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
                        const statusEl = document.getElementById(`asset${index + 1}Status`);
                        if (statusEl) {
                            const now = new Date();
                            statusEl.textContent = now.toLocaleDateString('ko-KR');
                            statusEl.style.color = '#28a745';
                        }
                    } else {
                        throw new Error(result.error || 'ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                } catch (error) {
                    console.error(`${assetKey} ì°¨íŠ¸ ë¡œë“œ ì˜¤ë¥˜:`, error);
                    // ì°¨íŠ¸ ëŒ€ì‹  ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
                    ctx.parentElement.innerHTML = `
                        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; padding: 20px; text-align: center;">
                            <i class="fas fa-exclamation-circle" style="font-size: 3rem; color: #dc3545; margin-bottom: 15px;"></i>
                            <h5 style="color: #ffffff; margin-bottom: 10px;">ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</h5>
                            <p style="color: #a0a6b8; font-size: 0.9rem; margin: 0;">
                                ì°¨íŠ¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>
                                ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.
                            </p>
                        </div>
                    `;
                    
                    const statusEl = document.getElementById(`asset${index + 1}Status`);
                    if (statusEl) {
                        statusEl.textContent = 'ì˜¤ë¥˜';
                        statusEl.style.color = '#dc3545';
                    }
                }
            });
            
            await Promise.all(chartPromises);
            
            // 1ë¶„ë§ˆë‹¤ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ (ì¼ë³„ ë°ì´í„°ì´ë¯€ë¡œ ë§¤ì¼ í•œ ë²ˆë§Œ ê°±ì‹ )
            globalAssetsUpdateInterval = setInterval(() => {
                updateGlobalAssetsCharts();
            }, 60000); // 1ë¶„ë§ˆë‹¤ ì²´í¬ (ì‹¤ì œë¡œëŠ” ë§¤ì¼ ìì •ì— ê°±ì‹ )
        }
        
        // ì°¨íŠ¸ ë°ì´í„° ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ì¼ë³„ ë°ì´í„°ì´ë¯€ë¡œ ë§¤ì¼ í•œ ë²ˆë§Œ ê°±ì‹ )
        async function updateGlobalAssetsCharts() {
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            
            // ë§¤ì¼ ìì •ì—ë§Œ ê°±ì‹  (ë˜ëŠ” í˜ì´ì§€ ë¡œë“œ ì‹œ)
            if (currentHour === 0 && currentMinute === 0) {
                // ëª¨ë“  ì°¨íŠ¸ ë‹¤ì‹œ ë¡œë“œ
                loadGlobalAssetsCharts();
            }
        }
        
        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            showPage('dashboard');
        });
    </script>

    <!-- í”Œë¡œíŒ… ì±—ë´‡ ë²„íŠ¼ -->
    <button class="floating-chat-button" onclick="toggleFloatingChat()" title="ì‹œìŠ¤í…œ ì±—ë´‡">
        <i class="fas fa-comments"></i>
    </button>

    <!-- í”Œë¡œíŒ… ì±—ë´‡ ì°½ -->
    <div id="floatingChatWindow" class="floating-chat-window">
        <div class="floating-chat-header">
            <h4>
                <i class="fas fa-robot"></i>
                ì‹œìŠ¤í…œ ì±—ë´‡
            </h4>
            <button class="floating-chat-close" onclick="toggleFloatingChat()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div id="floatingChatMessages" class="floating-chat-messages">
            <!-- ë©”ì‹œì§€ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
        </div>
        <div class="floating-chat-input-area">
            <input type="text" 
                   id="floatingChatInput" 
                   class="floating-chat-input" 
                   placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
                   onkeypress="handleFloatingChatEnter(event)">
            <button id="floatingChatSend" 
                    class="floating-chat-send" 
                    onclick="sendFloatingChatMessage()">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>
</body>
</html>